<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="generator" content="ReSpec 35.2.0">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
</style>
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
<title>Data Integrity ECDSA Cryptosuites v1.0</title>
    
    
    
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>
    

    
    
<style>

code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre.nohighlight {
  overflow-x: auto;
  white-space: pre-wrap;
}
pre .highlight {
  font-weight: bold;
  color: green;
}
pre .comment {
  font-weight: bold;
  color: Gray;
}
.color-text {
  font-weight: bold;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}
ol.algorithm {
  counter-reset: numsection;
  list-style-type: none;
}
ol.algorithm li {
  margin: 0.5em 0;
}
ol.algorithm li:before {
  font-weight: bold;
  counter-increment: numsection;
  content: counters(numsection, ".") ") ";
}
    
</style>
  
<meta name="color-scheme" content="light">
<meta name="description" content="This specification describes Data Integrity cryptosuites for use when
generating a digital signature using the Elliptic Curve Digital Signature
Algorithm (ECDSA).">
<link rel="canonical" href="https://www.w3.org/TR/vc-di-ecdsa/">
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "subtitle": "Achieving Data Integrity using ECDSA with NIST-compliant curves",
  "group": "vc",
  "specStatus": "CR",
  "shortName": "vc-di-ecdsa",
  "publishDate": "2024-12-19",
  "crEnd": "2025-01-19",
  "edDraftURI": "https://w3c.github.io/vc-di-ecdsa/",
  "implementationReportURI": "https://w3c.github.io/vc-di-ecdsa-test-suite/",
  "editors": [
    {
      "name": "Manu Sporny",
      "url": "https://www.linkedin.com/in/manusporny/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/",
      "w3cid": 41758
    },
    {
      "name": "Marty Reed",
      "url": "https://www.linkedin.com/in/marty-reed-b5b2352/",
      "company": "RANDA Solutions",
      "companyURL": "https://www.randasolutions.com/",
      "w3cid": 127611
    },
    {
      "name": "Greg Bernstein",
      "url": "https://www.grotto-networking.com/",
      "company": "Invited Expert",
      "w3cid": 140479
    },
    {
      "name": "Sebastian Crane",
      "url": "https://github.com/seabass-labrax",
      "company": "Invited Expert",
      "w3cid": 140132
    }
  ],
  "authors": [
    {
      "name": "Dave Longley",
      "url": "https://digitalbazaar.com/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/",
      "w3cid": 48025
    },
    {
      "name": "Manu Sporny",
      "url": "https://www.linkedin.com/in/manusporny/",
      "company": "Digital Bazaar",
      "companyURL": "https://digitalbazaar.com/",
      "w3cid": 41758
    }
  ],
  "github": "https://github.com/w3c/vc-di-ecdsa/",
  "maxTocLevel": 4,
  "localBiblio": {
    "SECG2": {
      "title": "SEC 2: Recommended Elliptic Curve Domain Parameters",
      "href": "https://www.secg.org/sec2-v2.pdf",
      "date": "January 27, 2010",
      "publisher": "Certicom Research",
      "id": "secg2"
    },
    "NIST-SP-800-186": {
      "title": "Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters",
      "authors": [
        "Lily Chen",
        "Dustin Moody",
        "Karen Randall",
        "Andrew Regenscheid",
        "Angela Robinson"
      ],
      "date": "February 2023",
      "publisher": "National Institute of Standards and Technology",
      "id": "nist-sp-800-186"
    },
    "NIST-SP-800-57-Part-1": {
      "title": "Recommendation for Key Management: Part 1 – General",
      "authors": [
        "Elaine Barker"
      ],
      "date": "May 2020",
      "publisher": "National Institute of Standards and Technology",
      "href": "https://doi.org/10.6028/NIST.SP.800-57pt1r5",
      "id": "nist-sp-800-57-part-1"
    }
  },
  "xref": [
    "INFRA",
    "VC-DATA-MODEL-2.0",
    "VC-DATA-INTEGRITY"
  ],
  "lint": {
    "informative-dfn": false
  },
  "otherLinks": [
    {
      "key": "Related Specifications",
      "data": [
        {
          "value": "The Verifiable Credentials Data Model v2.0",
          "href": "https://www.w3.org/TR/vc-data-model-2.0/"
        },
        {
          "value": "Verifiable Credential Data Integrity v1.0",
          "href": "https://www.w3.org/TR/vc-data-integrity/"
        },
        {
          "value": "Controller Documents v1.0",
          "href": "https://www.w3.org/TR/controller-document/"
        },
        {
          "value": "Data Integrity EdDSA Cryptosuites v1.0",
          "href": "https://www.w3.org/TR/vc-di-eddsa/"
        },
        {
          "value": "Data Integrity BBS Cryptosuites v1.0",
          "href": "https://www.w3.org/TR/vc-di-bbs/"
        }
      ]
    }
  ],
  "publishISODate": "2024-12-19T00:00:00.000Z",
  "generatedSubtitle": "W3C Candidate Recommendation Snapshot 19 December 2024"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-CR"></head>
  <body class="h-entry" data-cite="INFRA VC-DATA-MODEL-2.0 VC-DATA-INTEGRITY"><div class="head">
    <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">Data Integrity ECDSA Cryptosuites v1.0</h1> <h2 id="subtitle" class="subtitle">Achieving Data Integrity using ECDSA with NIST-compliant curves</h2>
    <p id="w3c-state"><a href="https://www.w3.org/standards/types#CR">W3C Candidate Recommendation Snapshot</a> <time class="dt-published" datetime="2024-12-19">19 December 2024</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://www.w3.org/TR/2024/CR-vc-di-ecdsa-20241219/">https://www.w3.org/TR/2024/CR-vc-di-ecdsa-20241219/</a>
              </dd>
        <dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/vc-di-ecdsa/">https://www.w3.org/TR/vc-di-ecdsa/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/vc-di-ecdsa/">https://w3c.github.io/vc-di-ecdsa/</a></dd>
        <dt>History:</dt><dd>
                    <a href="https://www.w3.org/standards/history/vc-di-ecdsa/">https://www.w3.org/standards/history/vc-di-ecdsa/</a>
                  </dd><dd>
                    <a href="https://github.com/w3c/vc-di-ecdsa/commits/">Commit history</a>
                  </dd>
        
        <dt>Implementation report:</dt><dd>
                <a href="https://w3c.github.io/vc-di-ecdsa-test-suite/">https://w3c.github.io/vc-di-ecdsa-test-suite/</a>
              </dd>
        
        
        
        <dt>Editors:</dt><dd class="editor p-author h-card vcard" data-editor-id="41758">
    <a class="u-url url p-name fn" href="https://www.linkedin.com/in/manusporny/">Manu Sporny</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="127611">
    <a class="u-url url p-name fn" href="https://www.linkedin.com/in/marty-reed-b5b2352/">Marty Reed</a> (<a class="p-org org h-org" href="https://www.randasolutions.com/">RANDA Solutions</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="140479">
    <a class="u-url url p-name fn" href="https://www.grotto-networking.com/">Greg Bernstein</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="140132">
    <a class="u-url url p-name fn" href="https://github.com/seabass-labrax">Sebastian Crane</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd>
        
        <dt>Authors:</dt><dd class="editor p-author h-card vcard" data-editor-id="48025">
    <a class="u-url url p-name fn" href="https://digitalbazaar.com/">Dave Longley</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="41758">
    <a class="u-url url p-name fn" href="https://www.linkedin.com/in/manusporny/">Manu Sporny</a> (<a class="p-org org h-org" href="https://digitalbazaar.com/">Digital Bazaar</a>)
  </dd>
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/vc-di-ecdsa/">GitHub w3c/vc-di-ecdsa</a>
        (<a href="https://github.com/w3c/vc-di-ecdsa/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/vc-di-ecdsa/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/vc-di-ecdsa/issues/">open issues</a>)
      </dd>
        
        <dt>Related Specifications</dt><dd>
    <a href="https://www.w3.org/TR/vc-data-model-2.0/">The Verifiable Credentials Data Model v2.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-data-integrity/">Verifiable Credential Data Integrity v1.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/controller-document/">Controller Documents v1.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-di-eddsa/">Data Integrity EdDSA Cryptosuites v1.0</a>
  </dd><dd>
    <a href="https://www.w3.org/TR/vc-di-bbs/">Data Integrity BBS Cryptosuites v1.0</a>
  </dd>
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="https://www.w3.org/policies/#copyright">Copyright</a>
    ©
    2024
    
    <a href="https://www.w3.org/">World Wide Web Consortium</a>.
    <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
    <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
    <a rel="license" href="https://www.w3.org/copyright/software-license-2023/" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>
This specification describes Data Integrity cryptosuites for use when
generating a digital signature using the Elliptic Curve Digital Signature
Algorithm (ECDSA).
      </p>
    </section>

    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>

      <p>
The Working Group is actively seeking implementation feedback for this
specification. In order to exit the Candidate Recommendation phase, the
Working Group has set the requirement of at least two independent
implementations for each mandatory feature in the specification. For details
on the conformance testing process, see the test suites listed in the
<a href="https://w3c.github.io/vc-di-ecdsa-test-suite/">
implementation report</a>.
      </p>

      <div class="issue atrisk" id="issue-container-number-1"><div role="heading" class="issue-title marker" id="h-issue" aria-level="3"><span>(Feature at Risk) Issue 1</span><span class="issue-label">: Features with less than two independent implementations</span></div><p class="atrisk">
Any feature with less than two independent implementations in the
<a href="https://w3c.github.io/vc-di-ecdsa-test-suite/">
ECDSA Cryptosuite Implementation Report</a> is an "at risk" feature and might be
removed before the transition to <abbr title="World Wide Web Consortium">W3C</abbr> Proposed Recommendation.
      </p></div>

    <p>
    This document was published by the <a href="https://www.w3.org/groups/wg/vc">Verifiable Credentials Working Group</a> as
    a Candidate Recommendation Snapshot using the
        <a href="https://www.w3.org/policies/process/20231103/#recs-and-notes">Recommendation track</a>. 
  </p><p>Publication as a Candidate Recommendation does not
  imply endorsement by <abbr title="World Wide Web Consortium">W3C</abbr> and its Members. A Candidate Recommendation Snapshot has received
        <a href="https://www.w3.org/policies/process/20231103/#dfn-wide-review">wide review</a>, is intended to
        gather
        <a href="https://w3c.github.io/vc-di-ecdsa-test-suite/">implementation experience</a>,
        and has commitments from Working Group members to
        <a href="https://www.w3.org/policies/patent-policy/#sec-Requirements">royalty-free licensing</a>
        for implementations.</p><p>
          This Candidate Recommendation is not expected to advance to Proposed
          Recommendation any earlier than 19 January 2025.
        </p><p>
    
        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/policies/patent-policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>.
      
    
                <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                <a rel="disclosure" href="https://www.w3.org/groups/wg/vc/ipr">public list of any patent disclosures</a>
          made in connection with the deliverables of
          the group; that page also includes
          instructions for disclosing a patent. An individual who has actual
          knowledge of a patent which the individual believes contains
          <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
          must disclose the information in accordance with
          <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
        
  </p><p>
                      This document is governed by the
                      <a id="w3c_process_revision" href="https://www.w3.org/policies/process/20231103/">03 November 2023 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                    </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#terminology"><bdi class="secno">1.1 </bdi>Terminology</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">1.2 </bdi>Conformance</a></li></ol></li><li class="tocline"><a class="tocxref" href="#data-model"><bdi class="secno">2. </bdi>Data Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#verification-methods"><bdi class="secno">2.1 </bdi>Verification Methods</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#multikey"><bdi class="secno">2.1.1 </bdi>Multikey</a></li></ol></li><li class="tocline"><a class="tocxref" href="#proof-representations"><bdi class="secno">2.2 </bdi>Proof Representations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#dataintegrityproof"><bdi class="secno">2.2.1 </bdi>DataIntegrityProof</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#algorithms"><bdi class="secno">3. </bdi>Algorithms</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#instantiate-cryptosuite"><bdi class="secno">3.1 </bdi>Instantiate Cryptosuite</a></li><li class="tocline"><a class="tocxref" href="#ecdsa-rdfc-2019"><bdi class="secno">3.2 </bdi>ecdsa-rdfc-2019</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#create-proof-ecdsa-rdfc-2019"><bdi class="secno">3.2.1 </bdi>Create Proof (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#verify-proof-ecdsa-rdfc-2019"><bdi class="secno">3.2.2 </bdi>Verify Proof (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#transformation-ecdsa-rdfc-2019"><bdi class="secno">3.2.3 </bdi>Transformation (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#hashing-ecdsa-rdfc-2019"><bdi class="secno">3.2.4 </bdi>Hashing (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-configuration-ecdsa-rdfc-2019"><bdi class="secno">3.2.5 </bdi>Proof Configuration (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-serialization-ecdsa-rdfc-2019"><bdi class="secno">3.2.6 </bdi>Proof Serialization (ecdsa-rdfc-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-verification-ecdsa-rdfc-2019"><bdi class="secno">3.2.7 </bdi>Proof Verification (ecdsa-rdfc-2019)</a></li></ol></li><li class="tocline"><a class="tocxref" href="#ecdsa-jcs-2019"><bdi class="secno">3.3 </bdi>ecdsa-jcs-2019</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#create-proof-ecdsa-jcs-2019"><bdi class="secno">3.3.1 </bdi>Create Proof (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#verify-proof-ecdsa-jcs-2019"><bdi class="secno">3.3.2 </bdi>Verify Proof (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#transformation-ecdsa-jcs-2019"><bdi class="secno">3.3.3 </bdi>Transformation (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#hashing-ecdsa-jcs-2019"><bdi class="secno">3.3.4 </bdi>Hashing (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-configuration-ecdsa-jcs-2019"><bdi class="secno">3.3.5 </bdi>Proof Configuration (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-serialization-ecdsa-jcs-2019"><bdi class="secno">3.3.6 </bdi>Proof Serialization (ecdsa-jcs-2019)</a></li><li class="tocline"><a class="tocxref" href="#proof-verification-ecdsa-jcs-2019"><bdi class="secno">3.3.7 </bdi>Proof Verification (ecdsa-jcs-2019)</a></li></ol></li><li class="tocline"><a class="tocxref" href="#selective-disclosure-functions"><bdi class="secno">3.4 </bdi>Selective Disclosure Functions</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#labelreplacementcanonicalizenquads"><bdi class="secno">3.4.1 </bdi>labelReplacementCanonicalizeNQuads</a></li><li class="tocline"><a class="tocxref" href="#labelreplacementcanonicalizejsonld"><bdi class="secno">3.4.2 </bdi>labelReplacementCanonicalizeJsonLd</a></li><li class="tocline"><a class="tocxref" href="#createlabelmapfunction"><bdi class="secno">3.4.3 </bdi>createLabelMapFunction</a></li><li class="tocline"><a class="tocxref" href="#createhmacidlabelmapfunction"><bdi class="secno">3.4.4 </bdi>createHmacIdLabelMapFunction</a></li><li class="tocline"><a class="tocxref" href="#skolemizenquads"><bdi class="secno">3.4.5 </bdi>skolemizeNQuads</a></li><li class="tocline"><a class="tocxref" href="#deskolemizenquads"><bdi class="secno">3.4.6 </bdi>deskolemizeNQuads</a></li><li class="tocline"><a class="tocxref" href="#skolemizeexpandedjsonld"><bdi class="secno">3.4.7 </bdi>skolemizeExpandedJsonLd</a></li><li class="tocline"><a class="tocxref" href="#skolemizecompactjsonld"><bdi class="secno">3.4.8 </bdi>skolemizeCompactJsonLd</a></li><li class="tocline"><a class="tocxref" href="#todeskolemizednquads"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</a></li><li class="tocline"><a class="tocxref" href="#jsonpointertopaths"><bdi class="secno">3.4.10 </bdi>jsonPointerToPaths</a></li><li class="tocline"><a class="tocxref" href="#createinitialselection"><bdi class="secno">3.4.11 </bdi>createInitialSelection</a></li><li class="tocline"><a class="tocxref" href="#selectpaths"><bdi class="secno">3.4.12 </bdi>selectPaths</a></li><li class="tocline"><a class="tocxref" href="#selectjsonld"><bdi class="secno">3.4.13 </bdi>selectJsonLd</a></li><li class="tocline"><a class="tocxref" href="#relabelblanknodes"><bdi class="secno">3.4.14 </bdi>relabelBlankNodes</a></li><li class="tocline"><a class="tocxref" href="#selectcanonicalnquads"><bdi class="secno">3.4.15 </bdi>selectCanonicalNQuads</a></li><li class="tocline"><a class="tocxref" href="#canonicalizeandgroup"><bdi class="secno">3.4.16 </bdi>canonicalizeAndGroup</a></li><li class="tocline"><a class="tocxref" href="#hashmandatorynquads"><bdi class="secno">3.4.17 </bdi>hashMandatoryNQuads</a></li></ol></li><li class="tocline"><a class="tocxref" href="#ecdsa-sd-2023-functions"><bdi class="secno">3.5 </bdi>ecdsa-sd-2023 Functions</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#serializesigndata"><bdi class="secno">3.5.1 </bdi>serializeSignData</a></li><li class="tocline"><a class="tocxref" href="#serializebaseproofvalue"><bdi class="secno">3.5.2 </bdi>serializeBaseProofValue</a></li><li class="tocline"><a class="tocxref" href="#parsebaseproofvalue"><bdi class="secno">3.5.3 </bdi>parseBaseProofValue</a></li><li class="tocline"><a class="tocxref" href="#createdisclosuredata"><bdi class="secno">3.5.4 </bdi>createDisclosureData</a></li><li class="tocline"><a class="tocxref" href="#compresslabelmap"><bdi class="secno">3.5.5 </bdi>compressLabelMap</a></li><li class="tocline"><a class="tocxref" href="#decompresslabelmap"><bdi class="secno">3.5.6 </bdi>decompressLabelMap</a></li><li class="tocline"><a class="tocxref" href="#serializederivedproofvalue"><bdi class="secno">3.5.7 </bdi>serializeDerivedProofValue</a></li><li class="tocline"><a class="tocxref" href="#parsederivedproofvalue"><bdi class="secno">3.5.8 </bdi>parseDerivedProofValue</a></li><li class="tocline"><a class="tocxref" href="#createverifydata"><bdi class="secno">3.5.9 </bdi>createVerifyData</a></li></ol></li><li class="tocline"><a class="tocxref" href="#ecdsa-sd-2023"><bdi class="secno">3.6 </bdi>ecdsa-sd-2023</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#create-base-proof-ecdsa-sd-2023"><bdi class="secno">3.6.1 </bdi>Create Base Proof (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#base-proof-transformation-ecdsa-sd-2023"><bdi class="secno">3.6.2 </bdi>Base Proof Transformation (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#base-proof-hashing-ecdsa-sd-2023"><bdi class="secno">3.6.3 </bdi>Base Proof Hashing (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#base-proof-configuration-ecdsa-sd-2023"><bdi class="secno">3.6.4 </bdi>Base Proof Configuration (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#base-proof-serialization-ecdsa-sd-2023"><bdi class="secno">3.6.5 </bdi>Base Proof Serialization (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#add-derived-proof-ecdsa-sd-2023"><bdi class="secno">3.6.6 </bdi>Add Derived Proof (ecdsa-sd-2023)</a></li><li class="tocline"><a class="tocxref" href="#verify-derived-proof-ecdsa-sd-2023"><bdi class="secno">3.6.7 </bdi>Verify Derived Proof (ecdsa-sd-2023)</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#security-considerations"><bdi class="secno">4. </bdi>Security Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#choice-of-ecdsa-and-parameters"><bdi class="secno">4.1 </bdi>Choice of ECDSA and Parameters</a></li><li class="tocline"><a class="tocxref" href="#implementation-considerations-for-ecdsa-algorithms"><bdi class="secno">4.2 </bdi>Implementation Considerations for ECDSA Algorithms</a></li><li class="tocline"><a class="tocxref" href="#key-management"><bdi class="secno">4.3 </bdi>Key Management</a></li></ol></li><li class="tocline"><a class="tocxref" href="#privacy-considerations"><bdi class="secno">5. </bdi>Privacy Considerations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#unlinkable-disclosure"><bdi class="secno">5.1 </bdi>Unlinkable Disclosure</a></li></ol></li><li class="tocline"><a class="tocxref" href="#test-vectors"><bdi class="secno">A. </bdi>Test Vectors</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#representation-ecdsa-rdfc-2019-with-curve-p-256"><bdi class="secno">A.1 </bdi>Representation: ecdsa-rdfc-2019, with curve P-256</a></li><li class="tocline"><a class="tocxref" href="#representation-ecdsa-rdfc-2019-with-curve-p-384"><bdi class="secno">A.2 </bdi>Representation: ecdsa-rdfc-2019, with curve P-384</a></li><li class="tocline"><a class="tocxref" href="#representation-ecdsa-jcs-2019-with-curve-p-256"><bdi class="secno">A.3 </bdi>Representation: ecdsa-jcs-2019 with curve P-256</a></li><li class="tocline"><a class="tocxref" href="#representation-ecdsa-jcs-2019-with-curve-p-384"><bdi class="secno">A.4 </bdi>Representation: ecdsa-jcs-2019 with curve P-384</a></li><li class="tocline"><a class="tocxref" href="#representation-ecdsa-sd-2023"><bdi class="secno">A.5 </bdi>Representation: ecdsa-sd-2023</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#base-proof"><bdi class="secno">A.5.1 </bdi>Base Proof</a></li><li class="tocline"><a class="tocxref" href="#derived-proof"><bdi class="secno">A.5.2 </bdi>Derived Proof</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#revision-history"><bdi class="secno">B. </bdi>Revision History</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">C. </bdi>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">D. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">D.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">D.2 </bdi>Informative references</a></li></ol></li></ol></nav>

    <section id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div>
      
      <p>
This specification defines a cryptographic suite for the purpose of creating,
and verifying proofs for ECDSA signatures in conformance with the
Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification. ECDSA signatures are
specified in [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] with elliptic curves P-256 and P-384 specified in
[<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-186" title="Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters">NIST-SP-800-186</a></cite>]. [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] includes the <em>deterministic</em> ECDSA
algorithm which is also specified in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6979" title="Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)">RFC6979</a></cite>].
      </p>

      <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class="">
        <p>
The elliptic curves P-256 and P-384 of [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-186" title="Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters">NIST-SP-800-186</a></cite>] are respectively referred
to as <em>secp256r1</em> and <em>secp384r1</em> in [<cite><a class="bibref" data-link-type="biblio" href="#bib-secg2" title="SEC 2: Recommended Elliptic Curve Domain Parameters">SECG2</a></cite>]. This notation is
sometimes also used by ECDSA software libraries.
        </p>
        <p>
Developers are cautioned to not confuse <em>secp256<b>r</b>1</em> terms with
<em>secp256<b>k</b>1</em> terms; the latter are from a third, <em>different</em>,
elliptic curve, that is not used by this specification. ECDSA software libraries
might not implement all of these curves, so developers need to take care when
choosing an ECDSA software library for their implementation.
        </p>
      </div></div>

      <p>
This specification uses either the RDF Dataset Canonicalization Algorithm
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] or the JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] to transform the
input document into its canonical form. It uses one of two mechanisms to digest
and sign: SHA-256 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] as the message digest algorithm and ECDSA with
Curve P-256 as the signature algorithm, or SHA-384 [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] as the message
digest algorithm and ECDSA with Curve P-384 as the signature algorithm.
      </p>

      <section id="terminology"><div class="header-wrapper"><h3 id="x1-1-terminology"><bdi class="secno">1.1 </bdi>Terminology</h3><a class="self-link" href="#terminology" aria-label="Permalink for Section 1.1"></a></div>
        

        <p>
Terminology used throughout this document is defined in the
<a href="https://www.w3.org/TR/vc-data-integrity/#terminology">Terminology</a> section of the
<cite><a data-matched-text="[[[VC-DATA-INTEGRITY]]]" href="https://www.w3.org/TR/vc-data-integrity/">Verifiable Credential Data Integrity 1.0</a></cite> specification.
        </p>

      </section>

      <section id="conformance"><div class="header-wrapper"><h3 id="x1-2-conformance"><bdi class="secno">1.2 </bdi>Conformance</h3><a class="self-link" href="#conformance" aria-label="Permalink for Section 1.2"></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, and <em class="rfc2119">SHOULD</em> in this document
        are to be interpreted as described in
        <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p>
        <p>
A <dfn id="dfn-conforming-proof" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conforming proof</dfn> is any concrete expression of the data model
that complies with the normative statements in this specification. Specifically,
all relevant normative statements in Sections
<a href="#data-model" data-matched-text="[[[#data-model]]]" class="sec-ref"><bdi class="secno">2. </bdi>Data Model</a> and <a href="#algorithms" data-matched-text="[[[#algorithms]]]" class="sec-ref"><bdi class="secno">3. </bdi>Algorithms</a>
of this document <em class="rfc2119">MUST</em> be enforced.
        </p>

        <p>
A <dfn class="lint-ignore" id="dfn-conforming-processor" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">conforming processor</dfn> is any algorithm realized
as software and/or hardware that generates or consumes a
<a data-link-type="dfn|abstract-op" href="#dfn-conforming-proof" class="internalDFN" id="ref-for-dfn-conforming-proof-1">conforming proof</a>. Conforming processors <em class="rfc2119">MUST</em> produce errors when
non-conforming documents are consumed.
        </p>
	<p>
This document contains examples of JSON and JSON-LD data. Some of these examples
are invalid JSON, as they include features such as inline comments (<code>//</code>)
explaining certain portions and ellipses (<code>...</code>) indicating the omission of
information that is irrelevant to the example. Such parts need to be
removed if implementers want to treat the examples as valid JSON or JSON-LD.
        </p>
      </section>

    </section>

    <section id="data-model"><div class="header-wrapper"><h2 id="x2-data-model"><bdi class="secno">2. </bdi>Data Model</h2><a class="self-link" href="#data-model" aria-label="Permalink for Section 2."></a></div>
      

      <p>
The following sections outline the data model that is used by this specification
to express verification methods, such as cryptographic public keys, and
data integrity proofs, such as digital signatures.
      </p>

      <section id="verification-methods"><div class="header-wrapper"><h3 id="x2-1-verification-methods"><bdi class="secno">2.1 </bdi>Verification Methods</h3><a class="self-link" href="#verification-methods" aria-label="Permalink for Section 2.1"></a></div>
        

        <p>
These verification methods are used to verify Data Integrity Proofs
[<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] produced using Elliptic Curve cryptographic key material
that is compliant with [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>]. The encoding formats for these key types
are provided in this section. Lossless cryptographic key transformation
processes that result in equivalent cryptographic key material <em class="rfc2119">MAY</em> be used
during the processing of digital signatures.
        </p>

        <section id="multikey"><div class="header-wrapper"><h4 id="x2-1-1-multikey"><bdi class="secno">2.1.1 </bdi>Multikey</h4><a class="self-link" href="#multikey" aria-label="Permalink for Section 2.1.1"></a></div>
          

          <p>
The <a href="https://www.w3.org/TR/controller-document/#Multikey">Multikey format</a>, defined in
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>, is used to express public keys for the cryptographic
suites defined in this specification.
          </p>

          <p>
The <code>publicKeyMultibase</code> property represents a Multibase-encoded Multikey
expression of a P-256 or P-384 public key.
          </p>

          <p>
The <code>publicKeyMultibase</code> value of the verification method <em class="rfc2119">MUST</em> start with the
base-58-btc prefix (<code>z</code>), as defined in the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">Multibase section</a> of
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. A Multibase-encoded ECDSA 256-bit public key value or
an ECDSA 384-bit public key value follows, as defined in the
<a href="https://www.w3.org/TR/controller-document/#Multikey">Multikey section</a> of
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. Any other encoding <em class="rfc2119">MUST NOT</em> be allowed.
          </p>

          <p class="advisement">
Developers are advised to not accidentally publish a representation of a private
key. Implementations of this specification will raise errors in the event of a
Multicodec value other than <code>0x1200</code> or <code>0x1201</code> being used in a
<code>publicKeyMultibase</code> value.
          </p>

          <div class="example" id="example-an-p-256-public-key-encoded-as-a-multikey">
        <div class="marker">
    <a class="self-link" href="#example-an-p-256-public-key-encoded-as-a-multikey">Example<bdi> 1</bdi></a><span class="example-title">: An P-256 public key encoded as a Multikey</span>
  </div> <pre class="nohighlight">{
  "id": "https://example.com/issuer/123#key-0",
  "type": "Multikey",
  "controller": "https://example.com/issuer/123",
  "publicKeyMultibase": "zDnaerx9CtbPJ1q36T5Ln5wYt3MQYeGRG5ehnPAmxcf5mDZpv"
}</pre>
      </div>

          <div class="example" id="example-an-p-384-public-key-encoded-as-a-multikey">
        <div class="marker">
    <a class="self-link" href="#example-an-p-384-public-key-encoded-as-a-multikey">Example<bdi> 2</bdi></a><span class="example-title">: An P-384 public key encoded as a Multikey</span>
  </div> <pre class="nohighlight">{
  "id": "https://example.com/issuer/123#key-0",
  "type": "Multikey",
  "controller": "https://example.com/issuer/123",
  "publicKeyMultibase": "z82LkvCwHNreneWpsgPEbV3gu1C6NFJEBg4srfJ5gdxEsMGRJ
    Uz2sG9FE42shbn2xkZJh54"
}</pre>
      </div>

          <div class="example" id="example-two-public-keys-p-256-and-p-384-encoded-as-multikeys-in-a-controller-document">
        <div class="marker">
    <a class="self-link" href="#example-two-public-keys-p-256-and-p-384-encoded-as-multikeys-in-a-controller-document">Example<bdi> 3</bdi></a><span class="example-title">: Two public keys (P-256 and P-384)
            encoded as Multikeys in a controller document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/multikey/v1"
  ],
  "id": "did:example:123",
  "verificationMethod": [{
    "id": "https://example.com/issuer/123#key-1",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "zDnaerx9CtbPJ1q36T5Ln5wYt3MQYeGRG5ehnPAmxcf5mDZpv"
  }, {
    "id": "https://example.com/issuer/123#key-2",
    "type": "Multikey",
    "controller": "https://example.com/issuer/123",
    "publicKeyMultibase": "z82LkvCwHNreneWpsgPEbV3gu1C6NFJEBg4srfJ5gdxEsMGRJ
      Uz2sG9FE42shbn2xkZJh54"
  }],
  "authentication": [
    "did:example:123#key-1"
  ],
  "assertionMethod": [
    "did:example:123#key-2"
  ],
  "capabilityDelegation": [
    "did:example:123#key-2"
  ],
  "capabilityInvocation": [
    "did:example:123#key-2"
  ]
}</pre>
      </div>

          <p>
The <code>secretKeyMultibase</code> property represents a Multibase-encoded Multikey
expression of a P-256 or P-384 secret key (also sometimes referred to as a
private key).
          </p>

          <p>
The <code>secretKeyMultibase</code> value of the verification method <em class="rfc2119">MUST</em> start with the
base-58-btc prefix (<code>z</code>), as defined in the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">Multibase section</a> of
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. A Multibase-encoded ECDSA 256-bit secret key value or
an ECDSA 384-bit secret key value follows, as defined in the
<a href="https://www.w3.org/TR/controller-document/#Multikey">Multikey section</a> of
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. Any other encoding <em class="rfc2119">MUST NOT</em> be allowed.
          </p>


          <p class="advisement">
            Developers are advised to prevent accidental publication of a representation of a secret
            key, and to not export the <code>secretKeyMultibase</code> property by default, when serializing
            key pairs as Multikey.
          </p>

        </section>

      </section>

      <section id="proof-representations"><div class="header-wrapper"><h3 id="x2-2-proof-representations"><bdi class="secno">2.2 </bdi>Proof Representations</h3><a class="self-link" href="#proof-representations" aria-label="Permalink for Section 2.2"></a></div>
        

        <p>
This section details the proof representation formats that are defined by
this specification.
        </p>

        <section id="dataintegrityproof"><div class="header-wrapper"><h4 id="x2-2-1-dataintegrityproof"><bdi class="secno">2.2.1 </bdi>DataIntegrityProof</h4><a class="self-link" href="#dataintegrityproof" aria-label="Permalink for Section 2.2.1"></a></div>
          

          <p>
A proof contains the attributes specified in the
<a href="https://www.w3.org/TR/vc-data-integrity/#proofs">Proofs section</a>
of [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] with the following restrictions.
          </p>
          <p>
The <code>type</code> property <em class="rfc2119">MUST</em> be <code>DataIntegrityProof</code>.
          </p>
          <p>
The <code>cryptosuite</code> property <em class="rfc2119">MUST</em> be <code>ecdsa-rdfc-2019</code>,
<code>ecdsa-jcs-2019</code>, or <code>ecdsa-sd-2023</code>.
          </p>
          <p>
The value of the <code>proofValue</code> property is produced according to
the <code>cryptosuite</code> type and is specified in either
Section <a href="#create-proof-ecdsa-rdfc-2019" data-matched-text="[[[#create-proof-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.1 </bdi>Create Proof (ecdsa-rdfc-2019)</a>, or
Section <a href="#create-proof-ecdsa-jcs-2019" data-matched-text="[[[#create-proof-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.1 </bdi>Create Proof (ecdsa-jcs-2019)</a>, or
Section <a href="#create-base-proof-ecdsa-sd-2023" data-matched-text="[[[#create-base-proof-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.1 </bdi>Create Base Proof (ecdsa-sd-2023)</a>, or
Section <a href="#add-derived-proof-ecdsa-sd-2023" data-matched-text="[[[#add-derived-proof-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.6 </bdi>Add Derived Proof (ecdsa-sd-2023)</a>.
          </p>

          <div class="example" id="example-an-ecdsa-p-256-digital-signature-expressed-as-a-dataintegrityproof">
        <div class="marker">
    <a class="self-link" href="#example-an-ecdsa-p-256-digital-signature-expressed-as-a-dataintegrityproof">Example<bdi> 4</bdi></a><span class="example-title">: An ECDSA P-256 digital signature expressed as a
              DataIntegrityProof</span>
  </div> <pre class="nohighlight">{
  "@context": [
    {"myWebsite": "https://vocabulary.example/myWebsite"},
    "https://www.w3.org/ns/credentials/v2"
  ],
  "myWebsite": "https://hello.world.example/",
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-rdfc-2019",
    "created": "2023-02-24T23:36:38Z",
    "verificationMethod": "https://vc.example/issuers/5678#zDnaepBuvsQ8cpsWrVKw8
      fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "z2iAR3F2Sk3mWfYyrinKzSQpSbvfxnz9kkv7roxxumB5RZDP9JUw5QAXuchUd
      huiwE18hyyZTjiEreKmhH3oj9Q8"
  }
}</pre>
      </div>

        </section>
      </section>
    </section>

    <section id="algorithms"><div class="header-wrapper"><h2 id="x3-algorithms"><bdi class="secno">3. </bdi>Algorithms</h2><a class="self-link" href="#algorithms" aria-label="Permalink for Section 3."></a></div>
      

      <p>
The following section describes multiple Data Integrity cryptographic suites
that utilize the Elliptic Curve Digital Signature Algorithm (ECDSA)
[<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>]. When generating ECDSA signatures, the signature value <em class="rfc2119">MUST</em> be
expressed according to section 7 of [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4754" title="IKE and IKEv2 Authentication Using the Elliptic Curve Digital Signature Algorithm (ECDSA)">RFC4754</a></cite>] (sometimes referred to as the
IEEE P1363 format) and encoded according to the specific cryptosuite proof
generation algorithm. All ECDSA signatures <em class="rfc2119">SHOULD</em> use the <em>deterministic</em>
variant of the algorithm defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>].
      </p>

      <p>
Implementations <em class="rfc2119">SHOULD</em> fetch and cache verification method information as
early as possible when adding or verifying proofs. Parameters passed to
functions in this section use information from the verification method
— such as the public key size — to determine function parameters
— such as the cryptographic hashing algorithm.
      </p>

      <p id="canon-and-hash">
When the RDF Dataset Canonicalization Algorithm (RDFC-1.0)&nbsp;[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] is used
with ECDSA algorithms, the cryptographic hashing function used by RDFC-1.0 is
chosen based on the size of the associated public key. For P-256 keys, the
default hashing function, SHA-2 with 256 bits of output, <em class="rfc2119">MUST</em> be used. For P-384
keys, SHA-2 with 384-bits of output <em class="rfc2119">MUST</em> be used, specified via the RDFC-1.0
<a href="https://www.w3.org/TR/rdf-canon/#dfn-hash-algorithm">implementation-specific parameter</a>.
      </p>

      <p class="advisement">
When the RDF Dataset Canonicalization Algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] is used,
implementations of that algorithm will detect
<a href="https://www.w3.org/TR/rdf-canon/#dataset-poisoning">dataset poisoning</a>
by default, and abort processing upon detection.
      </p>

      <section id="instantiate-cryptosuite"><div class="header-wrapper"><h3 id="x3-1-instantiate-cryptosuite"><bdi class="secno">3.1 </bdi>Instantiate Cryptosuite</h3><a class="self-link" href="#instantiate-cryptosuite" aria-label="Permalink for Section 3.1"></a></div>
        

        <p>
This algorithm is used to configure a cryptographic suite to be used by the
<a href="https://www.w3.org/TR/vc-data-integrity/#add-proof">Add Proof</a> and
<a href="https://www.w3.org/TR/vc-data-integrity/#verify-proof">Verify Proof</a>
functions in <cite><a data-matched-text="[[[VC-DATA-INTEGRITY]]]" href="https://www.w3.org/TR/vc-data-integrity/">Verifiable Credential Data Integrity 1.0</a></cite>. The algorithm takes an options object
(<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>) as input and returns a <a data-link-type="dfn" data-lt="data integrity cryptographic suite instance" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-cryptographic-suite-instance">cryptosuite instance</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> <var>cryptosuite</var>).
        </p>

        <ol class="algorithm">
          <li>
Initialize <var>cryptosuite</var> to an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a>.
          </li>
          <li>
If <var>options</var>.<var>type</var> does not equal <code>DataIntegrityProof</code>, return <var>cryptosuite</var>.
          </li>
          <li>
If <var>options</var>.<var>cryptosuite</var> is <code>ecdsa-rdfc-2019</code> then:
            <ol class="algorithm">
              <li>
Set <var>cryptosuite</var>.<var>createProof</var> to the algorithm in Section
<a href="#create-proof-ecdsa-rdfc-2019" data-matched-text="[[[#create-proof-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.1 </bdi>Create Proof (ecdsa-rdfc-2019)</a>.
              </li>
              <li>
Set <var>cryptosuite</var>.<var>verifyProof</var> to the algorithm in Section
<a href="#proof-verification-ecdsa-rdfc-2019" data-matched-text="[[[#proof-verification-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.7 </bdi>Proof Verification (ecdsa-rdfc-2019)</a>.
              </li>
            </ol>
          </li>
          <li>
If <var>options</var>.<var>cryptosuite</var> is <code>ecdsa-jcs-2019</code> then:
            <ol class="algorithm">
              <li>
Set <var>cryptosuite</var>.<var>createProof</var> to the algorithm in Section
<a href="#create-proof-ecdsa-jcs-2019" data-matched-text="[[[#create-proof-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.1 </bdi>Create Proof (ecdsa-jcs-2019)</a>.
              </li>
              <li>
Set <var>cryptosuite</var>.<var>verifyProof</var> to the algorithm in Section
<a href="#proof-verification-ecdsa-jcs-2019" data-matched-text="[[[#proof-verification-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.7 </bdi>Proof Verification (ecdsa-jcs-2019)</a>.
              </li>
            </ol>
          </li>
          <li>
If <var>options</var>.<var>cryptosuite</var> is <code>ecdsa-sd-2023</code> then:
            <ol class="algorithm">
              <li>
Set <var>cryptosuite</var>.<var>createProof</var> to the algorithm in Section
<a href="#create-base-proof-ecdsa-sd-2023" data-matched-text="[[[#create-base-proof-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.1 </bdi>Create Base Proof (ecdsa-sd-2023)</a>.
              </li>
              <li>
Set <var>cryptosuite</var>.<var>verifyProof</var> to the algorithm in Section
<a href="#verify-derived-proof-ecdsa-sd-2023" data-matched-text="[[[#verify-derived-proof-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.7 </bdi>Verify Derived Proof (ecdsa-sd-2023)</a>.
              </li>
            </ol>
          </li>
          <li>
Return <var>cryptosuite</var>.
          </li>
        </ol>

      </section>

      <section id="ecdsa-rdfc-2019"><div class="header-wrapper"><h3 id="x3-2-ecdsa-rdfc-2019"><bdi class="secno">3.2 </bdi>ecdsa-rdfc-2019</h3><a class="self-link" href="#ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2"></a></div>
        

        <p>
The <code>ecdsa-rdfc-2019</code> cryptographic suite takes an input document, canonicalizes
the document using the <cite><a data-matched-text="[[[RDF-CANON]]]" href="https://www.w3.org/TR/rdf-canon/">RDF Dataset Canonicalization</a></cite>
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], and then cryptographically hashes and signs the output
resulting in the production of a data integrity proof. The algorithms in this
section also include the verification of such a data integrity proof.
        </p>

        <section id="create-proof-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-1-create-proof-ecdsa-rdfc-2019"><bdi class="secno">3.2.1 </bdi>Create Proof (ecdsa-rdfc-2019)</h4><a class="self-link" href="#create-proof-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.1"></a></div>
          

          <p>
The following algorithm specifies how to create a <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> given
an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a>. Required inputs are an
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>unsecuredDocument</var>), and a set of proof
options (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>). A <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>), or an error,
is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proof</var> be a clone of the proof options, <var>options</var>.
            </li>
            <li>
Let <var>proofConfig</var> be the result of running the algorithm in
Section <a href="#proof-configuration-ecdsa-rdfc-2019" data-matched-text="[[[#proof-configuration-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.5 </bdi>Proof Configuration (ecdsa-rdfc-2019)</a> with
<var>options</var> passed as a parameter.
            </li>
            <li>
Let <var>transformedData</var> be the result of running the algorithm in Section <a href="#transformation-ecdsa-rdfc-2019" class="sec-ref"><bdi class="secno">3.2.3 </bdi>Transformation (ecdsa-rdfc-2019)</a> with <var>unsecuredDocument</var>,
<var>proofConfig</var>, and <var>options</var> passed as parameters.
            </li>
            <li>
Let <var>hashData</var> be the result of running the algorithm in Section
<a href="#hashing-ecdsa-rdfc-2019" data-matched-text="[[[#hashing-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.4 </bdi>Hashing (ecdsa-rdfc-2019)</a> with <var>transformedData</var> and <var>proofConfig</var>
passed as a parameters.
            </li>
            <li>
Let <var>proofBytes</var> be the result of running the algorithm in Section
<a href="#proof-serialization-ecdsa-rdfc-2019" data-matched-text="[[[#proof-serialization-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.6 </bdi>Proof Serialization (ecdsa-rdfc-2019)</a> with <var>hashData</var> and
<var>options</var> passed as parameters.
            </li>
            <li>
Let <var>proof</var>.<var>proofValue</var> be a <a href="https://www.w3.org/TR/controller-document/#multibase-0">
base58-btc-encoded Multibase value</a> of the <var>proofBytes</var>.
            </li>
            <li>
Return <var>proof</var> as the <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a>.
            </li>
          </ol>

        </section>

        <section id="verify-proof-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-2-verify-proof-ecdsa-rdfc-2019"><bdi class="secno">3.2.2 </bdi>Verify Proof (ecdsa-rdfc-2019)</h4><a class="self-link" href="#verify-proof-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.2"></a></div>
          

          <p>
The following algorithm specifies how to verify a <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> given
an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-secured-data-document">secured data document</a>. Required inputs are an
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-secured-data-document">secured data document</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>securedDocument</var>). This algorithm returns
a <dfn id="dfn-verification-result" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verification result</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> whose
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a> are:
          </p>
          <dl>
            <dt><dfn data-dfn-for="verification result" id="dfn-verified" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verified</dfn></dt>
            <dd><code>true</code> or <code>false</code></dd>
            <dt><dfn data-dfn-for="verification result" id="dfn-verifieddocument" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">verifiedDocument</dfn></dt>
            <dd>
<a href="https://infra.spec.whatwg.org/#nulls">Null</a>, if <a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-1">verified</a> is
<code>false</code>; otherwise, an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a>
            </dd>
          </dl>

          <ol class="algorithm">
          <li>
Let <var>unsecuredDocument</var> be a copy of <var>securedDocument</var> with
the <code>proof</code> value removed.
          </li>
          <li>
Let <var>proofConfig</var> be a copy of <var>securedDocument</var>.<var>proof</var> with <code>proofValue</code>
removed.
          </li>
          <li>
Let <var>proofBytes</var> be the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">Multibase decoded base58-btc
value</a> in <var>securedDocument</var>.<var>proof</var>.<var>proofValue</var>.
          </li>
          <li>
Let <var>transformedData</var> be the result of running the algorithm in Section <a href="#transformation-ecdsa-rdfc-2019" class="sec-ref"><bdi class="secno">3.2.3 </bdi>Transformation (ecdsa-rdfc-2019)</a> with <var>unsecuredDocument</var> and
<var>proofConfig</var> passed as parameters.
          </li>
          <li>
Let <var>hashData</var> be the result of running the algorithm in Section
<a href="#hashing-ecdsa-rdfc-2019" data-matched-text="[[[#hashing-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.4 </bdi>Hashing (ecdsa-rdfc-2019)</a> with <var>transformedData</var> and <var>proofConfig</var>
passed as a parameters.
          </li>
          <li>
Let <var data-type="boolean">verified</var> be the result of running the algorithm in Section
<a href="#proof-verification-ecdsa-rdfc-2019" data-matched-text="[[[#proof-verification-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.7 </bdi>Proof Verification (ecdsa-rdfc-2019)</a> algorithm on <var>hashData</var>,
<var>proofBytes</var>, and <var>proofConfig</var>.
            </li>
            <li>
Return a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-1">verification result</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>:
              <dl data-link-for="verification result">
                <dt><a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-2">verified</a></dt>
                <dd><var data-type="boolean">verified</var></dd>
                <dt><a data-link-type="dfn|abstract-op" href="#dfn-verifieddocument" class="internalDFN" id="ref-for-dfn-verifieddocument-1">verifiedDocument</a></dt>
                <dd>
<var>unsecuredDocument</var> if <var data-type="boolean">verified</var> is <code>true</code>, otherwise <a href="https://infra.spec.whatwg.org/#nulls">Null</a></dd>
              </dl>
            </li>
          </ol>

        </section>

        <section id="transformation-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-3-transformation-ecdsa-rdfc-2019"><bdi class="secno">3.2.3 </bdi>Transformation (ecdsa-rdfc-2019)</h4><a class="self-link" href="#transformation-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.3"></a></div>
          

          <p>
The following algorithm specifies how to transform an unsecured input document
into a transformed document that is ready to be provided as input to the
hashing algorithm in Section <a href="#hashing-ecdsa-rdfc-2019" data-matched-text="[[[#hashing-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.4 </bdi>Hashing (ecdsa-rdfc-2019)</a>.
          </p>

          <p>
Required inputs to this algorithm are an
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">
unsecured data document</a> (<var>unsecuredDocument</var>) and
transformation options (<var>options</var>). The
transformation options <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and a cryptosuite
identifier (<var>cryptosuite</var>). A <em>transformed data document</em> is
produced as output. Whenever this algorithm encodes strings, it <em class="rfc2119">MUST</em> use UTF-8
encoding.
          </p>

          <ol class="algorithm">
            <li>
If <var>options</var>.<var>type</var> is not set to the string
<code>DataIntegrityProof</code> and <var>options</var>.<var>cryptosuite</var> is not
set to the string <code>ecdsa-rdfc-2019</code>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_TRANSFORMATION_ERROR">PROOF_TRANSFORMATION_ERROR</a>.
            </li>
            <li>
Let <var>canonicalDocument</var> be the result of converting <var>unsecuredDocument</var> to
<a href="https://www.w3.org/TR/json-ld11-api/#expansion-algorithm">JSON-LD expanded form</a>
and then <a href="https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm">
to RDF statements</a>, applying the <a href="https://www.w3.org/TR/rdf-canon/#canon-algorithm">RDF Dataset Canonicalization
Algorithm</a>&nbsp;[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] to the result, and then serializing the result to a
<a href="https://www.w3.org/TR/rdf-canon/#dfn-serialized-canonical-form">serialized canonical form</a>&nbsp;[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>].
For canonicalization, one is expected to use a hash algorithm that has an appropriate security level for
the curve used; see <a href="#canon-and-hash">further details</a>.
            </li>
            <li>
Return <var>canonicalDocument</var> as the <em>transformed data document</em>.
            </li>
          </ol>
        </section>

        <section id="hashing-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-4-hashing-ecdsa-rdfc-2019"><bdi class="secno">3.2.4 </bdi>Hashing (ecdsa-rdfc-2019)</h4><a class="self-link" href="#hashing-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.4"></a></div>
          

          <p>
The following algorithm specifies how to cryptographically hash a
<em>transformed data document</em> and <em>proof configuration</em>
into cryptographic hash data that is ready to be provided as input to the
algorithms in Section <a href="#proof-serialization-ecdsa-rdfc-2019" data-matched-text="[[[#proof-serialization-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.6 </bdi>Proof Serialization (ecdsa-rdfc-2019)</a> or
Section <a href="#proof-verification-ecdsa-rdfc-2019" data-matched-text="[[[#proof-verification-ecdsa-rdfc-2019]]]" class="sec-ref"><bdi class="secno">3.2.7 </bdi>Proof Verification (ecdsa-rdfc-2019)</a>. One must use the hash
algorithm appropriate in security level to the curve used, i.e., for curve
P-256 one uses SHA-256 and for curve P-384 one uses SHA-384.
          </p>

          <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<var>transformedDocument</var>) and <em>canonical proof configuration</em>
(<var>canonicalProofConfig</var>). A single <em>hash data</em> value represented as
series of bytes is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>transformedDocumentHash</var> be the result of applying the
SHA-256 (SHA-2 with 256-bit output) or SHA-384 (SHA-2 with 384-bit output)
cryptographic hashing algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] to the
respective curve P-256 or curve P-384 <var>transformedDocument</var>.
Respective <var>transformedDocumentHash</var> will be exactly 32 or 48 bytes
in size.
            </li>
            <li>
Let <var>proofConfigHash</var> be the result of applying the
SHA-256 (SHA-2 with 256-bit output) or SHA-384 (SHA-2 with 384-bit output)
cryptographic hashing algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] to the respective curve P-256 or curve P-384
<var>canonicalProofConfig</var>. Respective <var>proofConfigHash</var>
will be exactly 32 or 48 bytes in size.
            </li>
            <li>
Let <var>hashData</var> be the result of joining <var>proofConfigHash</var> (the
first hash) with <var>transformedDocumentHash</var> (the second hash).
            </li>
            <li>
Return <var>hashData</var> as the <em>hash data</em>.
            </li>
          </ol>

        </section>

        <section id="proof-configuration-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-5-proof-configuration-ecdsa-rdfc-2019"><bdi class="secno">3.2.5 </bdi>Proof Configuration (ecdsa-rdfc-2019)</h4><a class="self-link" href="#proof-configuration-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.5"></a></div>
          

          <p>
The following algorithm specifies how to generate a
<em>proof configuration</em> from a set of <em>proof options</em>
that is used as input to the <a href="#hashing-ecdsa-rdfc-2019">proof hashing algorithm</a>.
          </p>

          <p>
The required inputs to this algorithm are <em>proof options</em>
(<var>options</var>). The <em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier
for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MUST</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A <em>proof configuration</em>
object is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proofConfig</var> be a clone of the <var>options</var> object.
            </li>
            <li>
If <var>proofConfig</var>.<var>type</var> is not set to <code>DataIntegrityProof</code> and/or
<var>proofConfig</var>.<var>cryptosuite</var> is not set to <code>ecdsa-rdfc-2019</code>, an
error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
If <var>proofConfig</var>.<var>created</var> is set and if the value is not a
valid [<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema11-2" title="W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes">XMLSCHEMA11-2</a></cite>] datetime, an error <em class="rfc2119">MUST</em> be
raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
Set <var>proofConfig</var>.<var>@context</var> to
<var>unsecuredDocument</var>.<var>@context</var>.
            </li>
            <li>
Let <var>canonicalProofConfig</var> be the result of applying the
<cite><a data-matched-text="[[[RDF-CANON]]]" href="https://www.w3.org/TR/rdf-canon/">RDF Dataset Canonicalization</a></cite> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] to the <var>proofConfig</var>.
            </li>
            <li>
Return <var>canonicalProofConfig</var>.
            </li>
          </ol>

        </section>

        <section id="proof-serialization-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-6-proof-serialization-ecdsa-rdfc-2019"><bdi class="secno">3.2.6 </bdi>Proof Serialization (ecdsa-rdfc-2019)</h4><a class="self-link" href="#proof-serialization-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.6"></a></div>
          

          <p>
The following algorithm specifies how to serialize a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification,
<a href="https://www.w3.org/TR/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>) and
<em>proof options</em> (<var>options</var>). The
<em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MAY</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A single <em>digital proof</em> value
represented as series of bytes is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>privateKeyBytes</var> be the result of retrieving the
private key bytes (or a signing interface enabling the use of the private key
bytes) associated with the verification method identified by the
<var>options</var>.<var>verificationMethod</var> value.
            </li>
            <li>
Let <var>proofBytes</var> be the result of applying the Elliptic Curve Digital
Signature Algorithm (ECDSA) [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>], with <var>hashData</var> as the data
to be signed using the private key specified by <var>privateKeyBytes</var>.
<var>proofBytes</var> will be exactly 64 bytes in size for a P-256 key, and
96 bytes in size for a P-384 key.
            </li>
            <li>
Return <var>proofBytes</var> as the <em>digital proof</em>.
            </li>
          </ol>

        </section>

        <section id="proof-verification-ecdsa-rdfc-2019"><div class="header-wrapper"><h4 id="x3-2-7-proof-verification-ecdsa-rdfc-2019"><bdi class="secno">3.2.7 </bdi>Proof Verification (ecdsa-rdfc-2019)</h4><a class="self-link" href="#proof-verification-ecdsa-rdfc-2019" aria-label="Permalink for Section 3.2.7"></a></div>
          

          <p>
The following algorithm specifies how to verify a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification,
<a href="https://www.w3.org/TR/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>),
a digital signature (<var>proofBytes</var>) and
proof options (<var>options</var>). A <em>verification result</em>
represented as a boolean value is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>publicKeyBytes</var> be the result of retrieving the
public key bytes associated with the
<var>options</var>.<var>verificationMethod</var> value as described in the
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite> specification,
<a href="https://www.w3.org/TR/controller-document/#retrieve-verification-method">
Section: Retrieve Verification Method</a>.
            </li>
            <li>
Let <var>verificationResult</var> be the result of applying the verification
algorithm Elliptic Curve Digital Signature Algorithm (ECDSA) [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>],
with <var>hashData</var> as the data to be verified against the
<var>proofBytes</var> using the public key specified by
<var>publicKeyBytes</var>.
            </li>
            <li>
Return <var>verificationResult</var> as the <em>verification result</em>.
            </li>
          </ol>

        </section>
      </section>
      <section id="ecdsa-jcs-2019"><div class="header-wrapper"><h3 id="x3-3-ecdsa-jcs-2019"><bdi class="secno">3.3 </bdi>ecdsa-jcs-2019</h3><a class="self-link" href="#ecdsa-jcs-2019" aria-label="Permalink for Section 3.3"></a></div>
        

        <p>
The <code>ecdsa-jcs-2019</code> cryptographic suite takes an input document, canonicalizes
the document using the JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>], and then
cryptographically hashes and signs the output
resulting in the production of a data integrity proof. The algorithms in this
section also include the verification of such a data integrity proof.
        </p>

        <section id="create-proof-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-1-create-proof-ecdsa-jcs-2019"><bdi class="secno">3.3.1 </bdi>Create Proof (ecdsa-jcs-2019)</h4><a class="self-link" href="#create-proof-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.1"></a></div>
          
          <p>
The following algorithm specifies how to create a <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> given
an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a>. Required inputs are an
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>unsecuredDocument</var>), and a set of proof
options (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>). A <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>), or an error,
is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proof</var> be a clone of the proof options, <var>options</var>.
            </li>
            <li>
If <var>unsecuredDocument</var>.<var>@context</var> is present, set
<var>proof</var>.<var>@context</var> to
<var>unsecuredDocument</var>.<var>@context</var>.
            </li>
            <li>
Let <var>proofConfig</var> be the result of running the algorithm in
Section <a href="#proof-configuration-ecdsa-jcs-2019" data-matched-text="[[[#proof-configuration-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.5 </bdi>Proof Configuration (ecdsa-jcs-2019)</a> with
<var>proof</var> passed as the <em>proof options</em> parameter.
            </li>
            <li>
Let <var>transformedData</var> be the result of running the algorithm in Section <a href="#transformation-ecdsa-jcs-2019" class="sec-ref"><bdi class="secno">3.3.3 </bdi>Transformation (ecdsa-jcs-2019)</a> with <var>unsecuredDocument</var>
and <var>options</var> passed as parameters.
            </li>
            <li>
Let <var>hashData</var> be the result of running the algorithm in Section
<a href="#hashing-ecdsa-jcs-2019" data-matched-text="[[[#hashing-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.4 </bdi>Hashing (ecdsa-jcs-2019)</a> with <var>transformedData</var> and <var>proofConfig</var>
passed as a parameters.
            </li>
            <li>
Let <var>proofBytes</var> be the result of running the algorithm in Section
<a href="#proof-serialization-ecdsa-jcs-2019" data-matched-text="[[[#proof-serialization-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.6 </bdi>Proof Serialization (ecdsa-jcs-2019)</a> with <var>hashData</var> and
<var>options</var> passed as parameters.
            </li>
            <li>
Let <var>proof</var>.<var>proofValue</var> be a <a href="https://www.w3.org/TR/controller-document/#multibase-0">
base58-btc-encoded Multibase value</a> of the <var>proofBytes</var>.
            </li>
            <li>
Return <var>proof</var> as the <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a>.
            </li>
          </ol>
        </section>

        <section id="verify-proof-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-2-verify-proof-ecdsa-jcs-2019"><bdi class="secno">3.3.2 </bdi>Verify Proof (ecdsa-jcs-2019)</h4><a class="self-link" href="#verify-proof-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.2"></a></div>
          
          <p>
The following algorithm specifies how to verify a <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> given
an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-secured-data-document">secured data document</a>. Required inputs are an
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-secured-data-document">secured data document</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>securedDocument</var>). This algorithm returns
a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-2">verification result</a>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct">struct</a> whose <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a> are:
          </p>

          <dl>
            <dt><a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-3">verified</a></dt>
            <dd><code>true</code> or <code>false</code></dd>
            <dt><a data-link-type="dfn|abstract-op" href="#dfn-verifieddocument" class="internalDFN" id="ref-for-dfn-verifieddocument-2">verifiedDocument</a></dt>
            <dd>
if <a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-4">verified</a> is <code>true</code>, an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a>;
otherwise <a href="https://infra.spec.whatwg.org/#nulls">Null</a>
            </dd>
          </dl>

          <ol class="algorithm">
            <li>
Let <var>unsecuredDocument</var> be a copy of <var>securedDocument</var> with the <code>proof</code> value
removed.
            </li>
            <li>
Let <var>proofOptions</var> be the result of a copy of <var>securedDocument</var>.<var>proof</var> with
<code>proofValue</code> removed.
            </li>
            <li>
Let <var>proofBytes</var> be the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">Multibase decoded base58-btc
value</a> in <var>securedDocument</var>.<var>proof</var>.<var>proofValue</var>.
            </li>
            <li>
If <var>proofOptions</var>.<var>@context</var> exists:
              <ol class="algorithm">
                <li>
Check that the <var>securedDocument</var>.<var>@context</var> starts with all values
contained in the <var>proofOptions</var>.<var>@context</var> in the same order.
Otherwise, set <var>verified</var> to <code>false</code> and skip to the last step.
                </li>
                <li>
Set <var>unsecuredDocument</var>.<var>@context</var> equal to
<var>proofOptions</var>.<var>@context</var>.
                </li>
              </ol>
            </li>
            <li>
Let <var>transformedData</var> be the result of running the algorithm in Section
<a href="#transformation-ecdsa-jcs-2019" data-matched-text="[[[#transformation-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.3 </bdi>Transformation (ecdsa-jcs-2019)</a> with <var>unsecuredDocument</var> and
<var>proofOptions</var> passed as parameters.
              </li>
            <li>
Let <var>proofConfig</var> be the result of running the algorithm in Section
<a href="#proof-configuration-ecdsa-jcs-2019" data-matched-text="[[[#proof-configuration-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.5 </bdi>Proof Configuration (ecdsa-jcs-2019)</a> with <var>proofOptions</var> passed
as the parameter.
            </li>
            <li>
Let <var>hashData</var> be the result of running the algorithm in Section
<a href="#hashing-ecdsa-jcs-2019" data-matched-text="[[[#hashing-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.4 </bdi>Hashing (ecdsa-jcs-2019)</a> with <var>transformedData</var> and <var>proofConfig</var> passed as
a parameters.
            </li>
            <li>
Let <var data-type="boolean">verified</var> be the result of running the algorithm in Section
<a href="#proof-verification-ecdsa-jcs-2019" data-matched-text="[[[#proof-verification-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.7 </bdi>Proof Verification (ecdsa-jcs-2019)</a> on <var>hashData</var>, <var>proofBytes</var>, and
<var>proofConfig</var>.
              </li>
              <li>
Return a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-3">verification result</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>:
                <dl data-link-for="verification result">
                  <dt><a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-5">verified</a></dt>
                  <dd><var data-type="boolean">verified</var></dd>
                  <dt><a data-link-type="dfn|abstract-op" href="#dfn-verifieddocument" class="internalDFN" id="ref-for-dfn-verifieddocument-3">verifiedDocument</a></dt>
                  <dd>
if <var data-type="boolean">verified</var> is <code>true</code>, <var>unsecuredDocument</var>;
otherwise, <a href="https://infra.spec.whatwg.org/#nulls">Null</a></dd>
                </dl>
              </li>
            </ol>
        </section>

        <section id="transformation-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-3-transformation-ecdsa-jcs-2019"><bdi class="secno">3.3.3 </bdi>Transformation (ecdsa-jcs-2019)</h4><a class="self-link" href="#transformation-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.3"></a></div>
          

          <p>
The following algorithm specifies how to transform an unsecured input document
into a transformed document that is ready to be provided as input to the
hashing algorithm in Section <a href="#hashing-ecdsa-jcs-2019" data-matched-text="[[[#hashing-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.4 </bdi>Hashing (ecdsa-jcs-2019)</a>.
          </p>

          <p>
Required inputs to this algorithm are an
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">
unsecured data document</a> (<var>unsecuredDocument</var>) and
transformation options (<var>options</var>). The
transformation options <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and a cryptosuite
identifier (<var>cryptosuite</var>). A <em>transformed data document</em> is
produced as output. Whenever this algorithm encodes strings, it <em class="rfc2119">MUST</em> use UTF-8
encoding.
          </p>

          <ol class="algorithm">
            <li>
If <var>options</var>.<var>type</var> is not set to the string
<code>DataIntegrityProof</code> or <var>options</var>.<var>cryptosuite</var> is not
set to the string <code>ecdsa-jcs-2019</code>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em>
convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_TRANSFORMATION_ERROR">PROOF_TRANSFORMATION_ERROR</a>.
            </li>
            <li>
Let <var>canonicalDocument</var> be the result of applying the
JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] to a JSON serialization of the
<var>unsecuredDocument</var>.
            </li>
            <li>
Return <var>canonicalDocument</var> as the <em>transformed data document</em>.
            </li>
          </ol>
        </section>

        <section id="hashing-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-4-hashing-ecdsa-jcs-2019"><bdi class="secno">3.3.4 </bdi>Hashing (ecdsa-jcs-2019)</h4><a class="self-link" href="#hashing-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.4"></a></div>
          

          <p>
The following algorithm specifies how to cryptographically hash a
<em>transformed data document</em> and <em>proof configuration</em>
into cryptographic hash data that is ready to be provided as input to the
algorithms in Section <a href="#proof-serialization-ecdsa-jcs-2019" data-matched-text="[[[#proof-serialization-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.6 </bdi>Proof Serialization (ecdsa-jcs-2019)</a> or
Section <a href="#proof-verification-ecdsa-jcs-2019" data-matched-text="[[[#proof-verification-ecdsa-jcs-2019]]]" class="sec-ref"><bdi class="secno">3.3.7 </bdi>Proof Verification (ecdsa-jcs-2019)</a>. One must use the
hash algorithm appropriate in security level to the curve used, i.e., for curve
P-256 one uses SHA-256, and for curve P-384 one uses SHA-384.
          </p>

          <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<var>transformedDocument</var>) and a <em>canonical proof configuration</em>
(<var>canonicalProofConfig</var>). A single <em>hash data</em> value represented as
series of bytes is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>transformedDocumentHash</var> be the result of applying the SHA-256
(SHA-2 with 256-bit output) or SHA-384 (SHA-2 with 384-bit output)
cryptographic hashing algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] to the
respective curve P-256 or curve P-384 <var>transformedDocument</var>.
Respective <var>transformedDocumentHash</var> will be exactly 32 or 48 bytes
in size.
            </li>
            <li>
Let <var>proofConfigHash</var> be the result of applying the SHA-256
(SHA-2 with 256-bit output) or SHA-384 (SHA-2 with 384-bit output)
cryptographic hashing algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6234" title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">RFC6234</a></cite>] to the
respective curve P-256 or curve P-384 <var>canonicalProofConfig</var>.
Respective <var>proofConfigHash</var> will be exactly 32 or 48 bytes in size.
            </li>
            <li>
Let <var>hashData</var> be the result of concatenating <var>proofConfigHash</var> (the
first hash) followed by <var>transformedDocumentHash</var> (the second hash).
            </li>
            <li>
Return <var>hashData</var> as the <em>hash data</em>.
            </li>
          </ol>

        </section>

        <section id="proof-configuration-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-5-proof-configuration-ecdsa-jcs-2019"><bdi class="secno">3.3.5 </bdi>Proof Configuration (ecdsa-jcs-2019)</h4><a class="self-link" href="#proof-configuration-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.5"></a></div>
          

          <p>
The following algorithm specifies how to generate a
<em>proof configuration</em> from a set of <em>proof options</em>
that is used as input to the
<a href="#hashing-ecdsa-jcs-2019">proof hashing algorithm</a>.
          </p>
          <p>
The required inputs to this algorithm are the <em>proof options</em>
(<var>options</var>). The <em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier
for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MUST</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A <em>proof configuration</em>
object is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proofConfig</var> be a clone of the <var>options</var> object.
            </li>
            <li>
If <var>proofConfig</var>.<var>type</var> is not set to <code>DataIntegrityProof</code> and/or
<var>proofConfig</var>.<var>cryptosuite</var> is not set to <code>ecdsa-jcs-2019</code>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
If <var>proofConfig</var>.<var>created</var> is set and if the value is not a
valid [<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema11-2" title="W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes">XMLSCHEMA11-2</a></cite>] datetime, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey
an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
Let <var>canonicalProofConfig</var> be the result of applying the
JSON Canonicalization Scheme [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8785" title="JSON Canonicalization Scheme (JCS)">RFC8785</a></cite>] to the <var>proofConfig</var>.
            </li>
            <li>
Return <var>canonicalProofConfig</var>.
            </li>
          </ol>

        </section>

        <section id="proof-serialization-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-6-proof-serialization-ecdsa-jcs-2019"><bdi class="secno">3.3.6 </bdi>Proof Serialization (ecdsa-jcs-2019)</h4><a class="self-link" href="#proof-serialization-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.6"></a></div>
          

          <p>
The following algorithm specifies how to serialize a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification,
<a href="https://www.w3.org/TR/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>) and
<em>proof options</em> (<var>options</var>). The
<em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MAY</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A single <em>digital proof</em> value
represented as series of bytes is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>privateKeyBytes</var> be the result of retrieving the
private key bytes associated with the
<var>options</var>.<var>verificationMethod</var> value.
            </li>
            <li>
Let <var>proofBytes</var> be the result of applying the Elliptic Curve Digital
Signature Algorithm (ECDSA) [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>], with <var>hashData</var> as the data
to be signed using the private key specified by <var>privateKeyBytes</var>.
<var>proofBytes</var> will be exactly 64 bytes in size for a P-256 key, and
96 bytes in size for a P-384 key.
            </li>
            <li>
Return <var>proofBytes</var> as the <em>digital proof</em>.
            </li>
          </ol>

        </section>

        <section id="proof-verification-ecdsa-jcs-2019"><div class="header-wrapper"><h4 id="x3-3-7-proof-verification-ecdsa-jcs-2019"><bdi class="secno">3.3.7 </bdi>Proof Verification (ecdsa-jcs-2019)</h4><a class="self-link" href="#proof-verification-ecdsa-jcs-2019" aria-label="Permalink for Section 3.3.7"></a></div>
          

          <p>
The following algorithm specifies how to verify a digital signature from
a set of cryptographic hash data. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification,
<a href="https://www.w3.org/TR/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>),
a digital signature (<var>proofBytes</var>), and
proof options (<var>options</var>). A <em>verification result</em>
represented as a boolean value is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>publicKeyBytes</var> be the result of retrieving the
public key bytes associated with the
<var>options</var>.<var>verificationMethod</var> value as described in the
<cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite> specification,
<a href="https://www.w3.org/TR/controller-document/#retrieve-verification-method">
Section: Retrieve Verification Method</a>.
            </li>
            <li>
Let <var>verificationResult</var> be the result of applying the verification
algorithm, Elliptic Curve Digital Signature Algorithm (ECDSA) [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>],
with <var>hashData</var> as the data to be verified against the
<var>proofBytes</var> using the public key specified by
<var>publicKeyBytes</var>.
            </li>
            <li>
Return <var>verificationResult</var> as the <em>verification result</em>.
            </li>
          </ol>

        </section>
      </section>

      <section id="selective-disclosure-functions"><div class="header-wrapper"><h3 id="x3-4-selective-disclosure-functions"><bdi class="secno">3.4 </bdi>Selective Disclosure Functions</h3><a class="self-link" href="#selective-disclosure-functions" aria-label="Permalink for Section 3.4"></a></div>
        

        <div class="issue" id="issue-container-number-2"><div role="heading" class="issue-title marker" id="h-issue-0" aria-level="4"><span>Issue 2</span><span class="issue-label">: (AT RISK) Pending implementation feedback and security reviews.</span></div><p class="">
The Working Group is seeking implementer feedback on these generalized selective
disclosure functions as well as horizonal security review on the features from
parties at <abbr title="World Wide Web Consortium">W3C</abbr> and IETF. Those reviews might result in significant changes to
these functions, migration of these functions to the core Data Integrity
specification (for use by other cryptographic suites), or the removal of the
algorithm from the specification during the Candidate Recommendation phase.
        </p></div>

        <p>
The following section contains a set of functions that are used throughout
cryptographic suites that perform selective disclosure.
        </p>

        <section id="labelreplacementcanonicalizenquads"><div class="header-wrapper"><h4 id="x3-4-1-labelreplacementcanonicalizenquads"><bdi class="secno">3.4.1 </bdi>labelReplacementCanonicalizeNQuads</h4><a class="self-link" href="#labelreplacementcanonicalizenquads" aria-label="Permalink for Section 3.4.1"></a></div>
          

          <p>
The following algorithm canonicalizes an array of N-Quad [<cite><a class="bibref" data-link-type="biblio" href="#bib-n-quads" title="RDF 1.1 N-Quads">N-QUADS</a></cite>] strings and replaces
any blank node identifiers in the canonicalized result using a label map
factory function, <var>labelMapFactoryFunction</var>. The required inputs are
an array of N-Quad strings (<var>nquads</var>), and a label map factory function
(<var>labelMapFactoryFunction</var>). Any custom options can also be passed. An
N-Quads representation of the <em>canonicalNQuads</em> as an array of N-Quad
strings, with the replaced blank node labels, and a map from the old blank node
IDs to the new blank node IDs, <em>labelMap</em>, is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Run the RDF Dataset Canonicalization Algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] on
the joined <var>nquads</var>, passing any custom options, and as output,
get the canonicalized dataset, which includes a canonical bnode identifier
map, <var>canonicalIdMap</var>.
            </li>
            <li>
Pass <var>canonicalIdMap</var> to <var>labelMapFactoryFunction</var> to produce
a new bnode identifier map, <em>labelMap</em>.
            </li>
            <li>
Use the canonicalized dataset and <em>labelMap</em> to produce the canonical
N-Quads representation as an array of N-Quad strings, <em>canonicalNQuads</em>.
            </li>
            <li>
Return an object containing <em>labelMap</em> and <em>canonicalNQuads</em>.
            </li>
          </ol>

        </section>

        <section id="labelreplacementcanonicalizejsonld"><div class="header-wrapper"><h4 id="x3-4-2-labelreplacementcanonicalizejsonld"><bdi class="secno">3.4.2 </bdi>labelReplacementCanonicalizeJsonLd</h4><a class="self-link" href="#labelreplacementcanonicalizejsonld" aria-label="Permalink for Section 3.4.2"></a></div>
          

          <p>
The following algorithm canonicalizes a JSON-LD document and replaces any blank
node identifiers in the canonicalized result using a label map factory
function, <var>labelMapFactoryFunction</var>. The required inputs are a JSON-LD
document (<var>document</var>) and a label map factory function
(<var>labelMapFactoryFunction</var>). Additional custom options (such as
a document loader) can also be passed. An N-Quads representation of the
<em>canonicalNQuads</em> as an array of N-Quad strings, with the replaced
blank node labels, and a map from the old blank node IDs to the new blank node
IDs, <em>labelMap</em>, is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Deserialize the JSON-LD document to RDF, <var>rdf</var>, using the <a href="https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm">
Deserialize JSON-LD to RDF algorithm</a>, passing any custom options (such
as a document loader).
            </li>
            <li>
Serialize <var>rdf</var> to an array of N-Quad strings, <var>nquads</var>.
            </li>
            <li>
Return the result of calling the algorithm in Section
<a href="#labelreplacementcanonicalizenquads" data-matched-text="[[[#labelreplacementcanonicalizenquads]]]" class="sec-ref"><bdi class="secno">3.4.1 </bdi>labelReplacementCanonicalizeNQuads</a>, passing <var>nquads</var>,
<var>labelMapFactoryFunction</var>, and any custom options.
            </li>
          </ol>

        </section>

        <section id="createlabelmapfunction"><div class="header-wrapper"><h4 id="x3-4-3-createlabelmapfunction"><bdi class="secno">3.4.3 </bdi>createLabelMapFunction</h4><a class="self-link" href="#createlabelmapfunction" aria-label="Permalink for Section 3.4.3"></a></div>
          

          <p>
The following algorithm creates a label map factory function that uses an
input label map to replace canonical blank node identifiers with another
value. The required input is a label map, <var>labelMap</var>. A
function, <em>labelMapFactoryFunction</em>, is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Create a function, <var>labelMapFactoryFunction</var>, with one required input
(a canonical node identifier map, <var>canonicalIdMap</var>), that will
return a blank node identifier map, <em>bnodeIdMap</em>, as output. Set the
function's implementation to:
              <ol class="algorithm">
                <li>
Generate a new empty bnode identifier map, <em>bnodeIdMap</em>.
                </li>
                <li>
For each map entry, <em>entry</em>, in <var>canonicalIdMap</var>:
                  <ol class="algorithm">
                    <li>
Use the canonical identifier from the value in <em>entry</em> as a key
in <var>labelMap</var> to get the new label, <em>newLabel</em>.
                    </li>
                    <li>
Add a new entry, <var>newEntry</var>, to <em>bnodeIdMap</em> using the key
from <em>entry</em> and <em>newLabel</em> as the value.
                    </li>
                  </ol>
                </li>
                <li>
Return <em>bnodeIdMap</em>.
                </li>
              </ol>
            </li>
            <li>
Return <var>labelMapFactoryFunction</var>.
            </li>
          </ol>

        </section>

        <section id="createhmacidlabelmapfunction"><div class="header-wrapper"><h4 id="x3-4-4-createhmacidlabelmapfunction"><bdi class="secno">3.4.4 </bdi>createHmacIdLabelMapFunction</h4><a class="self-link" href="#createhmacidlabelmapfunction" aria-label="Permalink for Section 3.4.4"></a></div>
          

          <p>
The following algorithm creates a label map factory function that uses an
HMAC to replace canonical blank node identifiers with their encoded HMAC
digests. The required input is an HMAC (previously initialized with a
secret key), <var>HMAC</var>. A function, <em>labelMapFactoryFunction</em>, is
produced as output.
          </p>

          <ol class="algorithm">
            <li>
Create a function, <var>labelMapFactoryFunction</var>, with one required input
(a canonical node identifier map, <var>canonicalIdMap</var>), that will
return a blank node identifier map, <em>bnodeIdMap</em>, as output. Set the
function's implementation to:
              <ol class="algorithm">
                <li>
Generate a new empty bnode identifier map, <em>bnodeIdMap</em>.
                </li>
                <li>
For each map entry, <em>entry</em>, in <var>canonicalIdMap</var>:
                  <ol class="algorithm">
                    <li>
HMAC the canonical identifier from the value in <em>entry</em> to get an HMAC
digest, <em>digest</em>.
                    </li>
                    <li>
Generate a new string value, <em>b64urlDigest</em>, and initialize it to "u"
followed by appending a base64url-no-pad encoded version of the <em>digest</em>
value.
                    </li>
                    <li>
Add a new entry, <var>newEntry</var>, to <em>bnodeIdMap</em> using the key
from <em>entry</em> and <em>b64urlDigest</em> as the value.
                    </li>
                  </ol>
                </li>
                <li>
Return <em>bnodeIdMap</em>.
                </li>
              </ol>
            </li>
            <li>
Return <var>labelMapFactoryFunction</var>.
            </li>
          </ol>

          <div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="5"><span>Note</span><span class="issue-label">: Other algorithms are possible</span></div><p class="">
A different primitive could be created that returned a label map factory
function that would instead sort the resulting HMAC digests and assign labels
in the produced label map using a prefix and integers based on their sorted
order. This primitive might be useful for selective disclosure schemes,
such as BBS, that favor unlinkability over minimizing unrevealed data leakage.
          </p></div>

        </section>

        <section id="skolemizenquads"><div class="header-wrapper"><h4 id="x3-4-5-skolemizenquads"><bdi class="secno">3.4.5 </bdi>skolemizeNQuads</h4><a class="self-link" href="#skolemizenquads" aria-label="Permalink for Section 3.4.5"></a></div>
          

          <p>
The following algorithm replaces all blank node identifiers in an array of
N-Quad strings with custom scheme URNs. The required inputs are an array of
N-Quad strings (<var>inputNQuads</var>) and a URN scheme (<var>urnScheme</var>).
An array of N-Quad strings, <em>skolemizedNQuads</em>, is produced as output.
This operation is intended to be reversible through the use of the algorithm in
Section <a href="#deskolemizenquads" data-matched-text="[[[#deskolemizenquads]]]" class="sec-ref"><bdi class="secno">3.4.6 </bdi>deskolemizeNQuads</a>.
          </p>

          <ol class="algorithm">
            <li>
Create a new array of N-Quad strings, <em>skolemizedNQuads</em>.
            </li>
            <li>
For each N-Quad string, <em>s1</em>, in <var>inputNQuads</var>:
              <ol class="algorithm">
                <li>
Create a new string, <em>s2</em>, that is a copy of <em>s1</em> replacing any
occurrence of a blank node identifier with a URN ("urn:"), plus the input
custom scheme (<var>urnScheme</var>), plus a colon (":"), and
the value of the blank node identifier. For example, a regular expression
of a similar form to the following would achieve the desired result:
<code>s1.replace(/(_:([^\s]+))/g, '&lt;urn:custom-scheme:$2&gt;')</code>.
                </li>
                <li>
Append <em>s2</em> to <em>skolemizedNQuads</em>.
                </li>
              </ol>
            </li>
            <li>
Return <em>skolemizedNQuads</em>.
            </li>
          </ol>
        </section>

        <section id="deskolemizenquads"><div class="header-wrapper"><h4 id="x3-4-6-deskolemizenquads"><bdi class="secno">3.4.6 </bdi>deskolemizeNQuads</h4><a class="self-link" href="#deskolemizenquads" aria-label="Permalink for Section 3.4.6"></a></div>
          

          <p>
The following algorithm replaces all custom scheme URNs in an array of
N-Quad statements with a blank node identifier. The required inputs are an array
of N-Quad strings (<var>inputNQuads</var>) and a URN scheme
(<var>urnScheme</var>). An array of N-Quad strings,
<em>deskolemizedNquads</em>, is produced as output. This operation is intended
to reverse use of the algorithm in Section <a href="#deskolemizenquads" data-matched-text="[[[#deskolemizenquads]]]" class="sec-ref"><bdi class="secno">3.4.6 </bdi>deskolemizeNQuads</a>.
          </p>

          <ol class="algorithm">
            <li>
Create a new array of N-Quad strings, <em>deskolemizedNQuads</em>.
            </li>
            <li>
For each N-Quad string, <em>s1</em>, in <var>inputNQuads</var>:
              <ol class="algorithm">
                <li>
Create a new string, <em>s2</em>, that is a copy of <em>s1</em> replacing any
occurrence of a URN ("urn:"), plus the input
custom scheme (<var>urnScheme</var>), plus a colon (":"), and
the value of the blank node identifier with a blank node prefix ("_:"), plus
the value of the blank node identifier. For example, a regular expression
of a similar form to the following would achieve the desired result:
<code>s1.replace(/(&lt;urn:custom-scheme:([^&gt;]+)&gt;)/g, '_:$2').</code>.
                </li>
                <li>
Append <em>s2</em> to <em>deskolemizedNQuads</em>.
                </li>
              </ol>
            </li>
            <li>
Return <em>deskolemizedNQuads</em>.
            </li>
          </ol>
        </section>

        <section id="skolemizeexpandedjsonld"><div class="header-wrapper"><h4 id="x3-4-7-skolemizeexpandedjsonld"><bdi class="secno">3.4.7 </bdi>skolemizeExpandedJsonLd</h4><a class="self-link" href="#skolemizeexpandedjsonld" aria-label="Permalink for Section 3.4.7"></a></div>
          

          <p>
The following algorithm replaces all blank node identifiers in an expanded
JSON-LD document with custom-scheme URNs, including assigning such URNs to
blank nodes that are unlabeled. The required inputs are an expanded JSON-LD document
(<var>expanded</var>), a custom URN scheme
(<var>urnScheme</var>), a UUID string or other comparably random string
(<var>randomString</var>), and reference to a shared integer (<var>count</var>).
Any additional custom options (such as a document loader) can also be passed.
It produces the expanded form of the skolemized JSON-LD document
(<var>skolemizedExpandedDocument</var> as output. The skolemization used in this
operation is intended to be reversible through the use of the algorithm in
Section <a href="#todeskolemizednquads" data-matched-text="[[[#todeskolemizednquads]]]" class="sec-ref"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</a>.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>skolemizedExpandedDocument</var> to an empty array.
            </li>
            <li>
For each <var>element</var> in <var>expanded</var>:
              <ol class="algorithm">
                <li>
If either <var>element</var> is not an object or it contains the key
<em>@value</em>, append a copy of <var>element</var> to
<var>skolemizedExpandedDocument</var> and continue to the next
<var>element</var>.
                </li>
                <li>
Otherwise, initialize <var>skolemizedNode</var> to an object, and for
each <em>property</em> and <em>value</em> in <var>element</var>:
                  <ol class="algorithm">
                    <li>
If <em>value</em> is an array, set the value of <em>property</em> in
<var>skolemizedNode</var> to the result of calling this algorithm
recursively passing <em>value</em> for <var>expanded</var> and keeping the
other parameters the same.
                    </li>
                    <li>
Otherwise, set the value of <em>property</em> in <var>skolemizedNode</var> to
the first element in the array result of calling this algorithm recursively
passing an array with <em>value</em> as its only element for <var>expanded</var>
and keeping the other parameters the same.
                    </li>
                  </ol>
                </li>
                <li>
If <var>skolemizedNode</var> has no <em>@id</em> property, set the value of
the <em>@id</em> property in <var>skolemizedNode</var> to the concatenation
of "urn:", <var>urnScheme</var>, "_",  <var>randomString</var>, "_" and the value of
<var>count</var>, incrementing the value of <var>count</var> afterwards.
                </li>
                <li>
Otherwise, if the value of the <em>@id</em> property in
<var>skolemizedNode</var> starts with "_:", preserve the existing blank node
identifier when skolemizing by setting the value of the <em>@id</em> property
in <var>skolemizedNode</var> to the concatenation of "urn:",
<var>urnScheme</var>, and the blank node identifier (i.e., the existing
value of the <em>@id</em> property minus the "_:" prefix; e.g., if the
existing value of the <em>@id</em> property is <code>_:b0</code>, the blank node
identifier is <code>b0</code>).
                </li>
                <li>
Append <var>skolemizedNode</var> to <var>skolemizedExpandedDocument</var>.
                </li>
              </ol>
            </li>
            <li>
Return <var>skolemizedExpandedDocument</var>.
            </li>
          </ol>
        </section>

        <section id="skolemizecompactjsonld"><div class="header-wrapper"><h4 id="x3-4-8-skolemizecompactjsonld"><bdi class="secno">3.4.8 </bdi>skolemizeCompactJsonLd</h4><a class="self-link" href="#skolemizecompactjsonld" aria-label="Permalink for Section 3.4.8"></a></div>
          

          <p>
The following algorithm replaces all blank node identifiers in a compact
JSON-LD document with custom-scheme URNs. The required inputs are a compact
JSON-LD document (<var>document</var>) and a custom URN scheme
(<var>urnScheme</var>) which defaults to "custom-scheme:". The <var>document</var> is assumed to
use only one
<em>@context</em> property at the top level of the document. Any additional
custom options (such as a document loader) can also be passed. It produces both
an expanded form of the skolemized JSON-LD document
(<var>skolemizedExpandedDocument</var> and a compact form of the skolemized
JSON-LD document (<var>skolemizedCompactDocument</var>) as output. The
skolemization used in this operation is intended to be reversible through the
use of the algorithm in Section <a href="#todeskolemizednquads" data-matched-text="[[[#todeskolemizednquads]]]" class="sec-ref"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</a> which uses the
same custom URN scheme (<var>urnScheme</var>).
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>expanded</var> to the result of the JSON-LD
<a href="https://www.w3.org/TR/json-ld11-api/#expansion-algorithm">
Expansion Algorithm</a>, passing <var>document</var> and any custom
options.
            </li>
            <li>
Initialize <var>skolemizedExpandedDocument</var> to the result of the
algorithm in Section <a href="#skolemizeexpandedjsonld" data-matched-text="[[[#skolemizeexpandedjsonld]]]" class="sec-ref"><bdi class="secno">3.4.7 </bdi>skolemizeExpandedJsonLd</a>.
            </li>
            <li>
Initialize <var>skolemizedCompactDocument</var> to the result of the JSON-LD
<a href="https://www.w3.org/TR/json-ld11-api/#compaction-algorithm">
Compaction Algorithm</a>, passing <var>skolemizedExpandedDocument</var> and any
custom options.
            </li>
            <li>
Return an object with both <var>skolemizedExpandedDocument</var> and
<var>skolemizedCompactDocument</var>.
            </li>
          </ol>
        </section>

        <section id="todeskolemizednquads"><div class="header-wrapper"><h4 id="x3-4-9-todeskolemizednquads"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</h4><a class="self-link" href="#todeskolemizednquads" aria-label="Permalink for Section 3.4.9"></a></div>
          

          <p>
The following algorithm converts a skolemized JSON-LD document, such as one
created using the algorithm in Section <a href="#skolemizecompactjsonld" data-matched-text="[[[#skolemizecompactjsonld]]]" class="sec-ref"><bdi class="secno">3.4.8 </bdi>skolemizeCompactJsonLd</a>,
to an array of deskolemized N-Quads. The required input is a JSON-LD document,
<em>skolemizedDocument</em>. Additional custom options (such as a document
loader) can be passed. An array of deskolemized N-Quad strings
(<var>deskolemizedNQuads</var>) is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>skolemizedDataset</var> to the result of the
<a href="https://www.w3.org/TR/json-ld11-api/#deserialize-json-ld-to-rdf-algorithm">
Deserialize JSON-LD to RDF</a> algorithm, passing any custom options (such as a
document loader), to convert <var>skolemizedDocument</var> from JSON-LD to RDF in N-Quads
format.
            </li>
            <li>
Split <var>skolemizedDataset</var> into an array of individual N-Quads,
<var>skolemizedNQuads</var>.
            </li>
            <li>
Set <var>deskolemizedNQuads</var> to the result of the algorithm in Section
<a href="#deskolemizenquads" data-matched-text="[[[#deskolemizenquads]]]" class="sec-ref"><bdi class="secno">3.4.6 </bdi>deskolemizeNQuads</a> with <var>skolemizedNQuads</var> and "custom-scheme:"
as parameters. Implementations <em class="rfc2119">MAY</em> choose a different <em>urnScheme</em>
that is different than "custom-scheme:" so long as the same scheme name was
used to generate <em>skolemizedDocument</em>.
            </li>
            <li>
Return <var>deskolemizedNQuads</var>.
            </li>
          </ol>
        </section>

        <section id="jsonpointertopaths"><div class="header-wrapper"><h4 id="x3-4-10-jsonpointertopaths"><bdi class="secno">3.4.10 </bdi>jsonPointerToPaths</h4><a class="self-link" href="#jsonpointertopaths" aria-label="Permalink for Section 3.4.10"></a></div>
          

          <p>
The following algorithm converts a JSON Pointer [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6901" title="JavaScript Object Notation (JSON) Pointer">RFC6901</a></cite>] to an array of paths
into a JSON tree. The required input is a JSON Pointer string
(<var>pointer</var>). An array of paths (<em>paths</em>) is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>paths</var> to an empty array.
            </li>
            <li>
Initialize <var>splitPath</var> to an array by splitting <var>pointer</var> on the
"/" character and skipping the first, empty, split element. In Javascript
notation, this step is equivalent to the following code:
<code>pointer.split('/').slice(1)</code>
            </li>
            <li>
For each <var>path</var> in <var>splitPath</var>:
              <ol class="algorithm">
                <li>
If <var>path</var> does not include <code>~</code>, then add <var>path</var> to <var>paths</var>, converting it to
an integer if it parses as one, leaving it as a string if it does not.
                </li>
                <li>
Otherwise, unescape any JSON pointer escape sequences in <var>path</var> and add the
result to <var>paths</var>.
                </li>
              </ol>
            </li>
            <li>
Return <var>paths</var>.
            </li>
          </ol>
        </section>

        <section id="createinitialselection"><div class="header-wrapper"><h4 id="x3-4-11-createinitialselection"><bdi class="secno">3.4.11 </bdi>createInitialSelection</h4><a class="self-link" href="#createinitialselection" aria-label="Permalink for Section 3.4.11"></a></div>
          

          <p>
The following algorithm creates an initial selection (a fragment of a JSON-LD
document) based on a JSON-LD object. This is a helper function used within the
algorithm in Section <a href="#selectjsonld" data-matched-text="[[[#selectjsonld]]]" class="sec-ref"><bdi class="secno">3.4.13 </bdi>selectJsonLd</a>. The required input is a
JSON-LD object (<var>source</var>). A JSON-LD document fragment object
(<var>selection</var>) is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>selection</var> to an empty object.
            </li>
            <li>
If <var>source</var> has an <code>id</code> that is not a blank node identifier, set
<var>selection</var>.<var>id</var> to its value. Note: All non-blank node identifiers in the path of
any JSON Pointer <em class="rfc2119">MUST</em> be included in the selection, this includes any root
document identifier.
            </li>
            <li>
If <var>source</var>.<var>type</var> is set, set <var>selection</var>.<var>type</var> to its value.
Note: The selection <em class="rfc2119">MUST</em> include all <code>type</code>s in the path of any JSON Pointer,
including any root document <code>type</code>.
            </li>
            <li>
Return <var>selection</var>.
            </li>
          </ol>
        </section>

        <section id="selectpaths"><div class="header-wrapper"><h4 id="x3-4-12-selectpaths"><bdi class="secno">3.4.12 </bdi>selectPaths</h4><a class="self-link" href="#selectpaths" aria-label="Permalink for Section 3.4.12"></a></div>
          

          <p>
The following algorithm selects a portion of a compact JSON-LD document using
paths parsed from a parsed JSON Pointer. This is a helper function used within
the algorithm in Section <a href="#selectjsonld" data-matched-text="[[[#selectjsonld]]]" class="sec-ref"><bdi class="secno">3.4.13 </bdi>selectJsonLd</a>. The required inputs are an
array of paths (<var>paths</var>) parsed from a JSON Pointer, a compact JSON-LD
document (<var>document</var>), a selection document
(<var>selectionDocument</var>) to be populated, and an array of arrays
(<var>arrays</var>) for tracking selected arrays. This algorithm produces
no output; instead it populates the given <var>selectionDocument</var> with
any values selected via <var>paths</var>.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>parentValue</var> to <var>document</var>.
            </li>
            <li>
Initialize <var>value</var> to <var>parentValue</var>.
            </li>
            <li>
Initialize <var>selectedParent</var> to <var>selectionDocument</var>.
            </li>
            <li>
Initialize <var>selectedValue</var> to <var>selectedParent</var>.
            </li>
            <li>
For each <var>path</var> in <var>paths</var>:
              <ol class="algorithm">
                <li>
Set <var>selectedParent</var> to <var>selectedValue</var>.
                </li>
                <li>
Set <var>parentValue</var> to <var>value</var>.
                </li>
                <li>
Set <var>value</var> to <var>parentValue</var>.<var>path</var>. If <var>value</var> is now undefined,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>,
indicating that the JSON pointer does not match the given <var>document</var>.
                </li>
                <li>
Set <var>selectedValue</var> to <var>selectedParent</var>.<var>path</var>.
                </li>
                <li>
If <var>selectedValue</var> is now undefined:
                  <ol class="algorithm">
                    <li>
If <var>value</var> is an array, set <var>selectedValue</var> to an empty array and append
<var>selectedValue</var> to <var>arrays</var>.
                    </li>
                    <li>
Otherwise, set <var>selectedValue</var> to an initial selection passing <var>value</var> as
<var>source</var> to the algorithm in Section <a href="#createinitialselection" data-matched-text="[[[#createinitialselection]]]" class="sec-ref"><bdi class="secno">3.4.11 </bdi>createInitialSelection</a>.
                    </li>
                    <li>
Set <var>selectedParent</var>.<var>path</var> to <var>selectedValue</var>.
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>
Note: With path traversal complete at the target value, the selected value will
now be computed.
            </li>
            <li>
If <var>value</var> is a literal, set <var>selectedValue</var> to <var>value</var>.
            </li>
            <li>
If <var>value</var> is an array, Set <var>selectedValue</var> to a copy of <var>value</var>.
            </li>
            <li>
In all other cases, set <var>selectedValue</var> to an object that merges a shallow copy of
<var>selectedValue</var> with a deep copy of <var>value</var>, e.g., <code>{...selectedValue,
…deepCopy(value)}</code>.
            </li>
            <li>
Get the last <var>path</var>, <var>lastPath</var>, from <var>paths</var>.
            </li>
            <li>
Set <var>selectedParent</var>.<var>lastPath</var> to <var>selectedValue</var>.
            </li>
          </ol>
        </section>

        <section id="selectjsonld"><div class="header-wrapper"><h4 id="x3-4-13-selectjsonld"><bdi class="secno">3.4.13 </bdi>selectJsonLd</h4><a class="self-link" href="#selectjsonld" aria-label="Permalink for Section 3.4.13"></a></div>
          

          <p>
The following algorithm selects a portion of a compact JSON-LD document using
an array of JSON Pointers. The required inputs are an array of JSON Pointers
(<var>pointers</var>) and a compact JSON-LD document (<var>document</var>). The
<var>document</var> is assumed to use a JSON-LD context that aliases <code>@id</code>
and <code>@type</code> to <code>id</code> and <code>type</code>, respectively, and to use only one
<em><code>@context</code></em> property at the top level of the document. A new JSON-LD
document that represents a selection (<em>selectionDocument</em>) of the
original JSON-LD document is produced as output.
          </p>

          <ol class="algorithm">
            <li>
If <var>pointers</var> is empty, return <code>null</code>. This indicates nothing has been selected
from the original document.
            </li>
            <li>
Initialize <var>arrays</var> to an empty array. This variable will be used to track
selected sparse arrays to make them dense after all <var>pointers</var> have
been processed.
            </li>
            <li>
Initialize <var>selectionDocument</var> to an initial selection passing <var>document</var> as
<var>source</var> to the algorithm in Section <a href="#createinitialselection" data-matched-text="[[[#createinitialselection]]]" class="sec-ref"><bdi class="secno">3.4.11 </bdi>createInitialSelection</a>.
            </li>
            <li>
Set the value of the <em><code>@context</code></em> property in <var>selectionDocument</var> to
a copy of the value of the <em><code>@context</code></em> property in <var>document</var>.
            </li><li>
For each <var>pointer</var> in <var>pointers</var>, walk the document from root to the pointer
target value, building the <var>selectionDocument</var>:
              <ol class="algorithm">
                <li>
Parse the <var>pointer</var> into an array of paths, <var>paths</var>, using the
algorithm in Section <a href="#jsonpointertopaths" data-matched-text="[[[#jsonpointertopaths]]]" class="sec-ref"><bdi class="secno">3.4.10 </bdi>jsonPointerToPaths</a>.
                </li>
                <li>
Use the algorithm in Section <a href="#selectpaths" data-matched-text="[[[#selectpaths]]]" class="sec-ref"><bdi class="secno">3.4.12 </bdi>selectPaths</a>, passing
<var>document</var>, <var>paths</var>, <var>selectionDocument</var>, and
<var>arrays</var>.
                </li>
              </ol>
            </li>
            <li>
For each <var>array</var> in <var>arrays</var>:
              <ol class="algorithm">
                <li>
Make <var>array</var> dense by removing any undefined elements between
elements that are defined.
                </li>
              </ol>
            </li>
            <li>
Return <var>selectionDocument</var>.
            </li>
          </ol>
        </section>

        <section id="relabelblanknodes"><div class="header-wrapper"><h4 id="x3-4-14-relabelblanknodes"><bdi class="secno">3.4.14 </bdi>relabelBlankNodes</h4><a class="self-link" href="#relabelblanknodes" aria-label="Permalink for Section 3.4.14"></a></div>
          

          <p>
The following algorithm relabels the blank node identifiers in an array of
N-Quad strings using a blank node label map. The required inputs are an array
of N-Quad strings (<var>nquads</var>) and a blank node label map
(<var>labelMap</var>). An array of N-Quad strings with relabeled blank node
identifiers (<var>relabeledNQuads</var>) is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Create a new array of N-Quad strings, <em>relabeledNQuads</em>.
            </li>
            <li>
For each N-Quad string, <em>s1</em>, in <var>nquads</var>:
              <ol class="algorithm">
                <li>
Create a new string, <em>s2</em>, such it that is a copy of <em>s1</em> except
each blank node identifier therein has been replaced with the value associated
with it as a key in <var>labelMap</var>.
                </li>
                <li>
Append <em>s2</em> to <em>relabeledNQuads</em>.
                </li>
              </ol>
            </li>
            <li>
Return <em>relabeledNQuads</em>.
            </li>
          </ol>

        </section>

        <section id="selectcanonicalnquads"><div class="header-wrapper"><h4 id="x3-4-15-selectcanonicalnquads"><bdi class="secno">3.4.15 </bdi>selectCanonicalNQuads</h4><a class="self-link" href="#selectcanonicalnquads" aria-label="Permalink for Section 3.4.15"></a></div>
          

          <p>
The following algorithm selects a portion of a skolemized compact JSON-LD
document using an array of JSON Pointers, and outputs the resulting canonical
N-Quads with any blank node labels replaced using the given label map. The
required inputs are an array of JSON Pointers (<var>pointers</var>), a
skolemized compact JSON-LD document (<var>skolemizedCompactDocument</var>),
and a blank node label map (<var>labelMap</var>). Additional custom options
(such as a document loader) can be passed. The <var>document</var> is assumed
to use a JSON-LD context that aliases <code>@id</code> and <code>@type</code> to <code>id</code> and <code>type</code>,
respectively, and to use only one <em><code>@context</code></em> property at the top level
of the document. An object containing the new JSON-LD document that represents
a selection of the original JSON-LD document (<var>selectionDocument</var>), an
array of deskolemized N-Quad strings (<var>deskolemizedNQuads</var>), and an
array of canonical N-Quads with replacement blank node labels (<var>nquads</var>)
is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>selectionDocument</var> to the result of the algorithm
in Section <a href="#selectjsonld" data-matched-text="[[[#selectjsonld]]]" class="sec-ref"><bdi class="secno">3.4.13 </bdi>selectJsonLd</a>, passing <var>pointers</var>,
and <var>skolemizedCompactDocument</var> as <em>document</em>.
            </li>
            <li>
Initialize <var>deskolemizedNQuads</var> to the result of the algorithm
in Section <a href="#todeskolemizednquads" data-matched-text="[[[#todeskolemizednquads]]]" class="sec-ref"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</a>, passing
<var>selectionDocument</var> as <var>skolemizedCompactDocument</var>, and
any custom options.
            </li>
            <li>
Initialize <var>nquads</var> to the result of the algorithm
in Section <a href="#relabelblanknodes" data-matched-text="[[[#relabelblanknodes]]]" class="sec-ref"><bdi class="secno">3.4.14 </bdi>relabelBlankNodes</a>, passing <var>labelMap</var>,
and <var>deskolemizedNQuads</var> as <var>nquads</var>.
            </li>
            <li>
Return an object containing <var>selectionDocument</var>,
<var>deskolemizedNQuads</var>, and <var>nquads</var>.
            </li>
          </ol>
        </section>

        <section id="canonicalizeandgroup"><div class="header-wrapper"><h4 id="x3-4-16-canonicalizeandgroup"><bdi class="secno">3.4.16 </bdi>canonicalizeAndGroup</h4><a class="self-link" href="#canonicalizeandgroup" aria-label="Permalink for Section 3.4.16"></a></div>
          

          <p>
The following algorithm is used to output canonical N-Quad strings that match
custom selections of a compact JSON-LD document. It does this by canonicalizing
a compact JSON-LD document (replacing any blank node identifiers using a label
map) and grouping the resulting canonical N-Quad strings according to
the selection associated with each group. Each group will be defined using an
assigned name and array of JSON pointers. The JSON pointers will be used to
select portions of the skolemized document, such that the output can be
converted to canonical N-Quads to perform group matching.
          </p>

          <p>
The required inputs are a compact JSON-LD document (<var>document</var>),
a label map factory function (<var>labelMapFactoryFunction</var>), and a map
of named group definitions (<var>groupDefinitions</var>). Additional custom
options (such as a document loader) can be passed. The <var>document</var> is
assumed to use a JSON-LD context that aliases <code>@id</code> and <code>@type</code> to <code>id</code> and
<code>type</code>, respectively, and to use only one <em><code>@context</code></em> property at the top
level of the document. An object containing the created groups
(<var>groups</var>), the skolemized compact JSON-LD document
(<var>skolemizedCompactDocument</var>), the skolemized expanded JSON-LD
document (<var>skolemizedExpandedDocument</var>), the deskolemized N-Quad
strings (<var>deskolemizedNQuads</var>), the blank node label map
(<var>labelMap</var>), and the canonical N-Quad strings <var>nquads</var>, is
produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>skolemizedExpandedDocument</var> and
<var>skolemizedCompactDocument</var> to their associated values in the
result of the algorithm in Section <a href="#skolemizecompactjsonld" data-matched-text="[[[#skolemizecompactjsonld]]]" class="sec-ref"><bdi class="secno">3.4.8 </bdi>skolemizeCompactJsonLd</a>,
passing <var>document</var> and any custom options.
            </li>
            <li>
Initialize <var>deskolemizedNQuads</var> to the result of the
algorithm in Section <a href="#todeskolemizednquads" data-matched-text="[[[#todeskolemizednquads]]]" class="sec-ref"><bdi class="secno">3.4.9 </bdi>toDeskolemizedNQuads</a>, passing
<var>skolemizedExpandedDocument</var> and any custom options.
            </li>
            <li>
Initialize <var>nquads</var> and <var>labelMap</var> to their associated
values in the result of the algorithm in Section
<a href="#labelreplacementcanonicalizenquads" data-matched-text="[[[#labelreplacementcanonicalizenquads]]]" class="sec-ref"><bdi class="secno">3.4.1 </bdi>labelReplacementCanonicalizeNQuads</a>, passing
<var>labelMapFactoryFunction</var>, <var>deskolemizedNQuads</var> as
<var>nquads</var>, and any custom options.
            </li>
            <li>
Initialize <var>selections</var> to a new map.
            </li>
            <li>
For each key (<var>name</var>) and value (<var>pointers</var>) entry in
<var>groupDefinitions</var>:
              <ol class="algorithm">
                <li>
Add an entry with a key of <var>name</var> and a value that is the result
of the algorithm in Section <a href="#selectcanonicalnquads" data-matched-text="[[[#selectcanonicalnquads]]]" class="sec-ref"><bdi class="secno">3.4.15 </bdi>selectCanonicalNQuads</a>, passing
<var>pointers</var>, <var>labelMap</var>, <var>skolemizedCompactDocument</var>
as <var>document</var>, and any custom options.
                </li>
              </ol>
            </li>
            <li>
Initialize <var>groups</var> to an empty object.
            </li>
            <li>
For each key (<var>name</var>) and value (<var>selectionResult</var>) entry in
<var>selections</var>:
              <ol class="algorithm">
                <li>
Initialize <var>matching</var> to an empty map.
                </li>
                <li>
Initialize <var>nonMatching</var> to an empty map.
                </li>
                <li>
Initialize <var>selectedNQuads</var> to <em>nquads</em> from
<var>selectionResult</var>.
                </li>
                <li>
Initialize <var>selectedDeskolemizedNQuads</var> from
<em>deskolemizedNQuads</em> from <var>selectionResult</var>.
                </li>
                <li>
For each element (<var>nq</var>) and index (<var>index</var>) in
<var>nquads</var>:
                  <ol class="algorithm">
                    <li>
Create a map entry, <var>entry</var>, with a key of <var>index</var> and a
value of <var>nq</var>.
                    </li>
                    <li>
If <var>selectedNQuads</var> includes <var>nq</var> then add <var>entry</var>
to <var>matching</var>; otherwise, add <var>entry</var> to <var>nonMatching</var>.
                    </li>
                  </ol>
                </li>
                <li>
Set <var>name</var> in <var>groups</var> to an object containing
<var>matching</var>, <var>nonMatching</var>, and
<var>selectedDeskolemizedNQuads</var> as <var>deskolemizedNQuads</var>.
                </li>
              </ol>
            </li>
            <li>
Return an object containing <var>groups</var>,
<var>skolemizedExpandedDocument</var>, <var>skolemizedCompactDocument</var>,
<var>deskolemizedNQuads</var>, <var>labelMap</var>, and <var>nquads</var>.
            </li>
          </ol>
        </section>

        <section id="hashmandatorynquads"><div class="header-wrapper"><h4 id="x3-4-17-hashmandatorynquads"><bdi class="secno">3.4.17 </bdi>hashMandatoryNQuads</h4><a class="self-link" href="#hashmandatorynquads" aria-label="Permalink for Section 3.4.17"></a></div>
          

          <p>
The following algorithm cryptographically hashes an array of mandatory to
disclose N-Quads using a provided hashing API. The required input is an array of
mandatory to disclose N-Quads (<var>mandatory</var>) and a hashing function
(<var>hasher</var>). A cryptographic hash (<em>mandatoryHash</em>) is produced
as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <code>bytes</code> to the UTF-8 representation of the joined <code>mandatory</code>
N-Quads.
            </li>
            <li>
Initialize <code>mandatoryHash</code> to the result of using <code>hasher</code> to hash <code>bytes</code>.
            </li>
            <li>
Return <code>mandatoryHash</code>.
            </li>
          </ol>
        </section>
      </section>


      <section id="ecdsa-sd-2023-functions"><div class="header-wrapper"><h3 id="x3-5-ecdsa-sd-2023-functions"><bdi class="secno">3.5 </bdi>ecdsa-sd-2023 Functions</h3><a class="self-link" href="#ecdsa-sd-2023-functions" aria-label="Permalink for Section 3.5"></a></div>
        

        <div class="issue" id="issue-container-number-3"><div role="heading" class="issue-title marker" id="h-issue-1" aria-level="4"><span>Issue 3</span><span class="issue-label">: (AT RISK) Pending implementation feedback and security reviews.</span></div><p class="">
The Working Group is seeking implementer feedback on these cryptographic suite
functions as well as horizonal security review on the feature from parties at
<abbr title="World Wide Web Consortium">W3C</abbr> and IETF. Those reviews might result in significant changes to these
algorithms, or the removal of the algorithms from the specification during the
Candidate Recommendation phase.
        </p></div>

        <p>
This section contains subalgorithms that are useful to the <code>ecdsa-sd-2023</code>
cryptographic suite.
        </p>

        <section id="serializesigndata"><div class="header-wrapper"><h4 id="x3-5-1-serializesigndata"><bdi class="secno">3.5.1 </bdi>serializeSignData</h4><a class="self-link" href="#serializesigndata" aria-label="Permalink for Section 3.5.1"></a></div>
          

          <p>
The following algorithm serializes the data that is to be signed by the private
key associated with the base proof verification method. The required inputs are
the proof options hash (<var>proofHash</var>), the proof-scoped multikey-encoded
public key (<var>publicKey</var>), and the mandatory hash
(<var>mandatoryHash</var>). A single <em>sign data</em> value,
represented as series of bytes, is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Return the concatenation of <var>proofHash</var>, <var>publicKey</var>, and
<var>mandatoryHash</var>, in that order, as <em>sign data</em>.
            </li>
          </ol>

        </section>

        <section id="serializebaseproofvalue"><div class="header-wrapper"><h4 id="x3-5-2-serializebaseproofvalue"><bdi class="secno">3.5.2 </bdi>serializeBaseProofValue</h4><a class="self-link" href="#serializebaseproofvalue" aria-label="Permalink for Section 3.5.2"></a></div>
          

          <p>
The following algorithm serializes the base proof value, including the
base signature, public key, HMAC key, signatures, and mandatory pointers.
The required inputs are a base signature <var>baseSignature</var>, a public key
<var>publicKey</var>, an HMAC key <var>hmacKey</var>, an array of
<var>signatures</var>, and an array of <var>mandatoryPointers</var>.
A single <em>base proof</em> string value is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize a byte array, <var>proofValue</var>, that starts with the ECDSA-SD base proof
header bytes 0xd9, 0x5d, and 0x00.
            </li>
            <li>
Initialize <var>components</var> to an array with five elements containing the values of:
<var>baseSignature</var>, <var>publicKey</var>, <var>hmacKey</var>, <var>signatures</var>, and <var>mandatoryPointers</var>.
            </li>
            <li>
CBOR-encode <var>components</var> per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8949" title="Concise Binary Object Representation (CBOR)">RFC8949</a></cite>] where CBOR tagging <em class="rfc2119">MUST NOT</em> be used on
any of the <var>components</var>. Append the produced encoded value to <var>proofValue</var>.
            </li>
            <li>
Initialize <var>baseProof</var> to a string with the Multibase
base64url-no-pad-encoding of <var>proofValue</var> as described in the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">
Multibase section</a> of <cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. That is, return a string
starting with "<code>u</code>" and ending with the base64url-no-pad-encoded value of
<var>proofValue</var>.
            </li>
            <li>
Return <var>baseProof</var> as <em>base proof</em>.
            </li>
          </ol>

        </section>

        <section id="parsebaseproofvalue"><div class="header-wrapper"><h4 id="x3-5-3-parsebaseproofvalue"><bdi class="secno">3.5.3 </bdi>parseBaseProofValue</h4><a class="self-link" href="#parsebaseproofvalue" aria-label="Permalink for Section 3.5.3"></a></div>
          

          <p>
The following algorithm parses the components of an <code>ecdsa-sd-2023</code> selective
disclosure base proof value. The required inputs are a proof value
(<var>proofValue</var>). A single object <em>parsed base proof</em>, containing
five elements, using the names <code>baseSignature</code>, <code>publicKey</code>, <code>hmacKey</code>,
<code>signatures</code>, and <code>mandatoryPointers</code>, is produced  as output.
          </p>

          <ol class="algorithm">
            <li>
If the <var>proofValue</var> string does not start with <code>u</code>, indicating that it is
a multibase-base64url-no-pad-encoded value, an error <em class="rfc2119">MUST</em> be raised
and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
            </li>
            <li>
Initialize <var>decodedProofValue</var> to the result of base64url-no-pad-decoding the
substring after the leading <code>u</code> in <var>proofValue</var>.
            </li>
            <li>
If the <var>decodedProofValue</var> does not start with the ECDSA-SD base proof
header bytes <code>0xd9</code>, <code>0x5d</code>, and <code>0x00</code>, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em>
convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
            </li>
            <li>
Initialize <var>components</var> to an array that is the result of CBOR-decoding the
bytes that follow the three-byte ECDSA-SD base proof header. Confirm that the result
is an array of five elements.
            </li>
            <li>
Return an object with properties set to the five elements, using the names
<code>baseSignature</code>, <code>publicKey</code>, <code>hmacKey</code>, <code>signatures</code>, and <code>mandatoryPointers</code>,
respectively.
            </li>
          </ol>

        </section>

        <section id="createdisclosuredata"><div class="header-wrapper"><h4 id="x3-5-4-createdisclosuredata"><bdi class="secno">3.5.4 </bdi>createDisclosureData</h4><a class="self-link" href="#createdisclosuredata" aria-label="Permalink for Section 3.5.4"></a></div>
          

          <p>
The following algorithm creates data to be used to generate a derived proof. The
inputs include a JSON-LD document (<var>document</var>), an ECDSA-SD base proof
(<var>proof</var>), an array of JSON pointers to use to selectively disclose
statements (<var>selectivePointers</var>), and any custom JSON-LD API options,
such as a document loader). A single object, <em>disclosure data</em>, is
produced as output, which contains the "baseSignature", "publicKey",
"signatures" for "filteredSignatures", "labelMap", "mandatoryIndexes", and
"revealDocument" fields.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>baseSignature</var>, <var>publicKey</var>, <var>hmacKey</var>, <var>signatures</var>, and
<var>mandatoryPointers</var> to the values of the associated properties in the object
returned when calling the algorithm in Section
<a href="#parsebaseproofvalue" data-matched-text="[[[#parsebaseproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.3 </bdi>parseBaseProofValue</a>, passing the <var>proofValue</var> from <var>proof</var>.
            </li>
            <li>
Initialize <var>hmac</var> to an HMAC API using <var>hmacKey</var>. The HMAC uses the same hash
algorithm used in the signature algorithm, i.e., SHA-256 for a P-256 curve.
            </li>
            <li>
Initialize <var>labelMapFactoryFunction</var> to the result of calling the
<var>createHmacIdLabelMapFunction</var> algorithm passing <var>hmac</var>.
            </li>
            <li>
Initialize <var>combinedPointers</var> to the concatenation of <var>mandatoryPointers</var>
and <var>selectivePointers</var>.
            </li>
            <li>
Initialize <var>groupDefinitions</var> to a map with the following entries: key of
the string <code>"mandatory"</code> and value of <var>mandatoryPointers</var>, key of the string
<code>"selective"</code> and value of <var>selectivePointers</var>, and key of the string <code>"combined"</code>
and value of <var>combinedPointers</var>.
            </li>
            <li>
Initialize <var>groups</var> and <var>labelMap</var> to their associated values in the result
of calling the algorithm in Section
<a href="#canonicalizeandgroup" data-matched-text="[[[#canonicalizeandgroup]]]" class="sec-ref"><bdi class="secno">3.4.16 </bdi>canonicalizeAndGroup</a>, passing <var>document</var>,
<var>labelMapFactoryFunction</var>, <var>groupDefinitions</var>, and any custom
JSON-LD API options as parameters. Note: This step transforms the document into
an array of canonical N-Quad strings with pseudorandom blank node identifiers
based on <var>hmac</var>, and groups the N-Quad strings according to selections based on
JSON pointers.
            </li>
            <li>
Initialize <var>relativeIndex</var> to zero.
            </li>
            <li>
Initialize <var>mandatoryIndexes</var> to an empty array.
            </li>
            <li>
For each <var>absoluteIndex</var> in the keys in <var>groups</var>.<var>combined</var>.<var>matching</var>, convert
the absolute index of any mandatory N-Quad to an index relative to the combined
output that is to be revealed:
              <ol class="algorithm">
                <li>
If <var>groups</var>.<var>mandatory</var>.<var>matching</var> has <var>absoluteIndex</var> as a key, then append
<var>relativeIndex</var> to <var>mandatoryIndexes</var>.
                </li>
                <li>
Increment <var>relativeIndex</var>.
                </li>
              </ol>
            </li>
            <li>
Determine which signatures match a selectively disclosed statement, which
requires incrementing an index counter while iterating over all <var>signatures</var>,
skipping over any indexes that match the mandatory group.
              <ol class="algorithm">
                <li>
Initialize <var>index</var> to <code>0</code>.
                </li>
                <li>
Initialize <var>filteredSignatures</var> to an empty array.
                </li>
                <li>
For each <var>signature</var> in <var>signatures</var>:
                  <ol class="algorithm">
                    <li>
While <var>index</var> is in <var>groups</var>.<var>mandatory</var>.<var>matching</var>, increment <var>index</var>.
                    </li>
                    <li>
If <var>index</var> is in <var>groups</var>.<var>selective</var>.<var>matching</var>, add <var>signature</var> to
<var>filteredSignatures</var>.
                    </li>
                    <li>
Increment <var>index</var>.
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
            <li>
Initialize <var>revealDocument</var> to the result of the "selectJsonLd"
algorithm, passing <var>document</var>, and <var>combinedPointers</var> as <var>pointers</var>.
            </li>
            <li>
Run the RDF Dataset Canonicalization Algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] on
the joined |combinedGroup.deskolemizedNQuads|, passing any custom
options, and get the canonical bnode identifier map, <var>canonicalIdMap</var>.
Note: This map includes the canonical blank node identifiers that a verifier
will produce when they canonicalize the reveal document.
            </li>
            <li>
Initialize <var>verifierLabelMap</var> to an empty map. This map will map
the canonical blank node identifiers the verifier will produce when they
canonicalize the revealed document to the blank node identifiers that were
originally signed in the base proof.
            </li>
            <li>
For each key (<var>inputLabel</var>) and value (<var>verifierLabel</var>) in <var>canonicalIdMap</var>:
              <ol class="algorithm">
                <li>
Add an entry to <var>verifierLabelMap</var> using <var>verifierLabel</var> as the key and the
value associated with <var>inputLabel</var> as a key in <var>labelMap</var> as the value.
                </li>
              </ol>
            </li>
            <li>
Return an object with properties matching <var>baseSignature</var>, <var>publicKey</var>,
<code>signatures</code> for <var>filteredSignatures</var>, <code>verifierLabelMap</code> for <var>labelMap</var>,
<var>mandatoryIndexes</var>, and <var>revealDocument</var>.
            </li>
          </ol>

        </section>

        <section id="compresslabelmap"><div class="header-wrapper"><h4 id="x3-5-5-compresslabelmap"><bdi class="secno">3.5.5 </bdi>compressLabelMap</h4><a class="self-link" href="#compresslabelmap" aria-label="Permalink for Section 3.5.5"></a></div>
          

          <p>
The following algorithm compresses a label map. The required inputs are
label map (<var>labelMap</var>). The output is a <em>compressed label map</em>.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>map</var> to an empty map.
            </li>
            <li>
For each entry (<var>k</var>, <var>v</var>) in <var>labelMap</var>:
              <ol class="algorithm">
                <li>
Add an entry to <var>map</var> with a key that is a base-10 integer parsed from the
characters following the "c14n" prefix in <var>k</var> and a value that is a byte array
resulting from base64url-no-pad-decoding the characters after the "u" prefix in
                <var>v</var>.
                </li>
              </ol>
            </li>
            <li>
Return <var>map</var> as <em>compressed label map</em>.
            </li>
          </ol>

        </section>

        <section id="decompresslabelmap"><div class="header-wrapper"><h4 id="x3-5-6-decompresslabelmap"><bdi class="secno">3.5.6 </bdi>decompressLabelMap</h4><a class="self-link" href="#decompresslabelmap" aria-label="Permalink for Section 3.5.6"></a></div>
          

          <p>
The following algorithm decompresses a label map. The required input is a
compressed label map (<var>compressedLabelMap</var>). The output is a
<em>decompressed label map</em>.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>map</var> to an empty map.
            </li>
            <li>
For each entry (<var>k</var>, <var>v</var>) in <var>compressedLabelMap</var>:
              <ol class="algorithm">
                <li>
Add an entry to <var>map</var> with a key that adds the prefix "c14n" to <var>k</var> and a value
that adds a prefix of "u" to the base64url-no-pad-encoded value for <var>v</var>.
                </li>
              </ol>
            </li>
            <li>
Return <var>map</var> as <em>decompressed label map</em>.
            </li>
          </ol>

        </section>

        <section id="serializederivedproofvalue"><div class="header-wrapper"><h4 id="x3-5-7-serializederivedproofvalue"><bdi class="secno">3.5.7 </bdi>serializeDerivedProofValue</h4><a class="self-link" href="#serializederivedproofvalue" aria-label="Permalink for Section 3.5.7"></a></div>
          

          <p>
The following algorithm serializes a derived proof value. The required inputs
are a base signature (<var>baseSignature</var>), public key
(<var>publicKey</var>), an array of signatures (<var>signatures</var>), a label
map (<var>labelMap</var>), and an array of mandatory indexes
(<var>mandatoryIndexes</var>). A single <em>derived proof</em> value, serialized
as a byte string, is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>compressedLabelMap</var> to the result of calling the algorithm in
Section <a href="#compresslabelmap" data-matched-text="[[[#compresslabelmap]]]" class="sec-ref"><bdi class="secno">3.5.5 </bdi>compressLabelMap</a>, passing <var>labelMap</var> as the parameter.
            </li>
            <li>
Initialize a byte array, <var>proofValue</var>, that starts with the ECDSA-SD disclosure
proof header bytes <code>0xd9</code>, <code>0x5d</code>, and <code>0x01</code>.
            </li>
            <li>
Initialize <var>components</var> to an array with five elements containing the values of:
<var>baseSignature</var>, <var>publicKey</var>, <var>signatures</var>, <var>compressedLabelMap</var>, and
<var>mandatoryIndexes</var>.
            </li>
            <li>
CBOR-encode <var>components</var> per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8949" title="Concise Binary Object Representation (CBOR)">RFC8949</a></cite>] where CBOR tagging <em class="rfc2119">MUST NOT</em> be used on
any of the <var>components</var>. Append the produced encoded value to <var>proofValue</var>.
            </li>
            <li>
Return the <em>derived proof</em> as a string with the
base64url-no-pad-encoding of <var>proofValue</var> as described in the
<a href="https://www.w3.org/TR/controller-document/#multibase-0">
Multibase section</a> of <cite><a data-matched-text="[[[controller-document]]]" href="https://www.w3.org/TR/controller-document/">Controlled Identifier Document 1.0</a></cite>. That is, return a string
starting with "<code>u</code>" and ending with the base64url-no-pad-encoded value of
<var>proofValue</var>.
            </li>
          </ol>

        </section>

        <section id="parsederivedproofvalue"><div class="header-wrapper"><h4 id="x3-5-8-parsederivedproofvalue"><bdi class="secno">3.5.8 </bdi>parseDerivedProofValue</h4><a class="self-link" href="#parsederivedproofvalue" aria-label="Permalink for Section 3.5.8"></a></div>
          

          <p>
The following algorithm parses the components of the derived proof value.
The required input is a derived proof value (<var>proofValue</var>).
A single <em>derived proof value</em> value object is produced as output, which
contains a set to five elements, using the names "baseSignature", "publicKey",
"signatures", "labelMap", and "mandatoryIndexes".
          </p>

          <ol class="algorithm">
            <li>
If the <var>proofValue</var> string does not start with <code>u</code>, indicating that it is a
multibase-base64url-no-pad-encoded value, an error <em class="rfc2119">MUST</em> be raised
and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
            </li>
            <li>
Initialize <var>decodedProofValue</var> to the result of base64url-no-pad-decoding the
substring after the leading <code>u</code> in <var>proofValue</var>.
            </li>
            <li>
If the <var>decodedProofValue</var> does not start with the ECDSA-SD disclosure proof
header bytes <code>0xd9</code>, <code>0x5d</code>, and <code>0x01</code>, an error <em class="rfc2119">MUST</em> be raised
and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
            </li>
            <li>
Initialize <var>components</var> to an array that is the result of CBOR-decoding the bytes
that follow the three-byte ECDSA-SD disclosure proof header. If the result is not
an array of the following five elements — a byte array of length 64; a byte array
of length 36; an array of byte arrays, each of length 64; a map of integers to
byte arrays, each of length 32; and an array of integers — an error <em class="rfc2119">MUST</em> be raised
and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>.
            </li>
            <li>
Replace the fourth element in <var>components</var> using the result of calling the
algorithm in Section <a href="#decompresslabelmap" data-matched-text="[[[#decompresslabelmap]]]" class="sec-ref"><bdi class="secno">3.5.6 </bdi>decompressLabelMap</a>, passing the existing
fourth element of <var>components</var> as <var>compressedLabelMap</var>.
            </li>
            <li>
Return <em>derived proof value</em> as an object with properties set to the five
elements, using the names "baseSignature", "publicKey", "signatures",
"labelMap", and "mandatoryIndexes", respectively.
            </li>
          </ol>

        </section>

        <section id="createverifydata"><div class="header-wrapper"><h4 id="x3-5-9-createverifydata"><bdi class="secno">3.5.9 </bdi>createVerifyData</h4><a class="self-link" href="#createverifydata" aria-label="Permalink for Section 3.5.9"></a></div>
          

          <p>
The following algorithm creates the data needed to perform verification of an
ECDSA-SD-protected <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>. The inputs include a JSON-LD
document (<var>document</var>), an ECDSA-SD disclosure proof (<var>proof</var>),
and any custom JSON-LD API options, such as a document loader. A single
<em>verify data</em> object value is produced as output containing the following
fields: "baseSignature", "proofHash", "publicKey", "signatures", "nonMandatory",
and "mandatoryHash".
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>proofHash</var> to the result of perform RDF Dataset Canonicalization
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] on the proof options. The hash used is the same as the one used in
the signature algorithm, i.e., SHA-256 for a P-256 curve. Note: This step can be
performed in parallel; it only needs to be completed before this algorithm needs
to use the <var>proofHash</var> value.
            </li>
            <li>
Initialize <var>baseSignature</var>, <var>publicKey</var>, <var>signatures</var>, <var>labelMap</var>, and
<var>mandatoryIndexes</var>, to the values associated with their property names in the
object returned when calling the algorithm in Section
<a href="#parsederivedproofvalue" data-matched-text="[[[#parsederivedproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.8 </bdi>parseDerivedProofValue</a>, passing <var>proofValue</var> from <var>proof</var>.
            </li>
            <li>
Initialize <var>labelMapFactoryFunction</var> to the result of calling the
"createLabelMapFunction" algorithm.
            </li>
            <li>
Initialize <var>nquads</var> to the result of calling the "labelReplacementCanonicalize"
algorithm, passing <var>document</var>, <var>labelMapFactoryFunction</var>, and any custom
JSON-LD API options. Note: This step transforms the document into an array of
canonical N-Quads with pseudorandom blank node identifiers based on <var>labelMap</var>.
            </li>
            <li>
Initialize <var>mandatory</var> to an empty array.
            </li>
            <li>
Initialize <var>nonMandatory</var> to an empty array.
            </li>
            <li>
For each entry (<var>index</var>, <var>nq</var>) in <var>nquads</var>, separate the N-Quads into mandatory
and non-mandatory categories:
              <ol class="algorithm">
                <li>
If <var>mandatoryIndexes</var> includes <var>index</var>, add <var>nq</var> to <var>mandatory</var>.
                </li>
                <li>
Otherwise, add <var>nq</var> to <var>nonMandatory</var>.
                </li>
              </ol>
            </li>
            <li>
Initialize <var>mandatoryHash</var> to the result of calling the "hashMandatory"
primitive, passing <var>mandatory</var>.
            </li>
            <li>
Return an object with properties matching <var>baseSignature</var>, <var>proofHash</var>,
<var>publicKey</var>, <var>signatures</var>, <var>nonMandatory</var>, and <var>mandatoryHash</var>.
            </li>
          </ol>

        </section>

      </section>

      <section id="ecdsa-sd-2023"><div class="header-wrapper"><h3 id="x3-6-ecdsa-sd-2023"><bdi class="secno">3.6 </bdi>ecdsa-sd-2023</h3><a class="self-link" href="#ecdsa-sd-2023" aria-label="Permalink for Section 3.6"></a></div>
        

        <div class="issue" id="issue-container-number-4"><div role="heading" class="issue-title marker" id="h-issue-2" aria-level="4"><span>Issue 4</span><span class="issue-label">: (AT RISK) Pending implementation feedback and security reviews.</span></div><p class="">
The Working Group is seeking implementer feedback on this cryptographic suite
as well as horizonal security review on the feature from parties at <abbr title="World Wide Web Consortium">W3C</abbr> and
IETF. Those reviews might result in significant changes to this algorithm, or
the removal of the algorithm from the specification during the Candidate
Recommendation phase.
        </p></div>

        <p>
The <code>ecdsa-sd-2023</code> cryptographic suite takes an input document, canonicalizes
the document using the <cite><a data-matched-text="[[[RDF-CANON]]]" href="https://www.w3.org/TR/rdf-canon/">RDF Dataset Canonicalization</a></cite>
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>], and then cryptographically hashes and signs the output
resulting in the production of a data integrity proof. The algorithms in this
section also include the verification of such a data integrity proof.
        </p>

        <section id="create-base-proof-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-1-create-base-proof-ecdsa-sd-2023"><bdi class="secno">3.6.1 </bdi>Create Base Proof (ecdsa-sd-2023)</h4><a class="self-link" href="#create-base-proof-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.1"></a></div>
          


          <p>
The following algorithm specifies how to create a <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> given
an <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a>. Required inputs are an
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data document</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>unsecuredDocument</var>), and a set of proof
options (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a> <var>options</var>). A <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a> (<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map">map</a>), or an error,
is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proof</var> be a clone of the proof options, <var>options</var>.
            </li>
            <li>
Let <var>proofConfig</var> be the result of running the algorithm in
Section <a href="#base-proof-configuration-ecdsa-sd-2023" data-matched-text="[[[#base-proof-configuration-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.4 </bdi>Base Proof Configuration (ecdsa-sd-2023)</a> with
<var>options</var> passed as a parameter.
            </li>
            <li>
Let <var>transformedData</var> be the result of running the algorithm in Section <a href="#base-proof-transformation-ecdsa-sd-2023" class="sec-ref"><bdi class="secno">3.6.2 </bdi>Base Proof Transformation (ecdsa-sd-2023)</a> with <var>unsecuredDocument</var>,
<var>proofConfig</var>, and <var>options</var> passed as parameters.
            </li>
            <li>
Let <var>hashData</var> be the result of running the algorithm in Section
<a href="#base-proof-hashing-ecdsa-sd-2023" data-matched-text="[[[#base-proof-hashing-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.3 </bdi>Base Proof Hashing (ecdsa-sd-2023)</a> with <var>transformedData</var> and <var>proofConfig</var>
passed as a parameters.
            </li>
            <li>
Let <var>proofBytes</var> be the result of running the algorithm in Section
<a href="#base-proof-serialization-ecdsa-sd-2023" data-matched-text="[[[#base-proof-serialization-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.5 </bdi>Base Proof Serialization (ecdsa-sd-2023)</a> with <var>hashData</var> and
<var>options</var> passed as parameters.
            </li>
            <li>
Let <var>proof</var>.<var>proofValue</var> be a <a href="https://www.w3.org/TR/controller-document/#multibase-0">
base64-url-encoded Multibase value</a> of the <var>proofBytes</var>.
            </li>
            <li>
Return <var>proof</var> as the <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-integrity/#dfn-data-integrity-proof">data integrity proof</a>.
            </li>
          </ol>
        </section>

        <section id="base-proof-transformation-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-2-base-proof-transformation-ecdsa-sd-2023"><bdi class="secno">3.6.2 </bdi>Base Proof Transformation (ecdsa-sd-2023)</h4><a class="self-link" href="#base-proof-transformation-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.2"></a></div>
          

          <p>
The following algorithm specifies how to transform an unsecured input document
into a transformed document that is ready to be provided as input to the
hashing algorithm in Section <a href="#base-proof-hashing-ecdsa-sd-2023" data-matched-text="[[[#base-proof-hashing-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.3 </bdi>Base Proof Hashing (ecdsa-sd-2023)</a>.
          </p>

          <p>
Required inputs to this algorithm are an
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">
unsecured data document</a> (<var>unsecuredDocument</var>) and
transformation options (<var>options</var>). The
transformation options <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>), a cryptosuite
identifier (<var>cryptosuite</var>), and a verification method
(<var>verificationMethod</var>). The transformation options <em class="rfc2119">MUST</em> contain an
array of mandatory JSON pointers (<var>mandatoryPointers</var>) and <em class="rfc2119">MAY</em> contain
additional options, such as a JSON-LD document loader. A <em>transformed data
document</em> is produced as output. Whenever this algorithm encodes strings, it
<em class="rfc2119">MUST</em> use UTF-8 encoding.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>hmac</var> to an HMAC API using a locally generated and exportable HMAC
key. The HMAC uses the same hash algorithm used in the signature algorithm,
which is detected via the <var>verificationMethod</var> provided to the
function, i.e., SHA-256 for a P-256 curve. Per the recommendations of
[<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2104" title="HMAC: Keyed-Hashing for Message Authentication">RFC2104</a></cite>], the HMAC key <em class="rfc2119">MUST</em> be the same length as the digest size; for SHA-256,
this is 256 bits or 32 bytes.
            </li>
            <li>
Initialize <var>labelMapFactoryFunction</var> to the result of calling the
<var>createHmacIdLabelMapFunction</var> algorithm passing <var>hmac</var>.
            </li>
            <li>
Initialize <var>groupDefinitions</var> to a map with an entry with a key of the string
"mandatory" and a value of <var>mandatoryPointers</var>.
            </li>
            <li>
Initialize <var>groups</var> to the result of calling the algorithm in Section
<a href="#canonicalizeandgroup" data-matched-text="[[[#canonicalizeandgroup]]]" class="sec-ref"><bdi class="secno">3.4.16 </bdi>canonicalizeAndGroup</a>, passing <var>labelMapFactoryFunction</var>,
<var>groupDefinitions</var>, <var>unsecuredDocument</var> as <var>document</var>, and any custom JSON-LD
API options. Note: This step transforms the document into an array of canonical
N-Quads with pseudorandom blank node identifiers based on <var>hmac</var>, and groups
the N-Quad strings according to selections based on JSON pointers.
            </li>
            <li>
Initialize <var>mandatory</var> to the values in the <var>groups</var>.<var>mandatory</var>.<var>matching</var> map.
            </li>
            <li>
Initialize <var>nonMandatory</var> to the values in the
<var>groups</var>.<var>mandatory</var>.<var>nonMatching</var> map.
            </li>
            <li>
Initialize <var>hmacKey</var> to the result of exporting the HMAC key from <var>hmac</var>.
            </li>
            <li>
Return an object with <code>mandatoryPointers</code> set to <var>mandatoryPointers</var>,
<code>mandatory</code> set to <var>mandatory</var>, <code>nonMandatory</code> set to <var>nonMandatory</var>,
and <code>hmacKey</code> set to <var>hmacKey</var>.
            </li>
          </ol>
        </section>

        <section id="base-proof-hashing-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-3-base-proof-hashing-ecdsa-sd-2023"><bdi class="secno">3.6.3 </bdi>Base Proof Hashing (ecdsa-sd-2023)</h4><a class="self-link" href="#base-proof-hashing-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.3"></a></div>
          

          <p>
The following algorithm specifies how to cryptographically hash a
<em>transformed data document</em> and <em>proof configuration</em>
into cryptographic hash data that is ready to be provided as input to the
algorithms in Section <a href="#base-proof-serialization-ecdsa-sd-2023" data-matched-text="[[[#base-proof-serialization-ecdsa-sd-2023]]]" class="sec-ref"><bdi class="secno">3.6.5 </bdi>Base Proof Serialization (ecdsa-sd-2023)</a>.
          </p>

          <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<var>transformedDocument</var>) and <em>canonical proof configuration</em>
(<var>canonicalProofConfig</var>). A <em>hash data</em> value represented
as an object is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>proofHash</var> to the result of calling the RDF Dataset Canonicalization
algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] on <var>canonicalProofConfig</var> and then cryptographically
hashing the result using the same hash that is used by the signature algorithm,
i.e., SHA-256 for a P-256 curve. Note: This step can be performed in parallel;
it only needs to be completed before this algorithm terminates as the result is
part of the return value.
            </li>
            <li>
Initialize <var>mandatoryHash</var> to the result of calling the the algorithm in Section
<a href="#hashmandatorynquads" data-matched-text="[[[#hashmandatorynquads]]]" class="sec-ref"><bdi class="secno">3.4.17 </bdi>hashMandatoryNQuads</a>, passing
<var>transformedDocument</var>.<var>mandatory</var>.
            </li>
            <li>
Initialize <var>hashData</var> as a deep copy of <var>transformedDocument</var> and
add <var>proofHash</var> as <code>proofHash</code> and <var>mandatoryHash</var> as <code>mandatoryHash</code> to that
object.
            </li>
            <li>
Return <var>hashData</var> as <em>hash data</em>.
            </li>
          </ol>

        </section>

        <section id="base-proof-configuration-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-4-base-proof-configuration-ecdsa-sd-2023"><bdi class="secno">3.6.4 </bdi>Base Proof Configuration (ecdsa-sd-2023)</h4><a class="self-link" href="#base-proof-configuration-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.4"></a></div>
          

          <p>
The following algorithm specifies how to generate a
<em>proof configuration</em> from a set of <em>proof options</em>
that is used as input to the
<a href="#base-proof-hashing-ecdsa-sd-2023">base proof hashing algorithm</a>.
          </p>

          <p>
The required inputs to this algorithm are <em>proof options</em>
(<var>options</var>) and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-unsecured-data-document">unsecured data
document</a> (<var>unsecuredDocument</var>).
The <em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier
for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MUST</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A <em>proof configuration</em>
object is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Let <var>proofConfig</var> be a clone of the <var>options</var> object.
            </li>
            <li>
If <var>proofConfig</var>.<var>type</var> is not set to <code>DataIntegrityProof</code> and/or
<var>proofConfig</var>.<var>cryptosuite</var> is not set to <code>ecdsa-sd-2023</code>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
If <var>proofConfig</var>.<var>created</var> is set and if the value is not a
valid [<cite><a class="bibref" data-link-type="biblio" href="#bib-xmlschema11-2" title="W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes">XMLSCHEMA11-2</a></cite>] datetime, an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an
error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_GENERATION_ERROR">PROOF_GENERATION_ERROR</a>.
            </li>
            <li>
Set <var>proofConfig</var>.<var>@context</var> to
<var>unsecuredDocument</var>.<var>@context</var>.
            </li>
            <li>
Let <var>canonicalProofConfig</var> be the result of applying the
<cite><a data-matched-text="[[[RDF-CANON]]]" href="https://www.w3.org/TR/rdf-canon/">RDF Dataset Canonicalization</a></cite> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] to the <var>proofConfig</var>.
            </li>
            <li>
Return <var>canonicalProofConfig</var>.
            </li>
          </ol>

        </section>

        <section id="base-proof-serialization-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-5-base-proof-serialization-ecdsa-sd-2023"><bdi class="secno">3.6.5 </bdi>Base Proof Serialization (ecdsa-sd-2023)</h4><a class="self-link" href="#base-proof-serialization-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.5"></a></div>
          

          <p>
The following algorithm specifies how to create a base proof; called by an
issuer of an ECDSA-SD-protected Verifiable Credential. The base proof is to be
given only to the holder, who is responsible for generating a derived proof from
it, exposing only selectively disclosed details in the proof to a verifier. This
algorithm is designed to be used in conjunction with the algorithms defined
in the Data Integrity [<cite><a class="bibref" data-link-type="biblio" href="#bib-vc-data-integrity" title="Verifiable Credential Data Integrity 1.0">VC-DATA-INTEGRITY</a></cite>] specification,
<a href="https://www.w3.org/TR/vc-data-integrity/#algorithms">
Section 4: Algorithms</a>. Required inputs are
cryptographic hash data (<var>hashData</var>) and
<em>proof options</em> (<var>options</var>). The
<em>proof options</em> <em class="rfc2119">MUST</em> contain a type identifier for the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-cryptosuite">
cryptographic suite</a> (<var>type</var>) and <em class="rfc2119">MAY</em> contain a cryptosuite
identifier (<var>cryptosuite</var>). A single <em>digital proof</em> value
represented as series of bytes is produced as output.
          </p>

          <ol class="algorithm">
            <li>
Initialize <var>proofHash</var>, <var>mandatoryPointers</var>, <var>mandatoryHash</var>, <var>nonMandatory</var>,
and <var>hmacKey</var> to the values associated with their property names
<var>hashData</var>.
            </li>
            <li>
Initialize <var>proofScopedKeyPair</var> to a locally generated P-256 ECDSA key pair.
Note: This key pair is scoped to the specific proof; it is not used for anything
else and the private key will be destroyed when this algorithm terminates.
            </li>
            <li>
Initialize <var>signatures</var> to an array where each element holds the result of
digitally signing the UTF-8 representation of each N-Quad string in
<var>nonMandatory</var>, in order. The digital signature algorithm is ES256, i.e., uses a
P-256 curve over a SHA-256 digest, and uses the private key from
<var>proofScopedKeyPair</var>. Note: This step generates individual signatures for each
statement that can be selectively disclosed using a local, proof-scoped key pair
that binds them together; this key pair will be bound to the proof by a
signature over its public key using the private key associated with the base
proof verification method.
            </li>
            <li>
Initialize <var>publicKey</var> to the multikey expression of the public key exported
from <var>proofScopedKeyPair</var>. That is, an array of bytes starting with the bytes
0x80 and 0x24 (which is the multikey p256-pub header (0x1200) expressed as a
varint) followed by the compressed public key bytes (the compressed header with
<code>2</code> for an even <code>y</code> coordinate and <code>3</code> for an odd one followed by the <code>x</code>
coordinate of the public key).
            </li>
            <li>
Initialize <var>toSign</var> to the result of calling the algorithm in Section
<a href="#serializesigndata" data-matched-text="[[[#serializesigndata]]]" class="sec-ref"><bdi class="secno">3.5.1 </bdi>serializeSignData</a>, passing <var>proofHash</var>, <var>publicKey</var>, and
<var>mandatoryHash</var> as parameters to the algorithm.
            </li>
            <li>
Initialize <var>baseSignature</var> to the result of digitally signing <var>toSign</var> using the
private key associated with the base proof verification method.
            </li>
            <li>
Initialize <var>proofValue</var> to the result of calling the algorithm in Section
<a href="#serializebaseproofvalue" data-matched-text="[[[#serializebaseproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.2 </bdi>serializeBaseProofValue</a>, passing <var>baseSignature</var>,
<var>publicKey</var>, <var>hmacKey</var>, <var>signatures</var>, and <var>mandatoryPointers</var> as parameters
to the algorithm.
            </li>
            <li>
Return <var>proofValue</var> as <em>digital proof</em>.
            </li>
          </ol>

        </section>

        <section id="add-derived-proof-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-6-add-derived-proof-ecdsa-sd-2023"><bdi class="secno">3.6.6 </bdi>Add Derived Proof (ecdsa-sd-2023)</h4><a class="self-link" href="#add-derived-proof-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.6"></a></div>
          

          <p>
The following algorithm creates a selective disclosure derived proof; called by
a holder of an <code>ecdsa-sd-2023</code>-protected <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>.
The derived proof is to be given to the <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifier">verifier</a>. The inputs include a
JSON-LD document (<var>document</var>), an ECDSA-SD base proof
(<var>proof</var>), an array of JSON pointers to use to selectively disclose
statements (<var>selectivePointers</var>), and any custom JSON-LD API options,
such as a document loader. A single <em>selectively revealed document</em>
value, represented as an object, is produced as output.
          </p>

          <ol>
            <li>
Initialize <var>baseSignature</var>, <var>publicKey</var>, <var>signatures</var>, <var>labelMap</var>,
<var>mandatoryIndexes</var>, <var>revealDocument</var> to the values associated with their
property names in the object returned when calling the algorithm in
Section <a href="#createdisclosuredata" data-matched-text="[[[#createdisclosuredata]]]" class="sec-ref"><bdi class="secno">3.5.4 </bdi>createDisclosureData</a>, passing the <var>document</var>, <var>proof</var>,
<var>selectivePointers</var>, and any custom JSON-LD API options, such as a document
loader.
            </li>
            <li>
Initialize <var>newProof</var> to a shallow copy of <var>proof</var>.
            </li>
            <li>
Replace <var>proofValue</var> in <var>newProof</var> with the result of calling the algorithm
in Section <a href="#serializederivedproofvalue" data-matched-text="[[[#serializederivedproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.7 </bdi>serializeDerivedProofValue</a>, passing
<var>baseSignature</var>, <var>publicKey</var>, <var>signatures</var>, <var>labelMap</var>, and <var>mandatoryIndexes</var>.
            </li>
            <li>
Set the value of the "proof" property in <var>revealDocument</var> to <var>newProof</var>.
            </li>
            <li>
Return <var>revealDocument</var> as the <em>selectively revealed document</em>.
            </li>
          </ol>

        </section>

        <section id="verify-derived-proof-ecdsa-sd-2023"><div class="header-wrapper"><h4 id="x3-6-7-verify-derived-proof-ecdsa-sd-2023"><bdi class="secno">3.6.7 </bdi>Verify Derived Proof (ecdsa-sd-2023)</h4><a class="self-link" href="#verify-derived-proof-ecdsa-sd-2023" aria-label="Permalink for Section 3.6.7"></a></div>
          

          <p>
The following algorithm attempts verification of an <code>ecdsa-sd-2023</code> derived
proof. This algorithm is called by a verifier of an ECDSA-SD-protected
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-verifiable-credential">verifiable credential</a>. The inputs include a JSON-LD document
(<var>document</var>), an ECDSA-SD disclosure proof (<var>proof</var>), and any
custom JSON-LD API options, such as a document loader. This algorithm returns
a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-4">verification result</a>:
          </p>

          <ol class="algorithm">
            <li>
Let <var>unsecuredDocument</var> be a copy of <var>document</var> with the <code>proof</code> value removed.
            </li>
            <li>
Initialize <var>baseSignature</var>, <var>proofHash</var>, <var>publicKey</var>, <var>signatures</var>,
<var>nonMandatory</var>, and <var>mandatoryHash</var> to the values associated with their property
names in the object returned when calling the algorithm in Section
<a href="#createverifydata" data-matched-text="[[[#createverifydata]]]" class="sec-ref"><bdi class="secno">3.5.9 </bdi>createVerifyData</a>, passing the <var>document</var>, <var>proof</var>, and any
custom JSON-LD API options, such as a document loader.
            </li>
            <li>
If the length of <var>signatures</var> does not match the length of <var>nonMandatory</var>,
an error <em class="rfc2119">MUST</em> be raised and <em class="rfc2119">SHOULD</em> convey an error type of
<a href="https://www.w3.org/TR/vc-data-integrity/#PROOF_VERIFICATION_ERROR">PROOF_VERIFICATION_ERROR</a>,
indicating that the signature count does not match
the non-mandatory message count.
            </li>
            <li>
Initialize <var>publicKeyBytes</var> to the public key bytes expressed in <var>publicKey</var>.
Instructions on how to decode the public key value can be found in Section
<a href="#multikey" data-matched-text="[[[#multikey]]]" class="sec-ref"><bdi class="secno">2.1.1 </bdi>Multikey</a>.
            </li>
            <li>
Initialize <var>toVerify</var> to the result of calling the algorithm in Setion
<a href="#serializesigndata" data-matched-text="[[[#serializesigndata]]]" class="sec-ref"><bdi class="secno">3.5.1 </bdi>serializeSignData</a>, passing <var>proofHash</var>, <var>publicKey</var>, and
<var>mandatoryHash</var>.
            </li>
            <li>
Initialize <var>verified</var> to true.
            </li>
            <li>
Initialize <var>verificationCheck</var> be the result of applying the verification
algorithm of the Elliptic Curve Digital Signature Algorithm (ECDSA) [FIPS-186-5],
with <var>toVerify</var> as the data to be verified against the <var>baseSignature</var> using
the public key specified by <var>publicKeyBytes</var>. If <var>verificationCheck</var> is
<code>false</code>, set <var>verified</var> to false.
            </li>
            <li>
For every entry (<var>index</var>, <var>signature</var>) in <var>signatures</var>, verify every signature
for every selectively disclosed (non-mandatory) statement:
              <ol class="algorithm">
                <li>
Initialize <var>verificationCheck</var> to the result of applying the verification
algorithm Elliptic Curve Digital Signature Algorithm (ECDSA) [FIPS-186-5], with
the UTF-8 representation of the value at <var>index</var> of <var>nonMandatory</var> as the data
to be verified against <var>signature</var> using the public key specified by
<var>publicKeyBytes</var>.
                </li>
                <li>
If <var>verificationCheck</var> is <code>false</code>, set <var>verified</var> to false.
                </li>
              </ol>
            </li>
            <li>
Return a <a data-link-type="dfn|abstract-op" href="#dfn-verification-result" class="internalDFN" id="ref-for-dfn-verification-result-5">verification result</a> with <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item">items</a>:
              <dl data-link-for="verification result">
                <dt><a data-link-type="dfn|abstract-op" href="#dfn-verified" class="internalDFN" id="ref-for-dfn-verified-6">verified</a></dt>
                <dd>The value of <var>verified</var></dd>
                <dt><a data-link-type="dfn|abstract-op" href="#dfn-verifieddocument" class="internalDFN" id="ref-for-dfn-verifieddocument-4">verifiedDocument</a></dt>
                <dd>
<var>unsecuredDocument</var> if <var>verified</var> is <code>true</code>, otherwise <a href="https://infra.spec.whatwg.org/#nulls">Null</a>
                </dd>
              </dl>
            </li>
          </ol>

        </section>

      </section>

    </section>
    <section class="informative" id="security-considerations"><div class="header-wrapper"><h2 id="x4-security-considerations"><bdi class="secno">4. </bdi>Security Considerations</h2><a class="self-link" href="#security-considerations" aria-label="Permalink for Section 4."></a></div><p><em>This section is non-normative.</em></p>
      

      <p class="advisement">
Before reading this section, readers are urged to familiarize themselves
with general security advice provided in the
<a href="https://www.w3.org/TR/vc-data-integrity/#security-considerations">
Security Considerations section of the Data Integrity specification</a>.
      </p>

      <p>
The integrity and authenticity of a secured document that is protected by
this cryptographic suite is dependent on a number of factors including
the following:
      </p>

      <ul>
        <li>
correct application of a digital signature to the document
        </li>
        <li>
choice of an appropriate signature algorithm (ECDSA) and its parameters
(P-256, P-384)
        </li>
        <li>
correct implementation and usage of the digital signature algorithm,
particularly with respect to well-known problem areas
        </li>
        <li>
proper management of the private and public keys used for
signing and verification
        </li>
      </ul>

      <p>
In the following sections, we review these important points and direct
the reader to additional information.
      </p>

      <section class="informative" id="choice-of-ecdsa-and-parameters"><div class="header-wrapper"><h3 id="x4-1-choice-of-ecdsa-and-parameters"><bdi class="secno">4.1 </bdi>Choice of ECDSA and Parameters</h3><a class="self-link" href="#choice-of-ecdsa-and-parameters" aria-label="Permalink for Section 4.1"></a></div><p><em>This section is non-normative.</em></p>
        
        <p>
The ECDSA signature scheme has the <strong>EUF-CMA</strong>
(<em>existential unforgeability under chosen message attacks</em>) security
property. This property guarantees that any efficient adversary who has the
public key <em>pk</em> of the signer and received an arbitrary number of
signatures on messages of its choice (in an adaptive manner) cannot output a
valid signature for a new message (except with negligible probability).
        </p>
        <p>
<strong>SUF-CMA</strong> (<em>strong unforgeability under chosen
message attacks</em>) is a stronger notion than <em>EUF-CMA</em>. It guarantees
that for any efficient adversary who has the public key <em>pk</em> of the
signer and received an arbitrary number of signatures on messages of its
choice, it cannot output a new valid signature pair for a new message
nor a new signature for an old message (except with negligible probability).
 ECDSA signature scheme does <strong>not</strong> have the SUF-CMA property,
 while other schemes such as EdDSA [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] do.
        </p>
        <p>
Per [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>] in the absence of large scale quantum
computers a <em>security strength</em> level of 128 bits requires a key size
of approximately 256 bits while a security strength level of 192 bits requires
a key size of 384 bits. [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-186" title="Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters">NIST-SP-800-186</a></cite>] recommendations includes curves
P-256 and P-384 at these respective security strength levels.
        </p>
      </section>
      <section class="informative" id="implementation-considerations-for-ecdsa-algorithms"><div class="header-wrapper"><h3 id="x4-2-implementation-considerations-for-ecdsa-algorithms"><bdi class="secno">4.2 </bdi>Implementation Considerations for ECDSA Algorithms</h3><a class="self-link" href="#implementation-considerations-for-ecdsa-algorithms" aria-label="Permalink for Section 4.2"></a></div><p><em>This section is non-normative.</em></p>
        
        <p>
The ECDSA algorithm as detailed in [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] states: "A
new secret random number <em>k</em>, 0 &lt; <em>k</em> &lt; <em>n</em>,
<strong>shall</strong> be generated prior to the generation
of each digital signature for use during the signature generation process."
The failure to properly generate this <em>k</em> value has lead to some highly
publicized integrity breaches in widely deployed systems. To counter this problem,
a hash-based method of determining the secret number <em>k</em>, called
<em>deterministic ECDSA</em>, is given in [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] and [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6979" title="Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)">RFC6979</a></cite>].
        </p>
        <p>
Verification of a ECDSA signature is independent of the method of generating
<em>k</em>. Hence it is generally recommended to use <em>deterministic
ECDSA</em> unless other requirements dictate otherwise. For example, using
different <em>k</em> values results in different signature values for the same
document which might be a desirable property in some privacy enhancing situations.
        </p>
      </section>
      <section class="informative" id="key-management"><div class="header-wrapper"><h3 id="x4-3-key-management"><bdi class="secno">4.3 </bdi>Key Management</h3><a class="self-link" href="#key-management" aria-label="Permalink for Section 4.3"></a></div><p><em>This section is non-normative.</em></p>
        
        <p>
The security of the ECDSA algorithm is dependent on the quality and
protection of its <em>private signing key</em>. Guidance in the management of
cryptographic keys is a large subject and the reader is referred to
[<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>] for more extensive recommendations and discussion.
As strongly recommended in both [<cite><a class="bibref" data-link-type="biblio" href="#bib-fips-186-5" title="FIPS PUB 186-5: Digital Signature Standard (DSS)">FIPS-186-5</a></cite>] and [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>], an ECDSA
private signing key is not to be used for any other purpose
than ECDSA signatures.
        </p>
        <p>
ECDSA private signing keys and <em>public verification keys</em> are strongly
advised to have limited <em>cryptoperiods</em> [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>], where
a <em>cryptoperiod</em> is "the time span during which a specific key is
authorized for use by legitimate entities or the keys for a given system will
remain in effect." [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>] gives extensive
guidance on cryptoperiods for different key types under different situations
and generally recommends a 1-3 year cryptoperiod for a private signing key.
        </p>
        <p>
To deal with potential private key compromises, [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>]
gives recommendations for protective measures, harm reduction, and revocation.
Although we have been emphasizing the security of the private signing key,
assurance of public key validity is highly recommended on all public keys
before using them, per [<cite><a class="bibref" data-link-type="biblio" href="#bib-nist-sp-800-57-part-1" title="Recommendation for Key Management: Part 1 – General">NIST-SP-800-57-Part-1</a></cite>].
        </p>
      </section>
    </section>

    <section id="privacy-considerations"><div class="header-wrapper"><h2 id="x5-privacy-considerations"><bdi class="secno">5. </bdi>Privacy Considerations</h2><a class="self-link" href="#privacy-considerations" aria-label="Permalink for Section 5."></a></div>
      

      <p class="advisement">
Before reading this section, readers are urged to familiarize themselves
with general privacy advice provided in the
<a href="https://www.w3.org/TR/vc-data-integrity/#privacy-considerations">
Privacy Considerations section of the Data Integrity specification</a>.
      </p>

      <p>
The following section describes privacy considerations that developers
implementing this specification should be aware of in order to avoid violating
privacy assumptions.
      </p>

      <section id="unlinkable-disclosure"><div class="header-wrapper"><h3 id="x5-1-unlinkable-disclosure"><bdi class="secno">5.1 </bdi>Unlinkable Disclosure</h3><a class="self-link" href="#unlinkable-disclosure" aria-label="Permalink for Section 5.1"></a></div>
        

        <p>
The cryptographic suites described in this specification do not support
<a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-unlinkable-disclosure">unlinkable disclosure</a>. If <a data-link-type="dfn" href="https://www.w3.org/TR/vc-data-model-2.0/#dfn-unlinkable-disclosure">unlinkable disclosure</a> is of interest, the
<cite><a data-matched-text="[[[?VC-DI-BBS]]]" href="https://www.w3.org/TR/vc-di-bbs/">Data Integrity BBS Cryptosuites v1.0</a></cite> specification provides an unlinkable digital signature
mechanism.
        </p>

      </section>

    </section>

    
    <section class="appendix informative" id="test-vectors"><div class="header-wrapper"><h2 id="a-test-vectors"><bdi class="secno">A. </bdi>Test Vectors</h2><a class="self-link" href="#test-vectors" aria-label="Permalink for Appendix A."></a></div><p><em>This section is non-normative.</em></p>
      
      <div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="3"><span>Note</span></div><p class="">
All test vectors are produced using <em>deterministic ECDSA</em>. The
implementation was validated against the test vectors in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc6979" title="Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)">RFC6979</a></cite>].
      </p></div>
      <section id="representation-ecdsa-rdfc-2019-with-curve-p-256"><div class="header-wrapper"><h3 id="a-1-representation-ecdsa-rdfc-2019-with-curve-p-256"><bdi class="secno">A.1 </bdi>Representation: ecdsa-rdfc-2019, with curve P-256</h3><a class="self-link" href="#representation-ecdsa-rdfc-2019-with-curve-p-256" aria-label="Permalink for Appendix A.1"></a></div>
        
        <p>
The signer needs to generate a private/public key pair with the private key used
for signing and the public key made available for verification. The
representation of the public key,
and the representation of the private key, are shown below.
        </p>
        <div class="example" id="example-private-and-public-keys-for-signature">
        <div class="marker">
    <a class="self-link" href="#example-private-and-public-keys-for-signature">Example<bdi> 5</bdi></a><span class="example-title">: Private and Public keys for Signature</span>
  </div> <pre class="nohighlight">{
  "publicKeyMultibase": "zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
  "secretKeyMultibase": "z42twTcNeSYcnqg1FLuSFs2bsGH3ZqbRHFmvS9XMsYhjxvHN"
}</pre>
      </div>

        <p>
Signing begins with a credential without an attached proof, which is converted
to canonical form, which is then hashed, as shown in the following three examples.
        </p>

        <div class="example" id="example-credential-without-proof">
        <div class="marker">
    <a class="self-link" href="#example-credential-without-proof">Example<bdi> 6</bdi></a><span class="example-title">: Credential without Proof</span>
  </div> <pre class="nohighlight">{
    "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2"
    ],
    "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
    "type": ["VerifiableCredential", "AlumniCredential"],
    "name": "Alumni Credential",
    "description": "A minimum viable example of an Alumni Credential.",
    "issuer": "https://vc.example/issuers/5678",
    "validFrom": "2023-01-01T00:00:00Z",
    "credentialSubject": {
        "id": "did:example:abcdefgh",
        "alumniOf": "The School of Examples"
    }
}</pre>
      </div>

        <div class="example" id="example-canonical-credential-without-proof">
        <div class="marker">
    <a class="self-link" href="#example-canonical-credential-without-proof">Example<bdi> 7</bdi></a><span class="example-title">: Canonical Credential without Proof</span>
  </div> <pre class="nohighlight">&lt;did:example:abcdefgh&gt; &lt;https://www.w3.org/ns/credentials/examples#alumniOf&gt; "The School of Examples" .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/2018/credentials#VerifiableCredential&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/ns/credentials/examples#AlumniCredential&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://schema.org/description&gt; "A minimum viable example of an Alumni Credential." .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://schema.org/name&gt; "Alumni Credential" .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#credentialSubject&gt; &lt;did:example:abcdefgh&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#issuer&gt; &lt;https://vc.example/issuers/5678&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#validFrom&gt; "2023-01-01T00:00:00Z"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; .</pre>
      </div>


        <div class="example" id="example-hash-of-canonical-credential-without-proof-hex">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-credential-without-proof-hex">Example<bdi> 8</bdi></a><span class="example-title">: Hash of Canonical Credential without Proof (hex)</span>
  </div> <pre class="nohighlight">517744132ae165a5349155bef0bb0cf2258fff99dfe1dbd914b938d775a36017</pre>
      </div>

        <p>
The next step is to take the proof options document, convert it to canonical form,
and obtain its hash, as shown in the next three examples.
        </p>

        <div class="example" id="example-proof-options-document">
        <div class="marker">
    <a class="self-link" href="#example-proof-options-document">Example<bdi> 9</bdi></a><span class="example-title">: Proof Options Document</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "ecdsa-rdfc-2019",
  "created": "2023-02-24T23:36:38Z",
  "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
  "proofPurpose": "assertionMethod",
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ]
}</pre>
      </div>

        <div class="example" id="example-canonical-proof-options-document">
        <div class="marker">
    <a class="self-link" href="#example-canonical-proof-options-document">Example<bdi> 10</bdi></a><span class="example-title">: Canonical Proof Options Document</span>
  </div> <pre class="nohighlight">_:c14n0 &lt;http://purl.org/dc/terms/created&gt; "2023-02-24T23:36:38Z"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; .
_:c14n0 &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://w3id.org/security#DataIntegrityProof&gt; .
_:c14n0 &lt;https://w3id.org/security#cryptosuite&gt; "ecdsa-rdfc-2019"^^&lt;https://w3id.org/security#cryptosuiteString&gt; .
_:c14n0 &lt;https://w3id.org/security#proofPurpose&gt; &lt;https://w3id.org/security#assertionMethod&gt; .
_:c14n0 &lt;https://w3id.org/security#verificationMethod&gt; &lt;did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP&gt; .</pre>
      </div>

        <div class="example" id="example-hash-of-canonical-proof-options-document-hex">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-proof-options-document-hex">Example<bdi> 11</bdi></a><span class="example-title">: Hash of Canonical Proof Options Document (hex)</span>
  </div> <pre class="nohighlight">3a8a522f689025727fb9d1f0fa99a618da023e8494ac74f51015d009d35abc2e</pre>
      </div>

        <p>
Finally, we concatenate the hash of the proof options followed by the hash of the credential without proof, use the private key with the combined hash to
compute the ECDSA signature, and then base-58-btc encode the signature.
        </p>

        <div class="example" id="example-combine-hashes-of-proof-options-and-credential-hex">
        <div class="marker">
    <a class="self-link" href="#example-combine-hashes-of-proof-options-and-credential-hex">Example<bdi> 12</bdi></a><span class="example-title">: Combine hashes of Proof Options and Credential (hex)</span>
  </div> <pre class="nohighlight">3a8a522f689025727fb9d1f0fa99a618da023e8494ac74f51015d009d35abc2e517744132ae165a5349155bef0bb0cf2258fff99dfe1dbd914b938d775a36017</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-hex">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-hex">Example<bdi> 13</bdi></a><span class="example-title">: Signature of Combined Hashes (hex)</span>
  </div> <pre class="nohighlight">1cb4290918ffb04a55ff7ae1e55e316a9990fda8eec67325eac7fcbf2ddf9dd2b06716a657e72b284c9604df3a172ecbf06a1a475b49ac807b1d9162df855636</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-base-58-btc">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-base-58-btc">Example<bdi> 14</bdi></a><span class="example-title">: Signature of Combined Hashes base-58-btc</span>
  </div> <pre class="nohighlight">zaHXrr7AQdydBk3ahpCDpWbxfLokDqmCToYm2dyWvpcFVyWooC2he63w1f7UNQoAMKdhaRtcnaE2KTo5o5vTCcfw</pre>
      </div>

        <p>Assemble the signed credential with the following two steps:</p>
        <ol>
          <li>
Add the <code>proofValue</code> field with the previously computed base-58-btc
value to the proof options document.
          </li>
          <li>
Set the <code>proof</code> field of the credential to the augmented proof
option document.
          </li>
        </ol>

        <div class="example" id="example-signed-credential">
        <div class="marker">
    <a class="self-link" href="#example-signed-credential">Example<bdi> 15</bdi></a><span class="example-title">: Signed Credential</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
  "type": [
    "VerifiableCredential",
    "AlumniCredential"
  ],
  "name": "Alumni Credential",
  "description": "A minimum viable example of an Alumni Credential.",
  "issuer": "https://vc.example/issuers/5678",
  "validFrom": "2023-01-01T00:00:00Z",
  "credentialSubject": {
    "id": "did:example:abcdefgh",
    "alumniOf": "The School of Examples"
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-rdfc-2019",
    "created": "2023-02-24T23:36:38Z",
    "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "zaHXrr7AQdydBk3ahpCDpWbxfLokDqmCToYm2dyWvpcFVyWooC2he63w1f7UNQoAMKdhaRtcnaE2KTo5o5vTCcfw"
  }
}</pre>
      </div>
      </section>
      <section id="representation-ecdsa-rdfc-2019-with-curve-p-384"><div class="header-wrapper"><h3 id="a-2-representation-ecdsa-rdfc-2019-with-curve-p-384"><bdi class="secno">A.2 </bdi>Representation: ecdsa-rdfc-2019, with curve P-384</h3><a class="self-link" href="#representation-ecdsa-rdfc-2019-with-curve-p-384" aria-label="Permalink for Appendix A.2"></a></div>
        
        <p>
The signer needs to generate a private/public key pair with the private key used
for signing and the public key made available for verification. The
representation of the public key,
and the representation of the private key, are shown below.
        </p>
        <div class="example" id="example-private-and-public-keys-for-signature-0">
        <div class="marker">
    <a class="self-link" href="#example-private-and-public-keys-for-signature-0">Example<bdi> 16</bdi></a><span class="example-title">: Private and Public keys for Signature</span>
  </div> <pre class="nohighlight">{
  "publicKeyMultibase": "z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
  "secretKeyMultibase": "z2fanyY7zgwNpZGxX5fXXibvScNaUWNprHU9dKx7qpVj7mws9J8LLt4mDB5TyH2GLHWkUc"
}</pre>
      </div>

        <p>
Signing begins with a credential without an attached proof, which is converted
to canonical form, and then hashed, as shown in the following three examples.
        </p>

        <div class="example" id="example-credential-without-proof-0">
        <div class="marker">
    <a class="self-link" href="#example-credential-without-proof-0">Example<bdi> 17</bdi></a><span class="example-title">: Credential without Proof</span>
  </div> <pre class="nohighlight">{
    "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2"
    ],
    "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
    "type": ["VerifiableCredential", "AlumniCredential"],
    "name": "Alumni Credential",
    "description": "A minimum viable example of an Alumni Credential.",
    "issuer": "https://vc.example/issuers/5678",
    "validFrom": "2023-01-01T00:00:00Z",
    "credentialSubject": {
        "id": "did:example:abcdefgh",
        "alumniOf": "The School of Examples"
    }
}</pre>
      </div>

        <div class="example" id="example-canonical-credential-without-proof-0">
        <div class="marker">
    <a class="self-link" href="#example-canonical-credential-without-proof-0">Example<bdi> 18</bdi></a><span class="example-title">: Canonical Credential without Proof</span>
  </div> <pre class="nohighlight">&lt;did:example:abcdefgh&gt; &lt;https://www.w3.org/ns/credentials/examples#alumniOf&gt; "The School of Examples" .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/2018/credentials#VerifiableCredential&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/ns/credentials/examples#AlumniCredential&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://schema.org/description&gt; "A minimum viable example of an Alumni Credential." .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://schema.org/name&gt; "Alumni Credential" .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#credentialSubject&gt; &lt;did:example:abcdefgh&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#issuer&gt; &lt;https://vc.example/issuers/5678&gt; .
&lt;urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33&gt; &lt;https://www.w3.org/2018/credentials#validFrom&gt; "2023-01-01T00:00:00Z"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; .</pre>
      </div>


        <div class="example" id="example-hash-of-canonical-credential-without-proof-hex-0">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-credential-without-proof-hex-0">Example<bdi> 19</bdi></a><span class="example-title">: Hash of Canonical Credential without Proof (hex)</span>
  </div> <pre class="nohighlight">8bf6e01df72c5b62f91b685231915ac4b8c58ea95f002c6b8f6bfafa1b251df476b56b8e01518e317dab099d3ecbff96</pre>
      </div>

        <p>
The next step is to take the proof options document, convert it to canonical form,
and obtain its hash, as shown in the next three examples.
        </p>

        <div class="example" id="example-proof-options-document-0">
        <div class="marker">
    <a class="self-link" href="#example-proof-options-document-0">Example<bdi> 20</bdi></a><span class="example-title">: Proof Options Document</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "ecdsa-rdfc-2019",
  "created": "2023-02-24T23:36:38Z",
  "verificationMethod": "did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
  "proofPurpose": "assertionMethod",
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ]
}</pre>
      </div>

        <div class="example" id="example-canonical-proof-options-document-0">
        <div class="marker">
    <a class="self-link" href="#example-canonical-proof-options-document-0">Example<bdi> 21</bdi></a><span class="example-title">: Canonical Proof Options Document</span>
  </div> <pre class="nohighlight">_:c14n0 &lt;http://purl.org/dc/terms/created&gt; "2023-02-24T23:36:38Z"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; .
_:c14n0 &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://w3id.org/security#DataIntegrityProof&gt; .
_:c14n0 &lt;https://w3id.org/security#cryptosuite&gt; "ecdsa-rdfc-2019"^^&lt;https://w3id.org/security#cryptosuiteString&gt; .
_:c14n0 &lt;https://w3id.org/security#proofPurpose&gt; &lt;https://w3id.org/security#assertionMethod&gt; .
_:c14n0 &lt;https://w3id.org/security#verificationMethod&gt; &lt;did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ&gt; .</pre>
      </div>

        <div class="example" id="example-hash-of-canonical-proof-options-document-hex-0">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-proof-options-document-hex-0">Example<bdi> 22</bdi></a><span class="example-title">: Hash of Canonical Proof Options Document (hex)</span>
  </div> <pre class="nohighlight">e32805a26492eac777aa7a138f6d8da3c74e0c7be7b296dcaccf97420c3b92eaad7be6449ca565e165031567f5c7cbc1</pre>
      </div>

        <p>
Finally, we concatenate the hash of the proof options followed by the hash of the credential without proof, use the private key with the combined hash to
compute the ECDSA signature, and then base-58-btc encode the signature.
        </p>

        <div class="example" id="example-combine-hashes-of-proof-options-and-credential-hex-0">
        <div class="marker">
    <a class="self-link" href="#example-combine-hashes-of-proof-options-and-credential-hex-0">Example<bdi> 23</bdi></a><span class="example-title">: Combine hashes of Proof Options and Credential (hex)</span>
  </div> <pre class="nohighlight">e32805a26492eac777aa7a138f6d8da3c74e0c7be7b296dcaccf97420c3b92eaad7be6449ca565e165031567f5c7cbc18bf6e01df72c5b62f91b685231915ac4b8c58ea95f002c6b8f6bfafa1b251df476b56b8e01518e317dab099d3ecbff96</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-hex-0">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-hex-0">Example<bdi> 24</bdi></a><span class="example-title">: Signature of Combined Hashes (hex)</span>
  </div> <pre class="nohighlight">177ac088806c2506d49f0bfec16056a6a80ace62cd029888ad561aba22a59d192d77d9b1fc28df80dea5ee6c8bceb16f1b8bff6bd6ff2d8f8778bdde48bafa7b6cc1f914c0168b5c04499882f632deea9cb7d977e888bb0e1ee9fb20ff03b025</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-base-58-btc-0">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-base-58-btc-0">Example<bdi> 25</bdi></a><span class="example-title">: Signature of Combined Hashes base-58-btc</span>
  </div> <pre class="nohighlight">z967Mvv5bxtmLNqTzPZ8KmJjFmFXaAKeQNzq7GWnQkMcLtaGSSmuozE5WtJ8PipMe178B1tE28K1vsJur9bGVJhz6jgSJsRHFSQeqgH8hhjcg8gZDFJC1b9FsR5ggNmDBqHv</pre>
      </div>

        <p>Assemble the signed credential with the following two steps:</p>
        <ol>
          <li>
Add the <code>proofValue</code> field with the previously computed base-58-btc
value to the proof options document.
          </li>
          <li>
Set the <code>proof</code> field of the credential to the augmented proof
option document.
          </li>
        </ol>

        <div class="example" id="example-signed-credential-0">
        <div class="marker">
    <a class="self-link" href="#example-signed-credential-0">Example<bdi> 26</bdi></a><span class="example-title">: Signed Credential</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
  "type": [
    "VerifiableCredential",
    "AlumniCredential"
  ],
  "name": "Alumni Credential",
  "description": "A minimum viable example of an Alumni Credential.",
  "issuer": "https://vc.example/issuers/5678",
  "validFrom": "2023-01-01T00:00:00Z",
  "credentialSubject": {
    "id": "did:example:abcdefgh",
    "alumniOf": "The School of Examples"
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-rdfc-2019",
    "created": "2023-02-24T23:36:38Z",
    "verificationMethod": "did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
    "proofPurpose": "assertionMethod",
    "proofValue": "z967Mvv5bxtmLNqTzPZ8KmJjFmFXaAKeQNzq7GWnQkMcLtaGSSmuozE5WtJ8PipMe178B1tE28K1vsJur9bGVJhz6jgSJsRHFSQeqgH8hhjcg8gZDFJC1b9FsR5ggNmDBqHv"
  }
}</pre>
      </div>
      </section>
      <section id="representation-ecdsa-jcs-2019-with-curve-p-256"><div class="header-wrapper"><h3 id="a-3-representation-ecdsa-jcs-2019-with-curve-p-256"><bdi class="secno">A.3 </bdi>Representation: ecdsa-jcs-2019 with curve P-256</h3><a class="self-link" href="#representation-ecdsa-jcs-2019-with-curve-p-256" aria-label="Permalink for Appendix A.3"></a></div>
        
        <p>
The signer needs to generate a private/public key pair with the private key used
for signing and the public key made available for verification. The
representation of the public key,
and the representation of the private key, are shown below.
        </p>
        <div class="example" id="example-private-and-public-keys-for-signature-1">
        <div class="marker">
    <a class="self-link" href="#example-private-and-public-keys-for-signature-1">Example<bdi> 27</bdi></a><span class="example-title">: Private and Public keys for Signature</span>
  </div> <pre class="nohighlight">{
  "publicKeyMultibase": "zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
  "secretKeyMultibase": "z42twTcNeSYcnqg1FLuSFs2bsGH3ZqbRHFmvS9XMsYhjxvHN"
}</pre>
      </div>

        <p>
Signing begins with a credential without an attached proof, which is converted
to canonical form, which is then hashed, as shown in the following three examples.
        </p>

        <div class="example" id="example-credential-without-proof-1">
        <div class="marker">
    <a class="self-link" href="#example-credential-without-proof-1">Example<bdi> 28</bdi></a><span class="example-title">: Credential without Proof</span>
  </div> <pre class="nohighlight">{
    "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2"
    ],
    "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
    "type": ["VerifiableCredential", "AlumniCredential"],
    "name": "Alumni Credential",
    "description": "A minimum viable example of an Alumni Credential.",
    "issuer": "https://vc.example/issuers/5678",
    "validFrom": "2023-01-01T00:00:00Z",
    "credentialSubject": {
        "id": "did:example:abcdefgh",
        "alumniOf": "The School of Examples"
    }
}</pre>
      </div>

        <div class="example" id="example-canonical-credential-without-proof-1">
        <div class="marker">
    <a class="self-link" href="#example-canonical-credential-without-proof-1">Example<bdi> 29</bdi></a><span class="example-title">: Canonical Credential without Proof</span>
  </div> <pre class="nohighlight">{"@context":["https://www.w3.org/ns/credentials/v2","https://www.w3.org/ns/credentials/examples/v2"],"credentialSubject":{"alumniOf":"The School of Examples","id":"did:example:abcdefgh"},"description":"A minimum viable example of an Alumni Credential.","id":"urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33","issuer":"https://vc.example/issuers/5678","name":"Alumni Credential","type":["VerifiableCredential","AlumniCredential"],"validFrom":"2023-01-01T00:00:00Z"}</pre>
      </div>


        <div class="example" id="example-hash-of-canonical-credential-without-proof-hex-1">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-credential-without-proof-hex-1">Example<bdi> 30</bdi></a><span class="example-title">: Hash of Canonical Credential without Proof (hex)</span>
  </div> <pre class="nohighlight">59b7cb6251b8991add1ce0bc83107e3db9dbbab5bd2c28f687db1a03abc92f19</pre>
      </div>

        <p>
The next step is to take the proof options document, convert it to canonical form,
and obtain its hash, as shown in the next three examples.
        </p>

        <div class="example" id="example-proof-options-document-1">
        <div class="marker">
    <a class="self-link" href="#example-proof-options-document-1">Example<bdi> 31</bdi></a><span class="example-title">: Proof Options Document</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "ecdsa-jcs-2019",
  "created": "2023-02-24T23:36:38Z",
  "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
  "proofPurpose": "assertionMethod"
}</pre>
      </div>

        <div class="example" id="example-canonical-proof-options-document-1">
        <div class="marker">
    <a class="self-link" href="#example-canonical-proof-options-document-1">Example<bdi> 32</bdi></a><span class="example-title">: Canonical Proof Options Document</span>
  </div> <pre class="nohighlight">{"created":"2023-02-24T23:36:38Z","cryptosuite":"ecdsa-jcs-2019","proofPurpose":"assertionMethod","type":"DataIntegrityProof","verificationMethod":"did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP"}</pre>
      </div>

        <div class="example" id="example-hash-of-canonical-proof-options-document-hex-1">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-proof-options-document-hex-1">Example<bdi> 33</bdi></a><span class="example-title">: Hash of Canonical Proof Options Document (hex)</span>
  </div> <pre class="nohighlight">9c4b552d65fcb106b6b27ec2436d8ae81b319afc7aeaab7964b2938cd120cec3</pre>
      </div>

        <p>
Finally, we concatenate the hash of the proof options followed by the hash of the credential without proof, use the private key with the combined hash to
compute the ECDSA signature, and then base-58-btc encode the signature.
        </p>

        <div class="example" id="example-combine-hashes-of-proof-options-and-credential-hex-1">
        <div class="marker">
    <a class="self-link" href="#example-combine-hashes-of-proof-options-and-credential-hex-1">Example<bdi> 34</bdi></a><span class="example-title">: Combine hashes of Proof Options and Credential (hex)</span>
  </div> <pre class="nohighlight">9c4b552d65fcb106b6b27ec2436d8ae81b319afc7aeaab7964b2938cd120cec359b7cb6251b8991add1ce0bc83107e3db9dbbab5bd2c28f687db1a03abc92f19</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-hex-1">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-hex-1">Example<bdi> 35</bdi></a><span class="example-title">: Signature of Combined Hashes (hex)</span>
  </div> <pre class="nohighlight">29793c6684cb7c3628e09ed5f14d06a37835cc9564b50fe1829c252c6bb9d14f52513c92533508ea4b4938ed523597b40b9584f395537b87592dc60d0f5ea9b7</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-base-58-btc-1">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-base-58-btc-1">Example<bdi> 36</bdi></a><span class="example-title">: Signature of Combined Hashes base-58-btc</span>
  </div> <pre class="nohighlight">zq6PrUMCtqY5obCSsrQxuFJdGffCDxvFuopdZiBPUBRTFEs1VVsBZi8YiEwVWgHYrXxoV93gBHqGDBtQLPFxpZxz</pre>
      </div>

        <p>Assemble the signed credential with the following three steps:</p>
        <ol>
          <li>
Add the <code>proofValue</code> field with the previously computed base-58-btc
value to the proof options document.
          </li>
          <li>
Set the proof options <code>@context</code> field to the value of the
<var>unsecuredDocument.@context</var>.
          </li>
          <li>
Set the <code>proof</code> field of the credential to the augmented proof
option document.
          </li>
        </ol>

        <div class="example" id="example-signed-credential-1">
        <div class="marker">
    <a class="self-link" href="#example-signed-credential-1">Example<bdi> 37</bdi></a><span class="example-title">: Signed Credential</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
  "type": [
    "VerifiableCredential",
    "AlumniCredential"
  ],
  "name": "Alumni Credential",
  "description": "A minimum viable example of an Alumni Credential.",
  "issuer": "https://vc.example/issuers/5678",
  "validFrom": "2023-01-01T00:00:00Z",
  "credentialSubject": {
    "id": "did:example:abcdefgh",
    "alumniOf": "The School of Examples"
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-jcs-2019",
    "created": "2023-02-24T23:36:38Z",
    "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "zq6PrUMCtqY5obCSsrQxuFJdGffCDxvFuopdZiBPUBRTFEs1VVsBZi8YiEwVWgHYrXxoV93gBHqGDBtQLPFxpZxz"
  }
}</pre>
      </div>
      </section>
      <section id="representation-ecdsa-jcs-2019-with-curve-p-384"><div class="header-wrapper"><h3 id="a-4-representation-ecdsa-jcs-2019-with-curve-p-384"><bdi class="secno">A.4 </bdi>Representation: ecdsa-jcs-2019 with curve P-384</h3><a class="self-link" href="#representation-ecdsa-jcs-2019-with-curve-p-384" aria-label="Permalink for Appendix A.4"></a></div>
        
        <p>
The signer needs to generate a private/public key pair with the private key used
for signing and the public key made available for verification. The
representation of the public key,
and the representation of the private key, are shown below.
        </p>
        <div class="example" id="example-private-and-public-keys-for-signature-2">
        <div class="marker">
    <a class="self-link" href="#example-private-and-public-keys-for-signature-2">Example<bdi> 38</bdi></a><span class="example-title">: Private and Public keys for Signature</span>
  </div> <pre class="nohighlight">{
  "publicKeyMultibase": "z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
  "secretKeyMultibase": "z2fanyY7zgwNpZGxX5fXXibvScNaUWNprHU9dKx7qpVj7mws9J8LLt4mDB5TyH2GLHWkUc"
}</pre>
      </div>

        <p>
Signing begins with a credential without an attached proof, which is converted
to canonical form, which is then hashed, as shown in the following three examples.
        </p>

        <div class="example" id="example-credential-without-proof-2">
        <div class="marker">
    <a class="self-link" href="#example-credential-without-proof-2">Example<bdi> 39</bdi></a><span class="example-title">: Credential without Proof</span>
  </div> <pre class="nohighlight">{
    "@context": [
        "https://www.w3.org/ns/credentials/v2",
        "https://www.w3.org/ns/credentials/examples/v2"
    ],
    "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
    "type": ["VerifiableCredential", "AlumniCredential"],
    "name": "Alumni Credential",
    "description": "A minimum viable example of an Alumni Credential.",
    "issuer": "https://vc.example/issuers/5678",
    "validFrom": "2023-01-01T00:00:00Z",
    "credentialSubject": {
        "id": "did:example:abcdefgh",
        "alumniOf": "The School of Examples"
    }
}</pre>
      </div>

        <div class="example" id="example-canonical-credential-without-proof-2">
        <div class="marker">
    <a class="self-link" href="#example-canonical-credential-without-proof-2">Example<bdi> 40</bdi></a><span class="example-title">: Canonical Credential without Proof</span>
  </div> <pre class="nohighlight">{"@context":["https://www.w3.org/ns/credentials/v2","https://www.w3.org/ns/credentials/examples/v2"],"credentialSubject":{"alumniOf":"The School of Examples","id":"did:example:abcdefgh"},"description":"A minimum viable example of an Alumni Credential.","id":"urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33","issuer":"https://vc.example/issuers/5678","name":"Alumni Credential","type":["VerifiableCredential","AlumniCredential"],"validFrom":"2023-01-01T00:00:00Z"}</pre>
      </div>


        <div class="example" id="example-hash-of-canonical-credential-without-proof-hex-2">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-credential-without-proof-hex-2">Example<bdi> 41</bdi></a><span class="example-title">: Hash of Canonical Credential without Proof (hex)</span>
  </div> <pre class="nohighlight">3e0be671cc1881035d463158c80921973dab3534d4f8dfacf4ff2725a4115eb718e49d66de0e90e7365cd6062abf2259</pre>
      </div>

        <p>
The next step is to take the proof options document, convert it to canonical form,
and obtain its hash, as shown in the next three examples.
        </p>

        <div class="example" id="example-proof-options-document-2">
        <div class="marker">
    <a class="self-link" href="#example-proof-options-document-2">Example<bdi> 42</bdi></a><span class="example-title">: Proof Options Document</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "ecdsa-jcs-2019",
  "created": "2023-02-24T23:36:38Z",
  "verificationMethod": "did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
  "proofPurpose": "assertionMethod"
}</pre>
      </div>

        <div class="example" id="example-canonical-proof-options-document-2">
        <div class="marker">
    <a class="self-link" href="#example-canonical-proof-options-document-2">Example<bdi> 43</bdi></a><span class="example-title">: Canonical Proof Options Document</span>
  </div> <pre class="nohighlight">{"created":"2023-02-24T23:36:38Z","cryptosuite":"ecdsa-jcs-2019","proofPurpose":"assertionMethod","type":"DataIntegrityProof","verificationMethod":"did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ"}</pre>
      </div>

        <div class="example" id="example-hash-of-canonical-proof-options-document-hex-2">
        <div class="marker">
    <a class="self-link" href="#example-hash-of-canonical-proof-options-document-hex-2">Example<bdi> 44</bdi></a><span class="example-title">: Hash of Canonical Proof Options Document (hex)</span>
  </div> <pre class="nohighlight">bb8fd231f3f5441c089210bb991ca21910ecb2c62e82111f9d4de1ac0db3e6f2fc5dbe33cffc3a08ec1165b7b3a8bedd</pre>
      </div>

        <p>
Finally, we concatenate the hash of the proof options followed by the hash of the credential without proof, use the private key with the combined hash to
compute the ECDSA signature, and then base-58-btc encode the signature.
        </p>

        <div class="example" id="example-combine-hashes-of-proof-options-and-credential-hex-2">
        <div class="marker">
    <a class="self-link" href="#example-combine-hashes-of-proof-options-and-credential-hex-2">Example<bdi> 45</bdi></a><span class="example-title">: Combine hashes of Proof Options and Credential (hex)</span>
  </div> <pre class="nohighlight">bb8fd231f3f5441c089210bb991ca21910ecb2c62e82111f9d4de1ac0db3e6f2fc5dbe33cffc3a08ec1165b7b3a8bedd3e0be671cc1881035d463158c80921973dab3534d4f8dfacf4ff2725a4115eb718e49d66de0e90e7365cd6062abf2259</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-hex-2">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-hex-2">Example<bdi> 46</bdi></a><span class="example-title">: Signature of Combined Hashes (hex)</span>
  </div> <pre class="nohighlight">45cf28964c4335b76efc2d3c9893735e3f2330f41928b5c18b507d1d6b6bd5a4c5ef3885b90d93ae6d79be92cf817b844dc444e4b645fa2f1f9f9251e97428edf49a412be93b348269f76cb39d20140fb621ee004e3500a5dbecd677530a146c</pre>
      </div>

        <div class="example" id="example-signature-of-combined-hashes-base-58-btc-2">
        <div class="marker">
    <a class="self-link" href="#example-signature-of-combined-hashes-base-58-btc-2">Example<bdi> 47</bdi></a><span class="example-title">: Signature of Combined Hashes base-58-btc</span>
  </div> <pre class="nohighlight">zR3krc7pt9Dpn1PY2u8HWPePggtzAG2SuH2ZGNrzw8Ku3QrFLWgDTjS5mCWy65ShixJEtpMwfviAFfh5xTgd5FGN1sSbpPJ5djqSZQLqQkY8KLBPNswuqKtq3bS8f9vEHm8w</pre>
      </div>

        <p>Assemble the signed credential with the following three steps:</p>
        <ol>
          <li>
Add the <code>proofValue</code> field with the previously computed base-58-btc
value to the proof options document.
          </li>
          <li>
Set the proof options <code>@context</code> field to the value of the
<var>unsecuredDocument.@context</var>.
          </li>
          <li>
Set the <code>proof</code> field of the credential to the augmented proof
option document.
          </li>
        </ol>

        <div class="example" id="example-signed-credential-2">
        <div class="marker">
    <a class="self-link" href="#example-signed-credential-2">Example<bdi> 48</bdi></a><span class="example-title">: Signed Credential</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://www.w3.org/ns/credentials/examples/v2"
  ],
  "id": "urn:uuid:58172aac-d8ba-11ed-83dd-0b3aef56cc33",
  "type": [
    "VerifiableCredential",
    "AlumniCredential"
  ],
  "name": "Alumni Credential",
  "description": "A minimum viable example of an Alumni Credential.",
  "issuer": "https://vc.example/issuers/5678",
  "validFrom": "2023-01-01T00:00:00Z",
  "credentialSubject": {
    "id": "did:example:abcdefgh",
    "alumniOf": "The School of Examples"
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-jcs-2019",
    "created": "2023-02-24T23:36:38Z",
    "verificationMethod": "did:key:z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ#z82LkuBieyGShVBhvtE2zoiD6Kma4tJGFtkAhxR5pfkp5QPw4LutoYWhvQCnGjdVn14kujQ",
    "proofPurpose": "assertionMethod",
    "proofValue": "zR3krc7pt9Dpn1PY2u8HWPePggtzAG2SuH2ZGNrzw8Ku3QrFLWgDTjS5mCWy65ShixJEtpMwfviAFfh5xTgd5FGN1sSbpPJ5djqSZQLqQkY8KLBPNswuqKtq3bS8f9vEHm8w"
  }
}</pre>
      </div>
      </section>
      <section id="representation-ecdsa-sd-2023"><div class="header-wrapper"><h3 id="a-5-representation-ecdsa-sd-2023"><bdi class="secno">A.5 </bdi>Representation: ecdsa-sd-2023</h3><a class="self-link" href="#representation-ecdsa-sd-2023" aria-label="Permalink for Appendix A.5"></a></div>
        
        <p>
To demonstrate selective disclosure features including mandatory disclosure,
selective disclosure, and overlap between mandatory and selective disclosure
requires an input credential document with more content than previous test
vectors. To avoid excessively long test vectors the starting document test
vector is based on a purely ficticious windsurfing (sailing) competition
scenario. In addition we break the test vectors into two groups based on those
that would be generated by the issuer (base proof) and those that would be
generated by the holder (derived proof).
        </p>
        <section id="base-proof"><div class="header-wrapper"><h4 id="a-5-1-base-proof"><bdi class="secno">A.5.1 </bdi>Base Proof</h4><a class="self-link" href="#base-proof" aria-label="Permalink for Appendix A.5.1"></a></div>
          
          <p>
In order to add a selective disclosure base proof to a document the issuer needs
the following cryptographic key material:
          </p>
          <ol>
            <li>
The issuers private/public key pair, i.e., the key pair corresponding to the
verification method that will be part of the proof.
            </li>
            <li>
A per proof private/public key pair created by the issuer just for this proof.
This is an ephemeral, single use key pair where the private key is not kept
after the proof has been generated.
            </li>
            <li>
An HMAC key. This used to randomize the order of the blank node ids to avoid
potential information leakage from the blank node id ordering. This is used only
once and is shared between issuer and holder. The HMAC in this case is
functioning as a pseudorandom function (PRF).
            </li>
          </ol>
          <p>
The key material used for generating the add base proof test vectors is shown
below. Multibase representation is use for the P-256 key pairs and the HMAC key
is given as a hexadecimal string.
          </p>
          <div class="example" id="example-private-and-public-keys-for-signature-3">
        <div class="marker">
    <a class="self-link" href="#example-private-and-public-keys-for-signature-3">Example<bdi> 49</bdi></a><span class="example-title">: Private and Public keys for Signature</span>
  </div> <pre class="nohighlight">{
  "baseKeyPair": {
    "publicKeyMultibase": "zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "secretKeyMultibase": "z42twTcNeSYcnqg1FLuSFs2bsGH3ZqbRHFmvS9XMsYhjxvHN"
  },
  "proofKeyPair": {
    "publicKeyMultibase": "zDnaeTHfhmSaQKBc7CmdL3K7oYg3D6SC7yowe2eBeVd2DH32r",
    "secretKeyMultibase": "z42tqvNGyzyXRzotAYn43UhcFtzDUVdxJ7461fwrfhBPLmfY"
  },
  "hmacKeyString": "00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF"
}</pre>
      </div>
          <p>
In our scenario a sailor is registering with a race organizer for a series of
windsurfing races to be held over a number of days on Maui. The organizer will
inspect the sailors equipment to certify that what has been declared is
 accurate. The sailors unsigned equipment inventory is shown below.
          </p>
          <div class="example" id="example-credential-without-proof-3">
        <div class="marker">
    <a class="self-link" href="#example-credential-without-proof-3">Example<bdi> 50</bdi></a><span class="example-title">: Credential without Proof</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    {
      "@vocab": "https://windsurf.grotto-networking.com/selective#"
    }
  ],
  "type": [
    "VerifiableCredential"
  ],
  "issuer": "https://vc.example/windsurf/racecommittee",
  "credentialSubject": {
    "sailNumber": "Earth101",
    "sails": [
      {
        "size": 5.5,
        "sailName": "Kihei",
        "year": 2023
      },
      {
        "size": 6.1,
        "sailName": "Lahaina",
        "year": 2023
      },
      {
        "size": 7.0,
        "sailName": "Lahaina",
        "year": 2020
      },
      {
        "size": 7.8,
        "sailName": "Lahaina",
        "year": 2023
      }
    ],
    "boards": [
      {
        "boardName": "CompFoil170",
        "brand": "Wailea",
        "year": 2022
      },
      {
        "boardName": "Kanaha Custom",
        "brand": "Wailea",
        "year": 2019
      }
    ]
  }
}</pre>
      </div>
          <p>
In addition to let other sailors know what kinds of equipment their competitors
maybe sailing on it is mandatory that each sailor disclose the year of their
most recent windsurfing board and full details on two of their sails. Note that
all sailors are identified by a sail number that is printed on all their
equipment. This mandatory information is specified via an array of JSON pointers
as shown below.
          </p>
          <div class="example" id="example-mandatory-pointers">
        <div class="marker">
    <a class="self-link" href="#example-mandatory-pointers">Example<bdi> 51</bdi></a><span class="example-title">: Mandatory Pointers</span>
  </div> <pre class="nohighlight">["/issuer", "/credentialSubject/sailNumber", "/credentialSubject/sails/1", "/credentialSubject/boards/0/year", "/credentialSubject/sails/2"]</pre>
      </div>
          <p>
The result of applying the above JSON pointers to the sailors equipment document
is shown below.
          </p>
          <div class="example" id="example-json-pointers-and-values">
        <div class="marker">
    <a class="self-link" href="#example-json-pointers-and-values">Example<bdi> 52</bdi></a><span class="example-title">: JSON Pointers and Values</span>
  </div> <pre class="nohighlight">[
  {
    "pointer": "/credentialSubject/sailNumber",
    "value": "Earth101"
  },
  {
    "pointer": "/credentialSubject/sails/1",
    "value": {
      "size": 6.1,
      "sailName": "Lahaina",
      "year": 2023
    }
  },
  {
    "pointer": "/credentialSubject/boards/0/year",
    "value": 2022
  },
  {
    "pointer": "/credentialSubject/sails/2",
    "value": {
      "size": 7,
      "sailName": "Lahaina",
      "year": 2020
    }
  }
]</pre>
      </div>
          <p>
Transformation of the unsigned document begins with canonicalizing the document
as shown below.
          </p>
          <div class="example" id="example-canonical-document">
        <div class="marker">
    <a class="self-link" href="#example-canonical-document">Example<bdi> 53</bdi></a><span class="example-title">: Canonical Document</span>
  </div> <pre class="nohighlight">[
  "_:c14n0 &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"CompFoil170\" .\n",
  "_:c14n0 &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n",
  "_:c14n0 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2022\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n1 &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:c14n1 &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7.8E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:c14n1 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n2 &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"Kanaha Custom\" .\n",
  "_:c14n2 &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n",
  "_:c14n2 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2019\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n3 &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:c14n3 &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n3 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2020\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n4 &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Kihei\" .\n",
  "_:c14n4 &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"5.5E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:c14n4 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:c14n0 .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:c14n2 .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#sailNumber&gt; \"Earth101\" .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:c14n1 .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:c14n3 .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:c14n4 .\n",
  "_:c14n5 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:c14n6 .\n",
  "_:c14n6 &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:c14n6 &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"6.1E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:c14n6 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:c14n7 &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/2018/credentials#VerifiableCredential&gt; .\n",
  "_:c14n7 &lt;https://www.w3.org/2018/credentials#credentialSubject&gt; _:c14n5 .\n",
  "_:c14n7 &lt;https://www.w3.org/2018/credentials#issuer&gt; &lt;https://vc.example/windsurf/racecommittee&gt; .\n"
]</pre>
      </div>
          <p>
To prevent possible information leakage from the ordering of the blank node ids
these are processed through a PRF, i.e., the HMAC to give the canonized HMAC
document shown below. This represents an ordered list of statements that will be
subject to mandatory and selective disclosure, i.e., it is from this list that
statements are grouped.
          </p>
          <div class="example" id="example-canonical-hmac-document">
        <div class="marker">
    <a class="self-link" href="#example-canonical-hmac-document">Example<bdi> 54</bdi></a><span class="example-title">: Canonical HMAC Document</span>
  </div> <pre class="nohighlight">[
  "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/2018/credentials#VerifiableCredential&gt; .\n",
  "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;https://www.w3.org/2018/credentials#credentialSubject&gt; _:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 .\n",
  "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;https://www.w3.org/2018/credentials#issuer&gt; &lt;https://vc.example/windsurf/racecommittee&gt; .\n",
  "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7.8E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"CompFoil170\" .\n",
  "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n",
  "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2022\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sailNumber&gt; \"Earth101\" .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk .\n",
  "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc .\n",
  "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"Kanaha Custom\" .\n",
  "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n",
  "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2019\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Kihei\" .\n",
  "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"5.5E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"6.1E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n",
  "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n",
  "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n",
  "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2020\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
]</pre>
      </div>
          <p>
The above canonical document gets grouped in to mandatory and non-mandatory
statements. The final output of the selective disclosure transformation process
is shown below. Each statement is now grouped as mandatory and non-mandatory and
its index in the previous list of statements is remembered.
          </p>
          <div class="example" id="example-add-base-transformation">
        <div class="marker">
    <a class="self-link" href="#example-add-base-transformation">Example<bdi> 55</bdi></a><span class="example-title">: Add Base Transformation</span>
  </div> <pre class="nohighlight">{
  "mandatoryPointers": [
    "/issuer",
    "/credentialSubject/sailNumber",
    "/credentialSubject/sails/1",
    "/credentialSubject/boards/0/year",
    "/credentialSubject/sails/2"
  ],
  "mandatory": {
    "dataType": "Map",
    "value": [
      [
        0,
        "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://www.w3.org/2018/credentials#VerifiableCredential&gt; .\n"
      ],
      [
        1,
        "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;https://www.w3.org/2018/credentials#credentialSubject&gt; _:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 .\n"
      ],
      [
        2,
        "_:u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY &lt;https://www.w3.org/2018/credentials#issuer&gt; &lt;https://vc.example/windsurf/racecommittee&gt; .\n"
      ],
      [
        8,
        "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2022\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ],
      [
        9,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 .\n"
      ],
      [
        11,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sailNumber&gt; \"Earth101\" .\n"
      ],
      [
        14,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk .\n"
      ],
      [
        15,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc .\n"
      ],
      [
        22,
        "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n"
      ],
      [
        23,
        "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"6.1E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n"
      ],
      [
        24,
        "_:uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ],
      [
        25,
        "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n"
      ],
      [
        26,
        "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ],
      [
        27,
        "_:ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2020\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ]
    ]
  },
  "nonMandatory": {
    "dataType": "Map",
    "value": [
      [
        3,
        "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Lahaina\" .\n"
      ],
      [
        4,
        "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"7.8E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n"
      ],
      [
        5,
        "_:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ],
      [
        6,
        "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"CompFoil170\" .\n"
      ],
      [
        7,
        "_:u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38 &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n"
      ],
      [
        10,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#boards&gt; _:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw .\n"
      ],
      [
        12,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:u3Lv2QpFgo-YAegc1cQQKWJFW2sEjQF6FfuZ0VEoMKHg .\n"
      ],
      [
        13,
        "_:uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0 &lt;https://windsurf.grotto-networking.com/selective#sails&gt; _:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ .\n"
      ],
      [
        16,
        "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#boardName&gt; \"Kanaha Custom\" .\n"
      ],
      [
        17,
        "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#brand&gt; \"Wailea\" .\n"
      ],
      [
        18,
        "_:uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2019\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ],
      [
        19,
        "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#sailName&gt; \"Kihei\" .\n"
      ],
      [
        20,
        "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#size&gt; \"5.5E0\"^^&lt;http://www.w3.org/2001/XMLSchema#double&gt; .\n"
      ],
      [
        21,
        "_:ufUWJRHQ9j1jmUKHLL8k6m0CZ8g4v73gOpaM5kL3ZACQ &lt;https://windsurf.grotto-networking.com/selective#year&gt; \"2023\"^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .\n"
      ]
    ]
  },
  "hmacKeyString": "00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF"
}</pre>
      </div>
          <p>
The next step is to create the base proof configuration and canonicalize it.
This is shown in the following two examples.
          </p>
          <div class="example" id="example-base-proof-configuration">
        <div class="marker">
    <a class="self-link" href="#example-base-proof-configuration">Example<bdi> 56</bdi></a><span class="example-title">: Base Proof Configuration</span>
  </div> <pre class="nohighlight">{
  "type": "DataIntegrityProof",
  "cryptosuite": "ecdsa-sd-2023",
  "created": "2023-08-15T23:36:38Z",
  "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
  "proofPurpose": "assertionMethod",
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    {
      "@vocab": "https://windsurf.grotto-networking.com/selective#"
    }
  ]
}</pre>
      </div>
          <div class="example" id="example-canonical-base-proof-configuration">
        <div class="marker">
    <a class="self-link" href="#example-canonical-base-proof-configuration">Example<bdi> 57</bdi></a><span class="example-title">: Canonical Base Proof Configuration</span>
  </div> <pre class="nohighlight">_:c14n0 &lt;http://purl.org/dc/terms/created&gt; "2023-08-15T23:36:38Z"^^&lt;http://www.w3.org/2001/XMLSchema#dateTime&gt; .
_:c14n0 &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt; &lt;https://w3id.org/security#DataIntegrityProof&gt; .
_:c14n0 &lt;https://w3id.org/security#cryptosuite&gt; "ecdsa-sd-2023"^^&lt;https://w3id.org/security#cryptosuiteString&gt; .
_:c14n0 &lt;https://w3id.org/security#proofPurpose&gt; &lt;https://w3id.org/security#assertionMethod&gt; .
_:c14n0 &lt;https://w3id.org/security#verificationMethod&gt; &lt;did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP&gt; .</pre>
      </div>
          <p>
In the hashing step we compute the SHA-256 hash of the canonicalized proof
options to produce the <code>proofHash</code> and we compute the SHA-256 hash of the join of
all the mandatory nquads to produce the <code>mandatoryHash</code>. These are shown below
in hexadecimal format.
          </p>
          <div class="example" id="example-add-base-hashes">
        <div class="marker">
    <a class="self-link" href="#example-add-base-hashes">Example<bdi> 58</bdi></a><span class="example-title">: Add Base Hashes</span>
  </div> <pre class="nohighlight">{
  "proofHash": "9c5c9b189f06cfa9d9f21a838ccb9b04316f07ad1a517bfd4955ee28c6a8229c",
  "mandatoryHash": "1994f6ce32483940032e56987a2a0cb6ea78b50944a77750c57f63801e30eca0"
}</pre>
      </div>
          <p>
We compute the <code>baseSignature</code> over the concatenation of the <code>proofHash</code>,
<code>proofPublicKey</code>, and <code>mandatoryHash</code> using the issuers long term <code>privateKey</code>.
We compute the <code>signatures</code> array by signing each non-mandatory nquad using the
per <code>proofPrivateKey</code>. These signatures, the <code>proofPublicKey</code>, and
<code>mandatoryPointers</code> which are fed to the final serialization step are
shown below.
          </p>
          <div class="example" id="example-add-base-signing">
        <div class="marker">
    <a class="self-link" href="#example-add-base-signing">Example<bdi> 59</bdi></a><span class="example-title">: Add Base Signing</span>
  </div> <pre class="nohighlight">{
  "baseSignature": "91628c3bcce94667dc50c92c1d432d64cedc26df0f98d2ec9632936214a2f2067bc005a72b806b39992b1f7759bf1296967c461bfd319455e6539b1ae7e8fbd5",
  "publicKey": "zDnaeTHfhmSaQKBc7CmdL3K7oYg3D6SC7yowe2eBeVd2DH32r",
  "signatures": [
    "29560a336e740c370d58e610a549980b567935984947089ef2f5547aff78406b2df375a1a16eff50ce8950bb0a8cd5478f1665650ca8bcde31c3533f9a19fa4c",
    "b2a312833d0479a3ded079a8e5237524d6660a3899f8234907849c9b22b8eacee10e8b4d66e187c4a19a0050b8dced05c5c29e502f7aabfcfd3c6785e42dd5a5",
    "99ea0453c235673c45c91f90331c284a4a911bd13cfc2692ae11fc4c3dadfad577d872800b884990a97ac47bb3e972f61be574726e9dfeb5a8ce386699568c8d",
    "6d030c724a5c300128d79582e82f0ca376c2116146b4e4e4331343f8b24c75f9024a8bc1ed19c247b497ce4e7ed1856282d27917383bd400286f9ca0d5634d93",
    "a501e56111a551592ff965f53a3258275f4ec3b8a9bd5c14be6f744a7dc88cd44bbb2f69af90c79b7c1595530f5692ea8d2f84f3f8c90de255e696346df2bf03",
    "6acdb0c7d6dc123d1287bb7cc3d0a3fb616971e1a975185a2d9c58b356441bcfa86d48dbd021cec87f12eeec03b67ee8496da8096d92a59be55feda35b5eeb9a",
    "7b7e1e43cfa0247c906a1634126661f26668cb4b2f9e94e391d70b9eba0b201b225647c2ccc28b396784b566545672017ae813f08d82ee69e6a47363768d9de2",
    "33ca240945fc178198c7dae59d20efaf9a531cf3a338e278ec9cc5743b57fd0e1b6715b02c6c2a96d6288c379ccade28c501d8cf9e594678535cb1ea6bbe01ed",
    "3bf1e3d2fc6cb89673a551ad82830a2b666518abe12d7dffbd40af74bf8c4e5b3356bda20b75c9a426ce73c07f5bf3a7f9cb1a2cfcd44af9520ed35e73565593",
    "766d87b78b2ffde737b351d1a9eba5fbec841b1e12ae9c3235045d2dae592b224382aaf887e12d54dcdcf89f95965bcaac737cc012ad52a6aba88e0da67af1ed",
    "39130b5d8cf7979f4ecdced20e4d9e8fb725adeafd067e9e6815101bbef702a439e9b73ea065de7a67a4c1908d1e314b38448da0dabba9eb4ef0545b8851dbe0",
    "5bea2d48556550f166835d7d9f74de484eeea798414b7e00a8fd93194400e690c6c8e4deb6b7fcaaaddb5a3d65a42bb567ac84649950ea7acb882a1a3558692f",
    "d705bf1e1b133d47d496a317e9932c2de9bc85b59a15efeb643a4fa7934dd36bcc1c89c38ced469f406b5d4c9500c9d36377c6ac38ecbb2dac1a033347e6e8d7",
    "bce1925c7e75791a025ad57d2e5a590f5d22c7422eb950a76ade5f47153b86a1acd00cccd3d906b26b833118e8c29e75c6188527788c6a320e3a159484fc470a"
  ],
  "mandatoryPointers": [
    "/issuer",
    "/credentialSubject/sailNumber",
    "/credentialSubject/sails/1",
    "/credentialSubject/boards/0/year",
    "/credentialSubject/sails/2"
  ]
}</pre>
      </div>
          <p>
Finally, the values above are run through the algorithm of Section
<a href="#serializebaseproofvalue" data-matched-text="[[[#serializebaseproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.2 </bdi>serializeBaseProofValue</a> to produce the <code>proofValue</code> which is
used in the signed based document shown below.
          </p>
          <div class="example" id="example-signed-base-document">
        <div class="marker">
    <a class="self-link" href="#example-signed-base-document">Example<bdi> 60</bdi></a><span class="example-title">: Signed Base Document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    {
      "@vocab": "https://windsurf.grotto-networking.com/selective#"
    }
  ],
  "type": [
    "VerifiableCredential"
  ],
  "issuer": "https://vc.example/windsurf/racecommittee",
  "credentialSubject": {
    "sailNumber": "Earth101",
    "sails": [
      {
        "size": 5.5,
        "sailName": "Kihei",
        "year": 2023
      },
      {
        "size": 6.1,
        "sailName": "Lahaina",
        "year": 2023
      },
      {
        "size": 7,
        "sailName": "Lahaina",
        "year": 2020
      },
      {
        "size": 7.8,
        "sailName": "Lahaina",
        "year": 2023
      }
    ],
    "boards": [
      {
        "boardName": "CompFoil170",
        "brand": "Wailea",
        "year": 2022
      },
      {
        "boardName": "Kanaha Custom",
        "brand": "Wailea",
        "year": 2019
      }
    ]
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-sd-2023",
    "created": "2023-08-15T23:36:38Z",
    "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "u2V0AhVhAkWKMO8zpRmfcUMksHUMtZM7cJt8PmNLsljKTYhSi8gZ7wAWnK4BrOZkrH3dZvxKWlnxGG_0xlFXmU5sa5-j71VgjgCQCKnLOGbY_FuM-ASpSkkOxsIR2E8n7Ml2q1UQ6tEwzi5NYIAARIjNEVWZ3iJmqu8zd7v8AESIzRFVmd4iZqrvM3e7_jlhAKVYKM250DDcNWOYQpUmYC1Z5NZhJRwie8vVUev94QGst83WhoW7_UM6JULsKjNVHjxZlZQyovN4xw1M_mhn6TFhAsqMSgz0EeaPe0Hmo5SN1JNZmCjiZ-CNJB4ScmyK46s7hDotNZuGHxKGaAFC43O0FxcKeUC96q_z9PGeF5C3VpVhAmeoEU8I1ZzxFyR-QMxwoSkqRG9E8_CaSrhH8TD2t-tV32HKAC4hJkKl6xHuz6XL2G-V0cm6d_rWozjhmmVaMjVhAbQMMckpcMAEo15WC6C8Mo3bCEWFGtOTkMxND-LJMdfkCSovB7RnCR7SXzk5-0YVigtJ5Fzg71AAob5yg1WNNk1hApQHlYRGlUVkv-WX1OjJYJ19Ow7ipvVwUvm90Sn3IjNRLuy9pr5DHm3wVlVMPVpLqjS-E8_jJDeJV5pY0bfK_A1hAas2wx9bcEj0Sh7t8w9Cj-2FpceGpdRhaLZxYs1ZEG8-obUjb0CHOyH8S7uwDtn7oSW2oCW2SpZvlX-2jW17rmlhAe34eQ8-gJHyQahY0EmZh8mZoy0svnpTjkdcLnroLIBsiVkfCzMKLOWeEtWZUVnIBeugT8I2C7mnmpHNjdo2d4lhAM8okCUX8F4GYx9rlnSDvr5pTHPOjOOJ47JzFdDtX_Q4bZxWwLGwqltYojDecyt4oxQHYz55ZRnhTXLHqa74B7VhAO_Hj0vxsuJZzpVGtgoMKK2ZlGKvhLX3_vUCvdL-MTlszVr2iC3XJpCbOc8B_W_On-csaLPzUSvlSDtNec1ZVk1hAdm2Ht4sv_ec3s1HRqeul--yEGx4SrpwyNQRdLa5ZKyJDgqr4h-EtVNzc-J-VllvKrHN8wBKtUqarqI4Npnrx7VhAORMLXYz3l59Ozc7SDk2ej7clrer9Bn6eaBUQG773AqQ56bc-oGXeemekwZCNHjFLOESNoNq7qetO8FRbiFHb4FhAW-otSFVlUPFmg119n3TeSE7up5hBS34AqP2TGUQA5pDGyOTetrf8qq3bWj1lpCu1Z6yEZJlQ6nrLiCoaNVhpL1hA1wW_HhsTPUfUlqMX6ZMsLem8hbWaFe_rZDpPp5NN02vMHInDjO1Gn0BrXUyVAMnTY3fGrDjsuy2sGgMzR-bo11hAvOGSXH51eRoCWtV9LlpZD10ix0IuuVCnat5fRxU7hqGs0AzM09kGsmuDMRjowp51xhiFJ3iMajIOOhWUhPxHCoVnL2lzc3VlcngdL2NyZWRlbnRpYWxTdWJqZWN0L3NhaWxOdW1iZXJ4Gi9jcmVkZW50aWFsU3ViamVjdC9zYWlscy8xeCAvY3JlZGVudGlhbFN1YmplY3QvYm9hcmRzLzAveWVhcngaL2NyZWRlbnRpYWxTdWJqZWN0L3NhaWxzLzI"
  }
}</pre>
      </div>
        </section>
        <section id="derived-proof"><div class="header-wrapper"><h4 id="a-5-2-derived-proof"><bdi class="secno">A.5.2 </bdi>Derived Proof</h4><a class="self-link" href="#derived-proof" aria-label="Permalink for Appendix A.5.2"></a></div>
          
          <p>
In order to create a derived proof a holder starts with a signed document
containing a base proof. The base document we will use for these test vectors is
the final example from Section <a href="#base-proof" data-matched-text="[[[#base-proof]]]" class="sec-ref"><bdi class="secno">A.5.1 </bdi>Base Proof</a> above. The first
step is to run the algorithm of Section <a href="#parsebaseproofvalue" data-matched-text="[[[#parsebaseproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.3 </bdi>parseBaseProofValue</a> to
recover <code>baseSignature</code>, <code>publicKey</code>, <code>hmacKey</code>, <code>signatures</code>, and
<code>mandatoryPointers</code> as shown below.
          </p>
          <div class="example" id="example-recovered-base-signature-data">
        <div class="marker">
    <a class="self-link" href="#example-recovered-base-signature-data">Example<bdi> 61</bdi></a><span class="example-title">: Recovered Base Signature Data</span>
  </div> <pre class="nohighlight">{
  "baseSignature": "91628c3bcce94667dc50c92c1d432d64cedc26df0f98d2ec9632936214a2f2067bc005a72b806b39992b1f7759bf1296967c461bfd319455e6539b1ae7e8fbd5",
  "proofPublicKey": "zDnaeTHfhmSaQKBc7CmdL3K7oYg3D6SC7yowe2eBeVd2DH32r",
  "hmacKey": "00112233445566778899aabbccddeeff00112233445566778899aabbccddeeff",
  "signatures": [
    "29560a336e740c370d58e610a549980b567935984947089ef2f5547aff78406b2df375a1a16eff50ce8950bb0a8cd5478f1665650ca8bcde31c3533f9a19fa4c",
    "b2a312833d0479a3ded079a8e5237524d6660a3899f8234907849c9b22b8eacee10e8b4d66e187c4a19a0050b8dced05c5c29e502f7aabfcfd3c6785e42dd5a5",
    "99ea0453c235673c45c91f90331c284a4a911bd13cfc2692ae11fc4c3dadfad577d872800b884990a97ac47bb3e972f61be574726e9dfeb5a8ce386699568c8d",
    "6d030c724a5c300128d79582e82f0ca376c2116146b4e4e4331343f8b24c75f9024a8bc1ed19c247b497ce4e7ed1856282d27917383bd400286f9ca0d5634d93",
    "a501e56111a551592ff965f53a3258275f4ec3b8a9bd5c14be6f744a7dc88cd44bbb2f69af90c79b7c1595530f5692ea8d2f84f3f8c90de255e696346df2bf03",
    "6acdb0c7d6dc123d1287bb7cc3d0a3fb616971e1a975185a2d9c58b356441bcfa86d48dbd021cec87f12eeec03b67ee8496da8096d92a59be55feda35b5eeb9a",
    "7b7e1e43cfa0247c906a1634126661f26668cb4b2f9e94e391d70b9eba0b201b225647c2ccc28b396784b566545672017ae813f08d82ee69e6a47363768d9de2",
    "33ca240945fc178198c7dae59d20efaf9a531cf3a338e278ec9cc5743b57fd0e1b6715b02c6c2a96d6288c379ccade28c501d8cf9e594678535cb1ea6bbe01ed",
    "3bf1e3d2fc6cb89673a551ad82830a2b666518abe12d7dffbd40af74bf8c4e5b3356bda20b75c9a426ce73c07f5bf3a7f9cb1a2cfcd44af9520ed35e73565593",
    "766d87b78b2ffde737b351d1a9eba5fbec841b1e12ae9c3235045d2dae592b224382aaf887e12d54dcdcf89f95965bcaac737cc012ad52a6aba88e0da67af1ed",
    "39130b5d8cf7979f4ecdced20e4d9e8fb725adeafd067e9e6815101bbef702a439e9b73ea065de7a67a4c1908d1e314b38448da0dabba9eb4ef0545b8851dbe0",
    "5bea2d48556550f166835d7d9f74de484eeea798414b7e00a8fd93194400e690c6c8e4deb6b7fcaaaddb5a3d65a42bb567ac84649950ea7acb882a1a3558692f",
    "d705bf1e1b133d47d496a317e9932c2de9bc85b59a15efeb643a4fa7934dd36bcc1c89c38ced469f406b5d4c9500c9d36377c6ac38ecbb2dac1a033347e6e8d7",
    "bce1925c7e75791a025ad57d2e5a590f5d22c7422eb950a76ade5f47153b86a1acd00cccd3d906b26b833118e8c29e75c6188527788c6a320e3a159484fc470a"
  ],
  "mandatoryPointers": [
    "/issuer",
    "/credentialSubject/sailNumber",
    "/credentialSubject/sails/1",
    "/credentialSubject/boards/0/year",
    "/credentialSubject/sails/2"
  ]
}</pre>
      </div>
          <p>
Next, the holder needs to indicate what, if anything else, they wish to reveal
to the verifiers by specifying JSON pointers for selective disclosure. In our
windsurfing competition scenario a sailor (the holder) has just completed their
first day of racing and wishes to reveal to the general public (the verifiers)
all the details of the windsurfing boards they used in the competition. These
are shown below. Note that this slightly overlaps with the mandatory disclosed
information which included only the year of their most recent board.
          </p>
          <div class="example" id="example-selective-disclosure-pointers">
        <div class="marker">
    <a class="self-link" href="#example-selective-disclosure-pointers">Example<bdi> 62</bdi></a><span class="example-title">: Selective Disclosure Pointers</span>
  </div> <pre class="nohighlight">["/credentialSubject/boards/0", "/credentialSubject/boards/1"]</pre>
      </div>
          <p>
To produce the <code>revealDocument</code>, i.e., the unsigned document that will
eventually be signed and sent to the verifier, we append the selective pointers
to the mandatory pointers and input these combined pointers along with the
document without proof to the algorithm of Section <a href="#selectjsonld" data-matched-text="[[[#selectjsonld]]]" class="sec-ref"><bdi class="secno">3.4.13 </bdi>selectJsonLd</a>
to give the result shown below.
          </p>
          <div class="example" id="example-unsigned-reveal-document">
        <div class="marker">
    <a class="self-link" href="#example-unsigned-reveal-document">Example<bdi> 63</bdi></a><span class="example-title">: Unsigned Reveal Document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    {
      "@vocab": "https://windsurf.grotto-networking.com/selective#"
    }
  ],
  "type": [
    "VerifiableCredential"
  ],
  "issuer": "https://vc.example/windsurf/racecommittee",
  "credentialSubject": {
    "sailNumber": "Earth101",
    "sails": [
      {
        "size": 6.1,
        "sailName": "Lahaina",
        "year": 2023
      },
      {
        "size": 7,
        "sailName": "Lahaina",
        "year": 2020
      }
    ],
    "boards": [
      {
        "year": 2022,
        "boardName": "CompFoil170",
        "brand": "Wailea"
      },
      {
        "boardName": "Kanaha Custom",
        "brand": "Wailea",
        "year": 2019
      }
    ]
  }
}</pre>
      </div>
          <p>
Now that we know what the revealed document looks like, we need to furnish
appropriately updated information to the verifier on which statements are
mandatory, the signatures for the selected non-mandatory statements, and the
mapping between canonical blank node ids for the reveal document and a subset of
the HMAC blank node ids. Running step 6 of the
<a href="#createdisclosuredata" data-matched-text="[[[#createdisclosuredata]]]" class="sec-ref"><bdi class="secno">3.5.4 </bdi>createDisclosureData</a> yields an abundance of information about
various statement groups relative to the original document. Below we show a
portion of the indexes for those groups.
          </p>
          <div class="example" id="example-derived-group-indexes">
        <div class="marker">
    <a class="self-link" href="#example-derived-group-indexes">Example<bdi> 64</bdi></a><span class="example-title">: Derived Group Indexes</span>
  </div> <pre class="nohighlight">{
  "combinedIndexes":[0,1,2,6,7,8,9,10,11,14,15,16,17,18,22,23,24,25,26,27],
  "mandatoryIndexes":[0,1,2,8,9,11,14,15,22,23,24,25,26,27],
  "nonMandatoryIndexes":[3,4,5,6,7,10,12,13,16,17,18,19,20,21],
  "selectiveIndexes":[0,1,6,7,8,9,10,16,17,18]
}</pre>
      </div>
          <p>
The verifier needs to be able to aggregate and hash the mandatory statements. To
enable this we furnish them with a list of indexes of the mandatory statements
adjusted to their positions in the reveal document. In the previous example the
<code>combinedIndexes</code> show the indexes of all the original nquads (statements) that
make up the reveal document, in order. To come up with the adjusted mandatory
indexes shown below we obtain the index of each of original mandatory indexes
relative to the <code>combinedIndexes</code> as shown below.
          </p>
          <div class="example" id="example-adjusted-mandatory-indexes">
        <div class="marker">
    <a class="self-link" href="#example-adjusted-mandatory-indexes">Example<bdi> 65</bdi></a><span class="example-title">: Adjusted Mandatory Indexes</span>
  </div> <pre class="nohighlight">{"adjMandatoryIndexes":[0,1,2,5,6,8,9,10,14,15,16,17,18,19]}</pre>
      </div>
          <p>
We have to furnish the verifier with a list of signatures for those selective
statements (nquads) that are not mandatory. The original list of signatures
corresponds to every non-mandatory statement and the indexes of these in the
original document are given above. We now compute a list of adjusted signature
indexes by computing the index of each selective index in the non-mandatory
index list, ignoring any selective index not present in the list. We then use
the adjusted signature indexes to obtain the filtered signature list. These
lists are shown below.
          </p>
          <div class="example" id="example-filtered-signatures">
        <div class="marker">
    <a class="self-link" href="#example-filtered-signatures">Example<bdi> 66</bdi></a><span class="example-title">: Filtered Signatures</span>
  </div> <pre class="nohighlight">{
    "adjSignatureIndexes": [3, 4, 5, 8, 9, 10],
    "filteredSignatures": [
        "6d030c724a5c300128d79582e82f0ca376c2116146b4e4e4331343f8b24c75f9024a8bc1ed19c247b497ce4e7ed1856282d27917383bd400286f9ca0d5634d93",
        "a501e56111a551592ff965f53a3258275f4ec3b8a9bd5c14be6f744a7dc88cd44bbb2f69af90c79b7c1595530f5692ea8d2f84f3f8c90de255e696346df2bf03",
        "6acdb0c7d6dc123d1287bb7cc3d0a3fb616971e1a975185a2d9c58b356441bcfa86d48dbd021cec87f12eeec03b67ee8496da8096d92a59be55feda35b5eeb9a",
        "3bf1e3d2fc6cb89673a551ad82830a2b666518abe12d7dffbd40af74bf8c4e5b3356bda20b75c9a426ce73c07f5bf3a7f9cb1a2cfcd44af9520ed35e73565593",
        "766d87b78b2ffde737b351d1a9eba5fbec841b1e12ae9c3235045d2dae592b224382aaf887e12d54dcdcf89f95965bcaac737cc012ad52a6aba88e0da67af1ed",
        "39130b5d8cf7979f4ecdced20e4d9e8fb725adeafd067e9e6815101bbef702a439e9b73ea065de7a67a4c1908d1e314b38448da0dabba9eb4ef0545b8851dbe0"
    ]
}</pre>
      </div>
          <p>
The last important piece of disclosure data is a mapping of canonical blank node
ids to HMAC based ids, the <code>labelMap</code>, computed according to Section
<a href="#createdisclosuredata" data-matched-text="[[[#createdisclosuredata]]]" class="sec-ref"><bdi class="secno">3.5.4 </bdi>createDisclosureData</a> steps 12-14. This is shown below along with
the rest of the disclosure data minus the reveal document.
          </p>
          <div class="example" id="example-disclosure-data">
        <div class="marker">
    <a class="self-link" href="#example-disclosure-data">Example<bdi> 67</bdi></a><span class="example-title">: Disclosure Data</span>
  </div> <pre class="nohighlight">{
  "baseSignature": "91628c3bcce94667dc50c92c1d432d64cedc26df0f98d2ec9632936214a2f2067bc005a72b806b39992b1f7759bf1296967c461bfd319455e6539b1ae7e8fbd5",
  "publicKey": "zDnaeTHfhmSaQKBc7CmdL3K7oYg3D6SC7yowe2eBeVd2DH32r",
  "signatures": [
    "6d030c724a5c300128d79582e82f0ca376c2116146b4e4e4331343f8b24c75f9024a8bc1ed19c247b497ce4e7ed1856282d27917383bd400286f9ca0d5634d93",
    "a501e56111a551592ff965f53a3258275f4ec3b8a9bd5c14be6f744a7dc88cd44bbb2f69af90c79b7c1595530f5692ea8d2f84f3f8c90de255e696346df2bf03",
    "6acdb0c7d6dc123d1287bb7cc3d0a3fb616971e1a975185a2d9c58b356441bcfa86d48dbd021cec87f12eeec03b67ee8496da8096d92a59be55feda35b5eeb9a",
    "3bf1e3d2fc6cb89673a551ad82830a2b666518abe12d7dffbd40af74bf8c4e5b3356bda20b75c9a426ce73c07f5bf3a7f9cb1a2cfcd44af9520ed35e73565593",
    "766d87b78b2ffde737b351d1a9eba5fbec841b1e12ae9c3235045d2dae592b224382aaf887e12d54dcdcf89f95965bcaac737cc012ad52a6aba88e0da67af1ed",
    "39130b5d8cf7979f4ecdced20e4d9e8fb725adeafd067e9e6815101bbef702a439e9b73ea065de7a67a4c1908d1e314b38448da0dabba9eb4ef0545b8851dbe0"
  ],
  "labelMap": {
    "dataType": "Map",
    "value": [
      [
        "c14n0",
        "u4YIOZn1MHES1Z4Ij2hWZG3R4dEYBqg5fHTyDEvYhC38"
      ],
      [
        "c14n1",
        "uVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKw"
      ],
      [
        "c14n2",
        "uQ-qOZUDlozRsGk46ux9gp9fjT28Fy3g3nctmMoqi_U0"
      ],
      [
        "c14n3",
        "ukR2991GJuy_Tkjem_x7pLVpS4C4GkZAcuGtiPhBfSSc"
      ],
      [
        "c14n4",
        "uk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDk"
      ],
      [
        "c14n5",
        "u2IE-HtO6PyHQsGnuqhO1mX6V7RkRREhF0d0sWZlxNOY"
      ]
    ]
  },
  "mandatoryIndexes": [
    0,
    1,
    2,
    5,
    6,
    8,
    9,
    10,
    14,
    15,
    16,
    17,
    18,
    19
  ]
}</pre>
      </div>
          <p>
Finally using the disclosure data above with the algorithm of Section
<a href="#serializederivedproofvalue" data-matched-text="[[[#serializederivedproofvalue]]]" class="sec-ref"><bdi class="secno">3.5.7 </bdi>serializeDerivedProofValue</a> we obtain the signed derived (reveal)
document shown below.
          </p>
          <div class="example" id="example-signed-derived-document">
        <div class="marker">
    <a class="self-link" href="#example-signed-derived-document">Example<bdi> 68</bdi></a><span class="example-title">: Signed Derived Document</span>
  </div> <pre class="nohighlight">{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    {
      "@vocab": "https://windsurf.grotto-networking.com/selective#"
    }
  ],
  "type": [
    "VerifiableCredential"
  ],
  "issuer": "https://vc.example/windsurf/racecommittee",
  "credentialSubject": {
    "sailNumber": "Earth101",
    "sails": [
      {
        "size": 6.1,
        "sailName": "Lahaina",
        "year": 2023
      },
      {
        "size": 7,
        "sailName": "Lahaina",
        "year": 2020
      }
    ],
    "boards": [
      {
        "year": 2022,
        "boardName": "CompFoil170",
        "brand": "Wailea"
      },
      {
        "boardName": "Kanaha Custom",
        "brand": "Wailea",
        "year": 2019
      }
    ]
  },
  "proof": {
    "type": "DataIntegrityProof",
    "cryptosuite": "ecdsa-sd-2023",
    "created": "2023-08-15T23:36:38Z",
    "verificationMethod": "did:key:zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP#zDnaepBuvsQ8cpsWrVKw8fbpGpvPeNSjVPTWoq6cRqaYzBKVP",
    "proofPurpose": "assertionMethod",
    "proofValue": "u2V0BhVhAkWKMO8zpRmfcUMksHUMtZM7cJt8PmNLsljKTYhSi8gZ7wAWnK4BrOZkrH3dZvxKWlnxGG_0xlFXmU5sa5-j71VgjgCQCKnLOGbY_FuM-ASpSkkOxsIR2E8n7Ml2q1UQ6tEwzi5OGWEBtAwxySlwwASjXlYLoLwyjdsIRYUa05OQzE0P4skx1-QJKi8HtGcJHtJfOTn7RhWKC0nkXODvUAChvnKDVY02TWEClAeVhEaVRWS_5ZfU6MlgnX07DuKm9XBS-b3RKfciM1Eu7L2mvkMebfBWVUw9WkuqNL4Tz-MkN4lXmljRt8r8DWEBqzbDH1twSPRKHu3zD0KP7YWlx4al1GFotnFizVkQbz6htSNvQIc7IfxLu7AO2fuhJbagJbZKlm-Vf7aNbXuuaWEA78ePS_Gy4lnOlUa2CgworZmUYq-Etff-9QK90v4xOWzNWvaILdcmkJs5zwH9b86f5yxos_NRK-VIO015zVlWTWEB2bYe3iy_95zezUdGp66X77IQbHhKunDI1BF0trlkrIkOCqviH4S1U3Nz4n5WWW8qsc3zAEq1Spquojg2mevHtWEA5EwtdjPeXn07NztIOTZ6PtyWt6v0Gfp5oFRAbvvcCpDnptz6gZd56Z6TBkI0eMUs4RI2g2rup607wVFuIUdvgpgBYIOGCDmZ9TBxEtWeCI9oVmRt0eHRGAaoOXx08gxL2IQt_AVggVkUuBrlOaELGVQWJD4M_qW5bcKEHWGNbOrPA_qAOKKwCWCBD6o5lQOWjNGwaTjq7H2Cn1-NPbwXLeDedy2YyiqL9TQNYIJEdvfdRibsv05I3pv8e6S1aUuAuBpGQHLhrYj4QX0knBFggk0AeXgJ4e6m1XsV5-xFud0L_1mUjZ9Mffhg5aZGTyDkFWCDYgT4e07o_IdCwae6qE7WZfpXtGRFESEXR3SxZmXE05o4AAQIFBggJCg4PEBESEw"
  }
}</pre>
      </div>
        </section>
      </section>
    </section>

    <section class="informative" id="revision-history"><div class="header-wrapper"><h2 id="b-revision-history"><bdi class="secno">B. </bdi>Revision History</h2><a class="self-link" href="#revision-history" aria-label="Permalink for Section B."></a></div><p><em>This section is non-normative.</em></p>
      

      <p>
This section contains the substantive changes that have been made to this
specification over time.
      </p>

      <p>
Changes since the
<a href="https://www.w3.org/TR/2023/CR-vc-di-ecdsa-20231121/">
First Candidate Recommendation</a>:
      </p>

      <ul>
        <li>
Various editorial changes in algorithms and descriptions to improve readability.
        </li>
        <li>
Moved Multikey definitions to Controller Document.
        </li>
        <li>
Update examples to align with updates in Data Integrity.
        </li>
        <li>
Specify HMAC reference and key sizes for selective disclosure blank node mixing.
        </li>
        <li>
Unify error handling between all Data Integrity cryptosuites.
        </li>
        <li>
Ensure that the <code>created</code> proof option is not required and additional proof
options are included in the generated proof.
        </li>
        <li>
Move language related to context injection to Data Integrity.
        </li>
        <li>
Align proof serialization format and algorithm arguments with interfaces
defined in Data Integrity.
        </li>
      </ul>

      <p>
Changes since the
<a href="https://www.w3.org/TR/2023/WD-vc-di-ecdsa-20230418/">
First Public Working Draft</a>:
      </p>

      <ul>
        <li>
Added cryptography suite that uses JSON Canonicalization Scheme.
        </li>
        <li>
Added test vectors for ECDSA (rdfc and jcs).
        </li>
        <li>
Moved normative definition of Multikey to Data Integrity specification.
        </li>
        <li>
Added selective disclosure functions.
        </li>
        <li>
Added cryptography suite for ecdsa-sd-2023.
        </li>
        <li>
Mitigated poison datasets in ECDSA when canonicalizing.
        </li>
        <li>
Renamed cryptosuite names to align across all cryptosuites.
        </li>
        <li>
Ensured that strong guidance to use Deterministic ECDSA is used, if available.
        </li>
        <li>
Specify how to send cryptographic hash function to [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-canon" title="RDF Dataset Canonicalization">RDF-CANON</a></cite>] if used.
        </li>
        <li>
Add <code>secretKeymultibase</code> representation.
        </li>
      </ul>
    </section>

    <section class="informative" id="acknowledgements"><div class="header-wrapper"><h2 id="c-acknowledgements"><bdi class="secno">C. </bdi>Acknowledgements</h2><a class="self-link" href="#acknowledgements" aria-label="Permalink for Section C."></a></div><p><em>This section is non-normative.</em></p>
      

      <p>
Work on this specification has been supported by the Rebooting the Web of Trust
community facilitated by Christopher Allen, Shannon Appelcline, Kiara Robles,
Brian Weller, Betty Dhamers, Kaliya Young, Manu Sporny, Drummond Reed, Joe
Andrieu, Heather Vescent, Kim Hamilton Duffy, Samantha Chase, Andrew Hughes,
Erica Connell, Shigeya Suzuki, and Zaïda Rivai. The participants in the Internet
Identity Workshop, facilitated by Phil Windley, Kaliya Young, Doc Searls, and
Heidi Nobantu Saul, also supported the refinement of this work through numerous
working sessions designed to educate about, debate on, and improve this
specification.
      </p>

      <p>
The Working Group also thanks our Chair, Brent Zundel, our ex-Chair Kristina
Yasuda, as well as our <abbr title="World Wide Web Consortium">W3C</abbr> Staff Contact, Ivan Herman, for their expert
management and steady guidance of the group through the <abbr title="World Wide Web Consortium">W3C</abbr> standardization
process.
      </p>

      <p>
Portions of the work on this specification have been funded by the United States
Department of Homeland Security's Science and Technology Directorate under
contracts 70RSAT20T00000029, 70RSAT21T00000016, 70RSAT23T00000005,
70RSAT20T00000010/P00001, 70RSAT20T00000029, 70RSAT21T00000016/P00001,
70RSAT23T00000005, 70RSAT23C00000030, 70RSAT23R00000006, 70RSAT24T00000011, and the National
Science Foundation through NSF 22-572. The content of this specification does
not necessarily reflect the position or the policy of the U.S. Government and no
official endorsement should be inferred.
      </p>

      <p>
The Working Group would like to thank the following individuals for reviewing
and providing feedback on the specification (in alphabetical order):
      </p>

      <p>
Will Abramson,
Mahmoud Alkhraishi,
Christopher Allen,
Joe Andrieu,
Bohdan Andriyiv,
Anthony,
George Aristy,
Hadley Beeman,
Greg Bernstein,
Bob420,
Sarven Capadisli,
Melvin Carvalho,
David Chadwick,
Matt Collier,
Gabe Cohen,
Sebastian Crane,
Kyle Den Hartog,
Veikko Eeva,
Eric Elliott,
Raphael Flechtner,
Julien Fraichot,
Benjamin Goering,
Kim Hamilton Duffy,
Joseph Heenan,
Helge,
Ivan Herman,
Michael Herman,
Anil John,
Andrew Jones,
Michael B. Jones,
Rieks Joosten,
Gregory K,
Gregg Kellogg,
Filip Kolarik,
David I. Lehn,
Charles E. Lehner,
Christine Lemmer-Webber,
Eric Lim,
Dave Longley,
Tobias Looker,
Jer Miller,
nightpool,
Luis Osta,
Nate Otto,
George J. Padayatti,
Addison Phillips,
Mike Prorock,
Brian Richter,
Anders Rundgren,
Eugeniu Rusu,
Markus Sabadello,
silverpill,
Wesley Smith,
Manu Sporny,
Patrick St-Louis,
Orie Steele,
Henry Story,
Oliver Terbu,
Ted Thibodeau Jr,
John Toohey,
Bert Van Nuffelen,
Mike Varley,
Snorre Lothar von Gohren Edwin,
Jeffrey Yasskin,
Kristina Yasuda,
Benjamin Young,
Dmitri Zagidulin,
and
Brent Zundel.
      </p>

    </section>

  

<section id="references" class="appendix"><div class="header-wrapper"><h2 id="d-references"><bdi class="secno">D. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix D."></a></div><section id="normative-references"><div class="header-wrapper"><h3 id="d-1-normative-references"><bdi class="secno">D.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix D.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-controller-document">[controller-document]</dt><dd>
      <a href="https://www.w3.org/TR/controller-document/"><cite>Controlled Identifier Document 1.0</cite></a>. Manu Sporny; Michael Jones.  W3C. 9 December 2024. W3C Working Draft. URL: <a href="https://www.w3.org/TR/controller-document/">https://www.w3.org/TR/controller-document/</a>
    </dd><dt id="bib-fips-186-5">[FIPS-186-5]</dt><dd>
      <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5.pdf"><cite>FIPS PUB 186-5: Digital Signature Standard (DSS)</cite></a>.  U.S. Department of Commerce/National Institute of Standards and Technology. 3 February 2023. National Standard. URL: <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-5.pdf</a>
    </dd><dt id="bib-infra">[INFRA]</dt><dd>
      <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Anne van Kesteren; Domenic Denicola.  WHATWG. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
    </dd><dt id="bib-json-ld11-api">[JSON-LD11-API]</dt><dd>
      <a href="https://www.w3.org/TR/json-ld11-api/"><cite>JSON-LD 1.1 Processing Algorithms and API</cite></a>. Gregg Kellogg; Dave Longley; Pierre-Antoine Champin.  W3C. 16 July 2020. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld11-api/">https://www.w3.org/TR/json-ld11-api/</a>
    </dd><dt id="bib-n-quads">[N-QUADS]</dt><dd>
      <a href="https://www.w3.org/TR/n-quads/"><cite>RDF 1.1 N-Quads</cite></a>. Gavin Carothers.  W3C. 25 February 2014. W3C Recommendation. URL: <a href="https://www.w3.org/TR/n-quads/">https://www.w3.org/TR/n-quads/</a>
    </dd><dt id="bib-nist-sp-800-186">[NIST-SP-800-186]</dt><dd>
      <cite>Recommendations for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</cite>. Lily Chen; Dustin Moody; Karen Randall; Andrew Regenscheid; Angela Robinson.  National Institute of Standards and Technology. February 2023. 
    </dd><dt id="bib-rdf-canon">[RDF-CANON]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-canon/"><cite>RDF Dataset Canonicalization</cite></a>. Gregg Kellogg; Dave Longley; Dan Yamamoto.  W3C. 21 May 2024. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-canon/">https://www.w3.org/TR/rdf-canon/</a>
    </dd><dt id="bib-rfc2104">[RFC2104]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2104"><cite>HMAC: Keyed-Hashing for Message Authentication</cite></a>. H. Krawczyk; M. Bellare; R. Canetti.  IETF. February 1997. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc2104">https://www.rfc-editor.org/rfc/rfc2104</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc4754">[RFC4754]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc4754"><cite>IKE and IKEv2 Authentication Using the Elliptic Curve Digital Signature Algorithm (ECDSA)</cite></a>. D. Fu; J. Solinas.  IETF. January 2007. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4754">https://www.rfc-editor.org/rfc/rfc4754</a>
    </dd><dt id="bib-rfc6234">[RFC6234]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc6234"><cite>US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)</cite></a>. D. Eastlake 3rd; T. Hansen.  IETF. May 2011. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc6234">https://www.rfc-editor.org/rfc/rfc6234</a>
    </dd><dt id="bib-rfc6901">[RFC6901]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc6901"><cite>JavaScript Object Notation (JSON) Pointer</cite></a>. P. Bryan, Ed.; K. Zyp; M. Nottingham, Ed. IETF. April 2013. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6901">https://www.rfc-editor.org/rfc/rfc6901</a>
    </dd><dt id="bib-rfc6979">[RFC6979]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc6979"><cite>Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)</cite></a>. T. Pornin.  IETF. August 2013. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc6979">https://www.rfc-editor.org/rfc/rfc6979</a>
    </dd><dt id="bib-rfc8174">[RFC8174]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>
    </dd><dt id="bib-rfc8785">[RFC8785]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8785"><cite>JSON Canonicalization Scheme (JCS)</cite></a>. A. Rundgren; B. Jordan; S. Erdtman.  IETF. June 2020. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc8785">https://www.rfc-editor.org/rfc/rfc8785</a>
    </dd><dt id="bib-rfc8949">[RFC8949]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc8949"><cite>Concise Binary Object Representation (CBOR)</cite></a>. C. Bormann; P. Hoffman.  IETF. December 2020. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>
    </dd><dt id="bib-vc-data-integrity">[VC-DATA-INTEGRITY]</dt><dd>
      <a href="https://www.w3.org/TR/vc-data-integrity/"><cite>Verifiable Credential Data Integrity 1.0</cite></a>. Manu Sporny; Dave Longley; Greg Bernstein; Dmitri Zagidulin; Sebastian Crane.  W3C. 17 November 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-data-integrity/">https://www.w3.org/TR/vc-data-integrity/</a>
    </dd><dt id="bib-vc-data-model-2.0">[vc-data-model-2.0]</dt><dd>
      <a href="https://www.w3.org/TR/vc-data-model-2.0/"><cite>Verifiable Credentials Data Model v2.0</cite></a>. Manu Sporny; Ted Thibodeau Jr; Ivan Herman; Michael Jones; Gabe Cohen.  W3C. 19 October 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-data-model-2.0/">https://www.w3.org/TR/vc-data-model-2.0/</a>
    </dd><dt id="bib-xmlschema11-2">[XMLSCHEMA11-2]</dt><dd>
      <a href="https://www.w3.org/TR/xmlschema11-2/"><cite>W3C XML Schema Definition Language (XSD) 1.1 Part 2: Datatypes</cite></a>. David Peterson; Sandy Gao; Ashok Malhotra; Michael Sperberg-McQueen; Henry Thompson; Paul V. Biron et al.  W3C. 5 April 2012. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xmlschema11-2/">https://www.w3.org/TR/xmlschema11-2/</a>
    </dd></dl>
  </section><section id="informative-references"><div class="header-wrapper"><h3 id="d-2-informative-references"><bdi class="secno">D.2 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix D.2"></a></div>
    
    <dl class="bibliography"><dt id="bib-nist-sp-800-57-part-1">[NIST-SP-800-57-Part-1]</dt><dd>
      <a href="https://doi.org/10.6028/NIST.SP.800-57pt1r5"><cite>Recommendation for Key Management: Part 1 – General</cite></a>. Elaine Barker.  National Institute of Standards and Technology. May 2020. URL: <a href="https://doi.org/10.6028/NIST.SP.800-57pt1r5">https://doi.org/10.6028/NIST.SP.800-57pt1r5</a>
    </dd><dt id="bib-secg2">[SECG2]</dt><dd>
      <a href="https://www.secg.org/sec2-v2.pdf"><cite>SEC 2: Recommended Elliptic Curve Domain Parameters</cite></a>.  Certicom Research. January 27, 2010. URL: <a href="https://www.secg.org/sec2-v2.pdf">https://www.secg.org/sec2-v2.pdf</a>
    </dd><dt id="bib-vc-di-bbs">[VC-DI-BBS]</dt><dd>
      <a href="https://www.w3.org/TR/vc-di-bbs/"><cite>Data Integrity BBS Cryptosuites v1.0</cite></a>. Greg Bernstein; Manu Sporny.  W3C. 15 October 2024. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/vc-di-bbs/">https://www.w3.org/TR/vc-di-bbs/</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-conforming-proof" aria-label="Links in this document to definition: conforming proof">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-conforming-proof" aria-label="Permalink for definition: conforming proof. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-conforming-proof-1" title="§ 1.2 Conformance">§ 1.2 Conformance</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-conforming-processor" aria-label="Links in this document to definition: conforming processor">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-conforming-processor" aria-label="Permalink for definition: conforming processor. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verification-result" aria-label="Links in this document to definition: verification result">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verification-result" aria-label="Permalink for definition: verification result. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verification-result-1" title="§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)">§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-result-2" title="§ 3.3.2 Verify Proof (ecdsa-jcs-2019)">§ 3.3.2 Verify Proof (ecdsa-jcs-2019)</a> <a href="#ref-for-dfn-verification-result-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-verification-result-4" title="§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)">§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)</a> <a href="#ref-for-dfn-verification-result-5" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verified" aria-label="Links in this document to definition: verified">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verified" aria-label="Permalink for definition: verified. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verified-1" title="§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)">§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)</a> <a href="#ref-for-dfn-verified-2" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-verified-3" title="§ 3.3.2 Verify Proof (ecdsa-jcs-2019)">§ 3.3.2 Verify Proof (ecdsa-jcs-2019)</a> <a href="#ref-for-dfn-verified-4" title="Reference 2">(2)</a> <a href="#ref-for-dfn-verified-5" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-verified-6" title="§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)">§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-verifieddocument" aria-label="Links in this document to definition: verifiedDocument">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-verifieddocument" aria-label="Permalink for definition: verifiedDocument. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-verifieddocument-1" title="§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)">§ 3.2.2 Verify Proof (ecdsa-rdfc-2019)</a> 
    </li><li>
      <a href="#ref-for-dfn-verifieddocument-2" title="§ 3.3.2 Verify Proof (ecdsa-jcs-2019)">§ 3.3.2 Verify Proof (ecdsa-jcs-2019)</a> <a href="#ref-for-dfn-verifieddocument-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-verifieddocument-4" title="§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)">§ 3.6.7 Verify Derived Proof (ecdsa-sd-2023)</a> 
    </li>
  </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>